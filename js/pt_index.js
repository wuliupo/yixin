function initNev(){var __main_module_name__="main";var __resources__={};function __imageResource(data){var img=new Image;img.src=data;return img}__resources__["/__builtin__/base.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var util=require("util");var Entity=require("oo").Entity,Trait=require("oo").Trait,extendObjectByTrait=require("oo").extendObjectByTrait;var Klass=Entity.clone([],{initialize:function(){}},function(){this.create=function(){var args=Array.prototype.slice.call(arguments,0),inst=this.clone([]);args.splice(0,0,"initialize");inst.exec.apply(inst,args);inst.create=undefined;inst.extend=undefined;inst.Class=this;return inst};this.extend=function(traits,extMethods,custom){traits=traits?traits:[];var cls=this.clone(traits,extMethods);cls.superClass=this;if(custom){var args=Array.prototype.slice.call(arguments,3);custom.apply(cls,args)}return cls}});exports.Klass=Klass;exports.extendObjectByTrait=extendObjectByTrait}};__resources__["/__builtin__/canvaseventobservable.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Rx=require("rx").html;var keySelectCb=function(evt){if(evt.preventDefault)evt.preventDefault();else window.event.returnValue=false;return evt};var calcRelativeMousePstn=function(evt){if(window.attachEvent){var x=evt.x;var y=evt.y}else{var x=evt.offsetX?evt.offsetX:evt.layerX;var y=evt.offsetY?evt.offsetY:evt.layerY}return{x:x,y:y}};var mousewheelSelectCb=function(evt){var evtPstn=calcRelativeMousePstn(evt);return{mouseX:evtPstn.x,mouseY:evtPstn.y,wheelDelta:evt.wheelDelta?evt.wheelDelta:evt.detail*-40,type:"mousewheel",sourceEvt:evt}};var mouseSelectCb=function(evt){if(evt.preventDefault)evt.preventDefault();else window.event.returnValue=false;var evtPstn=calcRelativeMousePstn(evt);return{x:evtPstn.x,y:evtPstn.y,sourceEvt:evt}};var CanvasEventObservables=function(canvas){this.mousedownObservable=Rx.Observable.fromEvent(canvas,"mousedown").select(mouseSelectCb);this.mouseupObservable=Rx.Observable.fromEvent(canvas,"mouseup").select(mouseSelectCb);this.mousemoveObservable=Rx.Observable.fromEvent(canvas,"mousemove").select(mouseSelectCb);this.mouseoverObservable=Rx.Observable.fromEvent(canvas,"mouseover").select(mouseSelectCb);this.mouseoutObservable=Rx.Observable.fromEvent(canvas,"mouseout").select(mouseSelectCb);this.keydownObservable=Rx.Observable.fromEvent(canvas,"keydown").select(keySelectCb);this.keyupObservable=Rx.Observable.fromEvent(canvas,"keyup").select(keySelectCb);this.mousewheelObservable=Rx.Observable.fromEvent(canvas,"mousewheel").select(mousewheelSelectCb).merge(Rx.Observable.fromEvent(canvas,"DOMMouseScroll").select(mousewheelSelectCb))};exports.CanvasEventObservables=CanvasEventObservables}};__resources__["/__builtin__/debug.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var util=require("util");var debug={log:function(s){console.log(s)},warning:function(s){console.log("!!!WARNING!!!-->"+s+"<-- ")},error:function(s){console.log("!!!ERROR!!!-->"+s+"<-- ")},assert:function(exp,msg){if(exp){return true}else{var theMsg=msg===undefined?"assert !!!":msg;console.log("exception throwed:  "+theMsg);throw theMsg}}};module.exports=debug}};__resources__["/__builtin__/excanvas.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){if(!document.createElement("canvas").getContext){(function(){var m=Math;var mr=m.round;var ms=m.sin;var mc=m.cos;var abs=m.abs;var sqrt=m.sqrt;var Z=10;var Z2=Z/2;function getContext(){return this.context_||(this.context_=new CanvasRenderingContext2D_(this))}var slice=Array.prototype.slice;function bind(f,obj,var_args){var a=slice.call(arguments,2);return function(){return f.apply(obj,a.concat(slice.call(arguments)))}}var G_vmlCanvasManager_={init:function(opt_doc){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var doc=opt_doc||document;doc.createElement("canvas");this.init_(doc)}},init_:function(doc){if(!doc.namespaces["g_vml_"]){doc.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!doc.namespaces["g_o_"]){doc.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!doc.styleSheets["ex_canvas_"]){var ss=doc.createStyleSheet();ss.owningElement.id="ex_canvas_";ss.cssText="canvas{display:inline-block;overflow:hidden;"+"text-align:left;width:300px;height:150px}"+"g_vml_\\:*{behavior:url(#default#VML)}"+"g_o_\\:*{behavior:url(#default#VML)}"}var els=doc.getElementsByTagName("canvas");for(var i=0;i<els.length;i++){this.initElement(els[i])}},initElement:function(el){if(!el.getContext){el.getContext=getContext;el.innerHTML="";el.attachEvent("onpropertychange",onPropertyChange);el.attachEvent("onresize",onResize);var attrs=el.attributes;if(attrs.width&&attrs.width.specified){el.style.width=attrs.width.nodeValue+"px"}else{el.width=el.clientWidth}if(attrs.height&&attrs.height.specified){el.style.height=attrs.height.nodeValue+"px"}else{el.height=el.clientHeight}}return el}};function onPropertyChange(e){var el=e.srcElement;switch(e.propertyName){case"width":el.style.width=el.attributes.width.nodeValue+"px";el.getContext().clearRect();break;case"height":el.style.height=el.attributes.height.nodeValue+"px";el.getContext().clearRect();break}}function onResize(e){var el=e.srcElement;if(el.firstChild){el.firstChild.style.width=el.clientWidth+"px";el.firstChild.style.height=el.clientHeight+"px"}}G_vmlCanvasManager_.init();var dec2hex=[];for(var i=0;i<16;i++){for(var j=0;j<16;j++){dec2hex[i*16+j]=i.toString(16)+j.toString(16)}}function createMatrixIdentity(){return[[1,0,0],[0,1,0],[0,0,1]]}function matrixMultiply(m1,m2){var result=createMatrixIdentity();for(var x=0;x<3;x++){for(var y=0;y<3;y++){var sum=0;for(var z=0;z<3;z++){sum+=m1[x][z]*m2[z][y]}result[x][y]=sum}}return result}function copyState(o1,o2){o2.fillStyle=o1.fillStyle;o2.lineCap=o1.lineCap;o2.lineJoin=o1.lineJoin;o2.lineWidth=o1.lineWidth;o2.miterLimit=o1.miterLimit;o2.shadowBlur=o1.shadowBlur;o2.shadowColor=o1.shadowColor;o2.shadowOffsetX=o1.shadowOffsetX;o2.shadowOffsetY=o1.shadowOffsetY;o2.strokeStyle=o1.strokeStyle;o2.globalAlpha=o1.globalAlpha;o2.arcScaleX_=o1.arcScaleX_;o2.arcScaleY_=o1.arcScaleY_;o2.lineScale_=o1.lineScale_}function processStyle(styleString){var str,alpha=1;styleString=String(styleString);if(styleString.substring(0,3)=="rgb"){var start=styleString.indexOf("(",3);var end=styleString.indexOf(")",start+1);var guts=styleString.substring(start+1,end).split(",");str="#";for(var i=0;i<3;i++){str+=dec2hex[Number(guts[i])]}if(guts.length==4&&styleString.substr(3,1)=="a"){alpha=guts[3]}}else{str=styleString}return{color:str,alpha:alpha}}function processLineCap(lineCap){switch(lineCap){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function CanvasRenderingContext2D_(surfaceElement){this.m_=createMatrixIdentity();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=Z*1;this.globalAlpha=1;this.canvas=surfaceElement;var el=surfaceElement.ownerDocument.createElement("div");el.style.width=surfaceElement.clientWidth+"px";el.style.height=surfaceElement.clientHeight+"px";el.style.overflow="hidden";el.style.position="absolute";surfaceElement.appendChild(el);this.element_=el;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var contextPrototype=CanvasRenderingContext2D_.prototype;contextPrototype.clearRect=function(){this.element_.innerHTML=""};contextPrototype.beginPath=function(){this.currentPath_=[]};contextPrototype.moveTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:"moveTo",x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y};contextPrototype.lineTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:"lineTo",x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y};contextPrototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var p=this.getCoords_(aX,aY);var cp1=this.getCoords_(aCP1x,aCP1y);var cp2=this.getCoords_(aCP2x,aCP2y);bezierCurveTo(this,cp1,cp2,p)};function bezierCurveTo(self,cp1,cp2,p){self.currentPath_.push({type:"bezierCurveTo",cp1x:cp1.x,cp1y:cp1.y,cp2x:cp2.x,cp2y:cp2.y,x:p.x,y:p.y});self.currentX_=p.x;self.currentY_=p.y}contextPrototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var cp=this.getCoords_(aCPx,aCPy);var p=this.getCoords_(aX,aY);var cp1={x:this.currentX_+2/3*(cp.x-this.currentX_),y:this.currentY_+2/3*(cp.y-this.currentY_)};var cp2={x:cp1.x+(p.x-this.currentX_)/3,y:cp1.y+(p.y-this.currentY_)/3};bezierCurveTo(this,cp1,cp2,p)};contextPrototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){aRadius*=Z;var arcType=aClockwise?"at":"wa";var xStart=aX+mc(aStartAngle)*aRadius-Z2;var yStart=aY+ms(aStartAngle)*aRadius-Z2;var xEnd=aX+mc(aEndAngle)*aRadius-Z2;var yEnd=aY+ms(aEndAngle)*aRadius-Z2;if(xStart==xEnd&&!aClockwise){xStart+=.125}var p=this.getCoords_(aX,aY);var pStart=this.getCoords_(xStart,yStart);var pEnd=this.getCoords_(xEnd,yEnd);this.currentPath_.push({type:arcType,x:p.x,y:p.y,radius:aRadius,xStart:pStart.x,yStart:pStart.y,xEnd:pEnd.x,yEnd:pEnd.y})};contextPrototype.rect=function(aX,aY,aWidth,aHeight){this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath()};contextPrototype.strokeRect=function(aX,aY,aWidth,aHeight){var oldPath=this.currentPath_;this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.stroke();this.currentPath_=oldPath};contextPrototype.fillRect=function(aX,aY,aWidth,aHeight){var oldPath=this.currentPath_;this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.fill();this.currentPath_=oldPath};contextPrototype.createLinearGradient=function(aX0,aY0,aX1,aY1){var gradient=new CanvasGradient_("gradient");gradient.x0_=aX0;gradient.y0_=aY0;gradient.x1_=aX1;gradient.y1_=aY1;return gradient};contextPrototype.createRadialGradient=function(aX0,aY0,aR0,aX1,aY1,aR1){var gradient=new CanvasGradient_("gradientradial");gradient.x0_=aX0;gradient.y0_=aY0;gradient.r0_=aR0;gradient.x1_=aX1;gradient.y1_=aY1;gradient.r1_=aR1;return gradient};contextPrototype.drawImage=function(image,var_args){var dx,dy,dw,dh,sx,sy,sw,sh;var oldRuntimeWidth=image.runtimeStyle.width;var oldRuntimeHeight=image.runtimeStyle.height;image.runtimeStyle.width="auto";image.runtimeStyle.height="auto";var w=image.width;var h=image.height;image.runtimeStyle.width=oldRuntimeWidth;image.runtimeStyle.height=oldRuntimeHeight;if(arguments.length==3){dx=arguments[1];dy=arguments[2];sx=sy=0;sw=dw=w;sh=dh=h}else if(arguments.length==5){dx=arguments[1];dy=arguments[2];dw=arguments[3];dh=arguments[4];sx=sy=0;sw=w;sh=h}else if(arguments.length==9){sx=arguments[1];sy=arguments[2];sw=arguments[3];sh=arguments[4];dx=arguments[5];dy=arguments[6];dw=arguments[7];dh=arguments[8]}else{throw Error("Invalid number of arguments")}var d=this.getCoords_(dx,dy);var w2=sw/2;var h2=sh/2;var vmlStr=[];var W=10;var H=10;vmlStr.push(" <g_vml_:group",' coordsize="',Z*W,",",Z*H,'"',' coordorigin="0,0"',' style="width:',W,"px;height:",H,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var filter=[];filter.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",mr(d.x/Z),",","Dy=",mr(d.y/Z),"");var max=d;var c2=this.getCoords_(dx+dw,dy);var c3=this.getCoords_(dx,dy+dh);var c4=this.getCoords_(dx+dw,dy+dh);max.x=m.max(max.x,c2.x,c3.x,c4.x);max.y=m.max(max.y,c2.y,c3.y,c4.y);vmlStr.push("padding:0 ",mr(max.x/Z),"px ",mr(max.y/Z),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",filter.join(""),", sizingmethod='clip');")}else{vmlStr.push("top:",mr(d.y/Z),"px;left:",mr(d.x/Z),"px;")}vmlStr.push(' ">','<g_vml_:image src="',image.src,'"',' style="width:',Z*dw,"px;"," height:",Z*dh,'px;"',' cropleft="',sx/w,'"',' croptop="',sy/h,'"',' cropright="',(w-sx-sw)/w,'"',' cropbottom="',(h-sy-sh)/h,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",vmlStr.join(""))};contextPrototype.stroke=function(aFill){var lineStr=[];var lineOpen=false;var a=processStyle(aFill?this.fillStyle:this.strokeStyle);var color=a.color;var opacity=a.alpha*this.globalAlpha;var W=10;var H=10;lineStr.push("<g_vml_:shape",' filled="',!!aFill,'"',' style="position:absolute;width:',W,"px;height:",H,'px;"',' coordorigin="0 0" coordsize="',Z*W," ",Z*H,'"',' stroked="',!aFill,'"',' path="');var newSeq=false;var min={x:null,y:null};var max={x:null,y:null};for(var i=0;i<this.currentPath_.length;i++){var p=this.currentPath_[i];var c;switch(p.type){case"moveTo":c=p;lineStr.push(" m ",mr(p.x),",",mr(p.y));break;case"lineTo":lineStr.push(" l ",mr(p.x),",",mr(p.y));break;case"close":lineStr.push(" x ");p=null;break;case"bezierCurveTo":lineStr.push(" c ",mr(p.cp1x),",",mr(p.cp1y),",",mr(p.cp2x),",",mr(p.cp2y),",",mr(p.x),",",mr(p.y));break;case"at":case"wa":lineStr.push(" ",p.type," ",mr(p.x-this.arcScaleX_*p.radius),",",mr(p.y-this.arcScaleY_*p.radius)," ",mr(p.x+this.arcScaleX_*p.radius),",",mr(p.y+this.arcScaleY_*p.radius)," ",mr(p.xStart),",",mr(p.yStart)," ",mr(p.xEnd),",",mr(p.yEnd));break}if(p){if(min.x==null||p.x<min.x){min.x=p.x}if(max.x==null||p.x>max.x){max.x=p.x}if(min.y==null||p.y<min.y){min.y=p.y}if(max.y==null||p.y>max.y){max.y=p.y}}}lineStr.push(' ">');if(!aFill){var lineWidth=this.lineScale_*this.lineWidth;if(lineWidth<1){opacity*=lineWidth}lineStr.push("<g_vml_:stroke",' opacity="',opacity,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',processLineCap(this.lineCap),'"',' weight="',lineWidth,'px"',' color="',color,'" />')}else if(typeof this.fillStyle=="object"){var fillStyle=this.fillStyle;var angle=0;var focus={x:0,y:0};var shift=0;var expansion=1;if(fillStyle.type_=="gradient"){var x0=fillStyle.x0_/this.arcScaleX_;var y0=fillStyle.y0_/this.arcScaleY_;var x1=fillStyle.x1_/this.arcScaleX_;var y1=fillStyle.y1_/this.arcScaleY_;var p0=this.getCoords_(x0,y0);var p1=this.getCoords_(x1,y1);var dx=p1.x-p0.x;var dy=p1.y-p0.y;angle=Math.atan2(dx,dy)*180/Math.PI;if(angle<0){angle+=360}if(angle<1e-6){angle=0}}else{var p0=this.getCoords_(fillStyle.x0_,fillStyle.y0_);var width=max.x-min.x;var height=max.y-min.y;focus={x:(p0.x-min.x)/width,y:(p0.y-min.y)/height};width/=this.arcScaleX_*Z;height/=this.arcScaleY_*Z;var dimension=m.max(width,height);shift=2*fillStyle.r0_/dimension;expansion=2*fillStyle.r1_/dimension-shift}var stops=fillStyle.colors_;stops.sort(function(cs1,cs2){return cs1.offset-cs2.offset});var length=stops.length;var color1=stops[0].color;var color2=stops[length-1].color;var opacity1=stops[0].alpha*this.globalAlpha;var opacity2=stops[length-1].alpha*this.globalAlpha;var colors=[];for(var i=0;i<length;i++){var stop=stops[i];colors.push(stop.offset*expansion+shift+" "+stop.color)}lineStr.push('<g_vml_:fill type="',fillStyle.type_,'"',' method="none" focus="100%"',' color="',color1,'"',' color2="',color2,'"',' colors="',colors.join(","),'"',' opacity="',opacity2,'"',' g_o_:opacity2="',opacity1,'"',' angle="',angle,'"',' focusposition="',focus.x,",",focus.y,'" />')}else{lineStr.push('<g_vml_:fill color="',color,'" opacity="',opacity,'" />')}lineStr.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",lineStr.join(""))};contextPrototype.fill=function(){this.stroke(true)};contextPrototype.closePath=function(){this.currentPath_.push({type:"close"})};contextPrototype.getCoords_=function(aX,aY){var m=this.m_;return{x:Z*(aX*m[0][0]+aY*m[1][0]+m[2][0])-Z2,y:Z*(aX*m[0][1]+aY*m[1][1]+m[2][1])-Z2}};contextPrototype.save=function(){var o={};copyState(this,o);this.aStack_.push(o);this.mStack_.push(this.m_);this.m_=matrixMultiply(createMatrixIdentity(),this.m_)};contextPrototype.restore=function(){copyState(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function matrixIsFinite(m){for(var j=0;j<3;j++){for(var k=0;k<2;k++){if(!isFinite(m[j][k])||isNaN(m[j][k])){return false}}}return true}function setM(ctx,m,updateLineScale){if(!matrixIsFinite(m)){return}ctx.m_=m;if(updateLineScale){var det=m[0][0]*m[1][1]-m[0][1]*m[1][0];ctx.lineScale_=sqrt(abs(det))}}contextPrototype.translate=function(aX,aY){var m1=[[1,0,0],[0,1,0],[aX,aY,1]];setM(this,matrixMultiply(m1,this.m_),false)};contextPrototype.rotate=function(aRot){var c=mc(aRot);var s=ms(aRot);var m1=[[c,s,0],[-s,c,0],[0,0,1]];setM(this,matrixMultiply(m1,this.m_),false)};contextPrototype.scale=function(aX,aY){this.arcScaleX_*=aX;this.arcScaleY_*=aY;var m1=[[aX,0,0],[0,aY,0],[0,0,1]];setM(this,matrixMultiply(m1,this.m_),true)};contextPrototype.transform=function(m11,m12,m21,m22,dx,dy){var m1=[[m11,m12,0],[m21,m22,0],[dx,dy,1]];setM(this,matrixMultiply(m1,this.m_),true)};contextPrototype.setTransform=function(m11,m12,m21,m22,dx,dy){var m=[[m11,m12,0],[m21,m22,0],[dx,dy,1]];setM(this,m,true)};contextPrototype.clip=function(){};contextPrototype.arcTo=function(){};contextPrototype.createPattern=function(){return new CanvasPattern_};function parseFont(font){var p=document.createElement("p");document.body.appendChild(p);p.style.font=font;if(window.getComputedStyle)pStyle=window.getComputedStyle(p);else pStyle=p.currentStyle;var font={fontVariant:pStyle.fontVariant,fontWeight:pStyle.fontWeight,fontSize:pStyle.fontSize,lineHeight:pStyle.lineHeight,fontFamily:pStyle.fontFamily};p.parentNode.removeChild(p);return font}contextPrototype.fillText=function(textToDraw,x,y){var textHeight=parseInt(parseFont(this.font).fontSize);var textWidth=this.measureText(textToDraw).width;var d=this.getCoords_(x,y);d.x+=x;d.y+=y;var vmlStr=[];var W=10;var H=10;var max={x:d.x,y:d.y};var min={x:d.x,y:d.y};var c2=this.getCoords_(d.x+textWidth,d.y);var c3=this.getCoords_(d.x,d.y+textHeight);var c4=this.getCoords_(d.y+textWidth,d.y+textHeight);max.x=m.max(max.x,c2.x,c3.x,c4.x);max.y=m.max(max.y,c2.y,c3.y,c4.y);min.x=m.min(min.x,c2.x,c3.x,c4.x);min.y=m.min(min.x,c2.x,c3.x,c4.x);vmlStr.push(" <g_vml_:group",' coordsize="',Z*W,",",Z*H,'"',' coordorigin="0,0"',' style="width:',textWidth,"px;height:",textHeight,"px;position:absolute;","font:"+this.font+";","color:"+this.fillStyle+";");if(this.m_[0][0]!=1||this.m_[0][1]){var filter=[];filter.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",mr(d.x/Z),",","Dy=",mr(d.y/Z),"");vmlStr.push("filter:progid:DXImageTransform.Microsoft.Matrix(",filter.join(""),", sizingmethod='clip');")}else{vmlStr.push("top:",mr((d.y+y)/Z),"px;left:",mr((d.x+x)/Z),"px;")}vmlStr.push(' > < g_vml_:textbox inset="0,0,0,0" style="width:',max.x-min.x,"px; height:",max.y-min.y,'px;" >'+textToDraw," </ g_vml_:textbox>","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",vmlStr.join(""))};contextPrototype.measureText=function(textToDraw){var hiddenSpan=document.createElement("span");hiddenSpan.style.font=this.font;hiddenSpan.innerHTML=textToDraw;var bodyNode=document.getElementsByTagName("body")[0];bodyNode.appendChild(hiddenSpan);var width=hiddenSpan.offsetWidth;bodyNode.removeChild(hiddenSpan);return{width:width+1}};function CanvasGradient_(aType){this.type_=aType;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}CanvasGradient_.prototype.addColorStop=function(aOffset,aColor){aColor=processStyle(aColor);this.colors_.push({offset:aOffset,color:aColor.color,alpha:aColor.alpha})};function CanvasPattern_(){}G_vmlCanvasManager=G_vmlCanvasManager_;CanvasRenderingContext2D=CanvasRenderingContext2D_;CanvasGradient=CanvasGradient_;CanvasPattern=CanvasPattern_})()}}};__resources__["/__builtin__/geometry.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var util=require("util");var RE_PAIR=/\{\s*([\d.\-]+)\s*,\s*([\d.\-]+)\s*\}/,RE_DOUBLE_PAIR=/\{\s*(\{[\s\d,.\-]+\})\s*,\s*(\{[\s\d,.\-]+\})\s*\}/;var cross=function(v1,v2){return v1.x*v2.y-v1.y*v2.x};var geometry={Point:function(x,y){this.x=x;this.y=y},Size:function(w,h){this.width=w;this.height=h},Rect:function(x,y,w,h){this.origin=new geometry.Point(x,y);this.size=new geometry.Size(w,h)},Matrix:function(a,b,c,d,tx,ty,tz){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;if(tz==undefined)this.tz=0;else this.tz=tz},ccp:function(x,y){return module.exports.pointMake(x,y)},ccpAdd:function(p1,p2){return geometry.ccp(p1.x+p2.x,p1.y+p2.y)},ccpAddBy:function(p1,p2){p1.x+=p2.x;p1.y+=p2.y;return p1},ccpSub:function(p1,p2){return geometry.ccp(p1.x-p2.x,p1.y-p2.y)},ccpSubBy:function(p1,p2){p1.x-=p2.x;p1.y-=p2.y;return p1},ccpMult:function(p1,p2){return geometry.ccp(p1.x*p2.x,p1.y*p2.y)},ccpMultBy:function(p1,p2){p1.x*=p2.x;p1.y*=p2.y;return p1},ccpNeg:function(p){return geometry.ccp(-p.x,-p.y)},ccpNegBy:function(p){p.x=-p.x;p.y=-p.y;return p},ccpRound:function(p){return geometry.ccp(Math.round(p.x),Math.round(p.y))},ccpRoundBy:function(p){p.x=Math.round(p.x);p.y=Math.round(p.y);return p},ccpCeil:function(p){return geometry.ccp(Math.ceil(p.x),Math.ceil(p.y))},ccpCeilBy:function(p){p.x=Math.ceil(p.x);p.y=Math.ceil(p.y);return p},ccpFloor:function(p){return geometry.ccp(Math.floor(p.x),Math.floor(p.y))},ccpFloorBy:function(p){p.x=Math.floor(p.x);p.y=Math.floor(p.y);return p},PointZero:function(){return geometry.ccp(0,0)},isPointInPolygon:function(p,convex){var triangleIsCW=function(p1,p2,p3){var a=geometry.ccpSub(p1,p3),b=geometry.ccpSub(p2,p3);return cross(a,b)>0};var low=0,n=convex.length,high=n;do{var mid=Math.floor((low+high)/2);if(triangleIsCW(convex[0],convex[mid],p))low=mid;else high=mid}while(low+1<high);if(low==0||high==n)return false;return triangleIsCW(convex[low],convex[high],p)},getVectorAngle:function(v1,v2){var cos=v2.x*v1.x+v2.y*v1.y;var mod=Math.sqrt(v2.x*v2.x+v2.y*v2.y)*Math.sqrt(v1.x*v1.x+v1.y*v1.y);if(mod==0){return undefined}var radian=Math.acos(cos/mod);if(cross(v1,v2)<0)radian=Math.PI*2-radian;return radian},rectMake:function(x,y,w,h){return new geometry.Rect(x,y,w,h)},rectFromString:function(str){var matches=str.match(RE_DOUBLE_PAIR),p=geometry.pointFromString(matches[1]),s=geometry.sizeFromString(matches[2]);return geometry.rectMake(p.x,p.y,s.width,s.height)},sizeMake:function(w,h){return new geometry.Size(w,h)},sizeFromString:function(str){var matches=str.match(RE_PAIR),w=parseFloat(matches[1]),h=parseFloat(matches[2]);return geometry.sizeMake(w,h)},pointMake:function(x,y){return new geometry.Point(x,y)},pointFromString:function(str){var matches=str.match(RE_PAIR),x=parseFloat(matches[1]),y=parseFloat(matches[2]);return geometry.pointMake(x,y)},rectContainsPoint:function(r,p){return p.x>=r.origin.x&&p.x<=r.origin.x+r.size.width&&p.y>=r.origin.y&&p.y<=r.origin.y+r.size.height},rectUnion:function(r1,r2){var rect=new geometry.Rect(0,0,0,0);rect.origin.x=Math.min(r1.origin.x,r2.origin.x);rect.origin.y=Math.min(r1.origin.y,r2.origin.y);rect.size.width=Math.max(r1.origin.x+r1.size.width,r2.origin.x+r2.size.width)-rect.origin.x;rect.size.height=Math.max(r1.origin.y+r1.size.height,r2.origin.y+r2.size.height)-rect.origin.y;return rect},rectOverlapsRect:function(r1,r2){if(r1.origin.x+r1.size.width<r2.origin.x){return false}if(r2.origin.x+r2.size.width<r1.origin.x){return false}if(r1.origin.y+r1.size.height<r2.origin.y){return false}if(r2.origin.y+r2.size.height<r1.origin.y){return false}return true},rectIntersection:function(lhsRect,rhsRect){var intersection=new geometry.Rect(Math.max(geometry.rectGetMinX(lhsRect),geometry.rectGetMinX(rhsRect)),Math.max(geometry.rectGetMinY(lhsRect),geometry.rectGetMinY(rhsRect)),0,0);intersection.size.width=Math.min(geometry.rectGetMaxX(lhsRect),geometry.rectGetMaxX(rhsRect))-geometry.rectGetMinX(intersection);intersection.size.height=Math.min(geometry.rectGetMaxY(lhsRect),geometry.rectGetMaxY(rhsRect))-geometry.rectGetMinY(intersection);return intersection},pointEqualToPoint:function(point1,point2){return point1.x==point2.x&&point1.y==point2.y},sizeEqualToSize:function(size1,size2){return size1.width==size2.width&&size1.height==size2.height},rectEqualToRect:function(rect1,rect2){return module.exports.sizeEqualToSize(rect1.size,rect2.size)&&module.exports.pointEqualToPoint(rect1.origin,rect2.origin)},rectGetMinX:function(rect){return rect.origin.x},rectGetMinY:function(rect){return rect.origin.y},rectGetMaxX:function(rect){return rect.origin.x+rect.size.width},rectGetMaxY:function(rect){return rect.origin.y+rect.size.height},boundingRectMake:function(p1,p2,p3,p4){var minX=Math.min(p1.x,p2.x,p3.x,p4.x);var minY=Math.min(p1.y,p2.y,p3.y,p4.y);var maxX=Math.max(p1.x,p2.x,p3.x,p4.x);var maxY=Math.max(p1.y,p2.y,p3.y,p4.y);return new geometry.Rect(minX,minY,maxX-minX,maxY-minY)},pointApplyMatrix:function(point,t){return new geometry.Point(t.a*point.x+t.c*point.y+t.tx,t.b*point.x+t.d*point.y+t.ty)},rectApplyMatrix:function(rect,trans){var p1=geometry.ccp(geometry.rectGetMinX(rect),geometry.rectGetMinY(rect));var p2=geometry.ccp(geometry.rectGetMaxX(rect),geometry.rectGetMinY(rect));var p3=geometry.ccp(geometry.rectGetMinX(rect),geometry.rectGetMaxY(rect));var p4=geometry.ccp(geometry.rectGetMaxX(rect),geometry.rectGetMaxY(rect));p1=geometry.pointApplyMatrix(p1,trans);p2=geometry.pointApplyMatrix(p2,trans);p3=geometry.pointApplyMatrix(p3,trans);p4=geometry.pointApplyMatrix(p4,trans);return geometry.boundingRectMake(p1,p2,p3,p4)},matrixInvert:function(trans){var determinant=1/(trans.a*trans.d-trans.b*trans.c);return new geometry.Matrix(determinant*trans.d,-determinant*trans.b,-determinant*trans.c,determinant*trans.a,determinant*(trans.c*trans.ty-trans.d*trans.tx),determinant*(trans.b*trans.tx-trans.a*trans.ty),trans.tz)},matrixInvertBy:function(trans){var determinant=1/(trans.a*trans.d-trans.b*trans.c);var a=determinant*trans.d,b=-determinant*trans.b,c=-determinant*trans.c,d=determinant*trans.a,tx=determinant*(trans.c*trans.ty-trans.d*trans.tx),ty=determinant*(trans.b*trans.tx-trans.a*trans.ty);trans.a=a;trans.b=b;trans.c=c;trans.d=d;trans.tx=tx;trans.ty=ty;return trans},matrixMult:function(lhs,rhs){return new geometry.Matrix(lhs.a*rhs.a+lhs.c*rhs.b,lhs.b*rhs.a+lhs.d*rhs.b,lhs.a*rhs.c+lhs.c*rhs.d,lhs.b*rhs.c+lhs.d*rhs.d,lhs.a*rhs.tx+lhs.c*rhs.ty+lhs.tx,lhs.b*rhs.tx+lhs.d*rhs.ty+lhs.ty,lhs.tz+rhs.tz)},matrixMultBy:function(lhs,rhs){var a=lhs.a*rhs.a+lhs.c*rhs.b,b=lhs.b*rhs.a+lhs.d*rhs.b,c=lhs.a*rhs.c+lhs.c*rhs.d,d=lhs.b*rhs.c+lhs.d*rhs.d,tx=lhs.a*rhs.tx+lhs.c*rhs.ty+lhs.tx,ty=lhs.b*rhs.tx+lhs.d*rhs.ty+lhs.ty,tz=lhs.tz+rhs.tz;lhs.a=a;lhs.b=b;lhs.c=c;lhs.d=d;lhs.tx=tx;lhs.ty=ty;lhs.tz=tz;return lhs},degreesToRadians:function(angle){return angle/180*Math.PI},radiansToDegrees:function(angle){return angle*(180/Math.PI)},matrixTranslate:function(trans,tx,ty,tz){var newTrans=util.copy(trans);newTrans.tx=trans.tx+trans.a*tx+trans.c*ty;newTrans.ty=trans.ty+trans.b*tx+trans.d*ty;if(tz!=undefined){if(trans.tz!=undefined)newTrans.tz=trans.tz+tz;else newTrans.tz=tz}return newTrans},matrixTranslateBy:function(trans,tx,ty,tz){if(tz!=undefined&&trans.tz==undefined){trans.tz=0}trans.tx=trans.tx+trans.a*tx+trans.c*ty;trans.ty=trans.ty+trans.b*tx+trans.d*ty;if(tz!=undefined)trans.tz=trans.tz+tz;return trans},matrixRotateBy:function(trans,angle){var sin=Math.sin(angle),cos=Math.cos(angle);var a,b,c,d;a=trans.a*cos+trans.c*sin;b=trans.b*cos+trans.d*sin;c=trans.c*cos-trans.a*sin;d=trans.d*cos-trans.b*sin;trans.a=a;trans.b=b;trans.c=c;trans.d=d;return trans},matrixRotate:function(trans,angle){var sin=Math.sin(angle),cos=Math.cos(angle);var a,b,c,d;a=trans.a*cos+trans.c*sin;b=trans.b*cos+trans.d*sin;c=trans.c*cos-trans.a*sin;d=trans.d*cos-trans.b*sin;return new geometry.Matrix(a,b,c,d,trans.tx,trans.ty,trans.tz)},matrixScaleBy:function(trans,sx,sy){if(sy===undefined){sy=sx}trans.a*=sx;trans.b*=sx;trans.c*=sy;trans.d*=sy;return trans},matrixScale:function(trans,sx,sy){if(sy===undefined){sy=sx}return new geometry.Matrix(trans.a*sx,trans.b*sx,trans.c*sy,trans.d*sy,trans.tx,trans.ty,trans.tz)},identityMatrix:function(){return new geometry.Matrix(1,0,0,1,0,0,0)},decomposeMatrix:function(matrix){var sx=Math.sqrt(Math.pow(matrix.a,2)+Math.pow(matrix.b,2)),sy=Math.sqrt(Math.pow(matrix.c,2)+Math.pow(matrix.d,2)),radius=Math.acos(matrix.a/sx),tx=matrix.tx,ty=matrix.ty,tz=matrix.tz;return{sx:sx,sy:sy,tx:matrix.tx,ty:matrix.ty,tz:matrix.tz}}};module.exports=geometry}};__resources__["/__builtin__/helper.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){require("excanvas");function createSketchpad(width,height,parent){if(arguments.length==1){parent=width;width=undefined}var cv=document.createElement("canvas");if(parent===undefined){document.body.appendChild(cv);if(window.G_vmlCanvasManager)window.G_vmlCanvasManager.initElement(cv)}else{parent.appendChild(cv);if(window.G_vmlCanvasManager)window.G_vmlCanvasManager.initElement(cv)}if(width!=undefined)cv.width=width;if(height!=undefined)cv.height=height;return cv}function createHiddenSketchpad(width,height){var cv=document.createElement("canvas");if(width!=undefined)cv.width=width;if(height!=undefined)cv.height=height;return cv}function loadImage(src,type,callback){var img=new Image;img.src=src;img.onload=function(){if(callback)callback()};return img}function createAudio(){return document.createElement("audio")}function parseFont(font){var p=document.createElement("p");document.body.appendChild(p);p.style.font=font;if(window.getComputedStyle)pStyle=window.getComputedStyle(p);else pStyle=p.currentStyle;var font={fontVariant:pStyle.fontVariant,fontWeight:pStyle.fontWeight,fontSize:pStyle.fontSize,lineHeight:pStyle.lineHeight,fontFamily:pStyle.fontFamily};p.parentNode.removeChild(p);return font}function joinFont(font){return font.fontVariant+" "+font.fontWeight+" "+font.fontSize+"/"+font.lineHeight+" "+font.fontFamily}exports.createSketchpad=createSketchpad;exports.loadImage=loadImage;exports.createAudio=createAudio;exports.createHiddenSketchpad=createHiddenSketchpad;exports.parseFont=parseFont;exports.joinFont=joinFont}};__resources__["/__builtin__/oo.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var slice=Array.prototype.slice;var util=require("util");var createObject=util.createObject;var createNormalObject=util.createNormalObject;var assert=require("debug").assert;var TraitFuncs={isTrait:function(){return true}};function checkTrait(t){assert(t.isTrait(),"argument is not an valid trait!!! ")}var Trait=createObject(TraitFuncs,{_methods:{},_usedTraits:{},forbidden:{_ownerTrait:Trait}});function compose(traits){var methods={};var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});for(var i=0;i<traits.length;++i){checkTrait(traits[i]);var mtbl=traits[i]._methods;for(var mname in mtbl){if(mtbl.hasOwnProperty(mname)){if(methods[mname]!==undefined&&methods[mname]!==mtbl[mname]){assert(false,"`"+mname+"' method conflicts!!!")}else{methods[mname]=mtbl[mname]}}}usedTraits[Object.getIdentifier(traits[i])]=traits[i]}return nt}function extend(base,extendMethods){checkTrait(base);var methods=createNormalObject(base._methods,{});var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});usedTraits[Object.getIdentifier(base)]=base;for(var mname in extendMethods){var f=extendMethods[mname];assert(typeof f==="function","expect function");methods[mname]={_ownerTrait:nt,_func:f}}return nt}function neg(trait){checkTrait(trait);if(trait._negtive){return _negtive}var methods={};var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});usedTraits[Object.getIdentifier(trait)]=trait;var mtbl=trait._methods;for(var mname in mtbl){methods[mname]=Trait.forbidden}nt._negtive=trait;return nt}function rename(trait,nameMap){checkTrait(trait);var methods={};var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});usedTraits[Object.getIdentifier(trait)]=trait;var mtbl=trait._methods;for(var mname in mtbl){if(mtbl.hasOwnProperty(mname)){var theName=nameMap[mname];theName=theName?theName:mname;if(methods[theName]!==undefined&&methods[theName]!==mtbl[mname]){assert(false,"`"+theName+"' name conflicts!!!")}else{methods[theName]=mtbl[mname]}}}return nt}function exclude(trait,nameList){checkTrait(trait);var methods={};var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});usedTraits[Object.getIdentifier(trait)]=trait;var mtbl=trait._methods;for(var mname in mtbl){methods[mname]=mtbl[mname]}for(var i=0;i<nameList.length;++i){delete methods[nameList[i]]}return nt}function select(trait,nameList){checkTrait(trait);var methods={};var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});usedTraits[Object.getIdentifier(trait)]=trait;var mtbl=trait._methods;for(var i=0;i<nameList.length;++i){var m=mtbl[nameList[i]];if(null!=m){methods[nameList[i]]=m}}return nt}function alias(trait,nameMap){checkTrait(trait);var methods={};var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});usedTraits[Object.getIdentifier(trait)]=trait;var mtbl=trait._methods;for(var mname in mtbl){if(mtbl.hasOwnProperty(mname))methods[mname]=mtbl[mname]}for(var theName in nameMap){var newName=nameMap[theName];if(methods[newName]!==undefined&&methods[newName]!==mtbl[theName]){assert(false,"`"+newName+"' name conflicts!!!")}else{methods[newName]=mtbl[theName]}}return nt}function prefix(trait,prefixStr){checkTrait(trait);var methods={};var usedTraits={};var nt=createObject(TraitFuncs,{_methods:methods,_usedTraits:usedTraits});usedTraits[Object.getIdentifier(trait)]=trait;var mtbl=trait._methods;for(var mname in mtbl){methods[prefixStr+mname]=mtbl[mname]}return nt}function hasMethod(trait,name){return!!trait._methods[name]}TraitFuncs.extend=function(extendMethods){return extend(this,extendMethods)};TraitFuncs.neg=function(){return neg(this)};TraitFuncs.rename=function(nameMap){return rename(this,nameMap)};TraitFuncs.exclude=function(nameList){return exclude(this,nameList)};TraitFuncs.select=function(nameList){return select(this,nameList)};TraitFuncs.alias=function(nameMap){return alias(this,nameMap)};TraitFuncs.prefix=function(prefixStr){return prefix(this,prefixStr)};TraitFuncs.hasMethod=function(name){return hasMethod(this,name)};function validMethod(m){return m!==undefined&&m!==Trait.forbidden}function useTraits(o,protomethods,traits,extendMethods){var innerTrait=extend(compose(traits),extendMethods);var newMtbl=createObject(protomethods,{});var traitMethods=innerTrait._methods;for(var mname in traitMethods){var md=traitMethods[mname];newMtbl[mname]={_func:md._func,_ownerTrait:md._ownerTrait,_ownerObject:o}}o._methods=newMtbl;for(var i=0;i<traits.length;++i){o._usedTraits[Object.getIdentifier(traits[i])]=traits[i]}o._usedTraits[Object.getIdentifier(innerTrait)]=innerTrait;o._aggregateTrait=innerTrait;return o}function extendObjectByTrait(o,trait){assert(o.isEntity(),"object is not a Entity");assert(!o._usedTraits[Object.getIdentifier(trait)],"trait is already in use");var oms=o._methods;Object.keys(trait._methods).forEach(function(k){var tm=trait._methods[k];oms[k]={_func:tm._func,_ownerTrait:tm._ownerTrait,_ownerObject:o}});o._usedTraits[Object.getIdentifier(trait)]=trait;return o}function callTraitMethod(o,md,args){var oldMd=o._currentTraitMethodDesc;o._currentTraitMethodDesc=md;var ret=md._func.apply(o,args);o._currentTraitMethodDesc=oldMd;return ret}function clone(p,traits,extendMethods,custom){assert(p.isEntity(),"1st argument expect an Entity!");var shareStore=createObject(p._shareStore,{});var usedTraits={};var o=createObject(p,{_shareStore:shareStore,_usedTraits:usedTraits});useTraits(o,p._methods,traits,extendMethods);if(custom){var customArgs=slice.call(arguments,4);custom.apply(o,customArgs)}return o}var Entity={_shareStore:{},_usedTraits:{},_methods:{},isEntity:function(){return true},proto:function(){return this.__proto__},aggregateTrait:function(){return this._aggregateTrait},execProto:function(methodName){var currentMd=this._currentTraitMethodDesc;assert(currentMd,"can't execProto outside of a trait function !!!");var m=currentMd._ownerObject.proto()._methods[methodName];assert(validMethod(m),"can not respond to `"+methodName+"' !!!");var args=slice.call(arguments,1);return callTraitMethod(this,m,args)},exec:function(methodName){var m=this._methods[methodName];assert(validMethod(m),"can not respond to `"+methodName+"' !!!");var args=slice.call(arguments,1);return callTraitMethod(this,m,args)},tryExec:function(methodName){var m=this._methods[methodName];if(validMethod(m)){var args=slice.call(arguments,1);return callTraitMethod(this,m,args)}},respondsTo:function(methodName){return validMethod(this._methods[methodName])},methods:function(){return this._methods},clone:function(traits,extendMethods,custom){var args=slice.call(arguments,0);args.splice(0,0,this);return clone.apply(null,args)},slot:function(key,value){if(arguments.length==1){return this._shareStore[key]}else{this._shareStore[key]=value;return value}},hasOwnSlot:function(key){return this._shareStore.hasOwnProperty(key)},rmSlot:function(key){delete this._shareStore[key]},ownSlotKeys:function(){return Object.keys(this._shareStore)}};exports.Trait=Trait;exports.compose=compose;exports.Entity=Entity;exports.extendObjectByTrait=extendObjectByTrait}};__resources__["/__builtin__/painter/honestpainter.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var debug=require("debug");var assert=require("debug").assert;var abs=Math.abs;var pow=Math.pow;var CanvasEventObservables=require("canvaseventobservable").CanvasEventObservables;var geo=require("geometry");var helper=require("helper");var Klass=require("base").Klass,Trait=require("oo").Trait;var setLineStyle=function(ctx,m){if(m.slot("lineWidth")!=undefined)ctx.lineWidth=m.slot("lineWidth");if(m.slot("lineCap")!=undefined)ctx.lineCap=m.slot("lineCap");if(m.slot("lineJoin")!=undefined)ctx.lineJoin=m.slot("lineJoin");if(m.slot("miterLimit")!=undefined)ctx.miterLimit=m.slot("miterLimit");if(m.slot("lineDash")!=undefined)ctx.setLineDash(m.slot("lineDash"));if(m.slot("lineDashOffset")!=undefined)ctx.lineDashOffset=m.slot("lineDashOffset");if(m.slot("strokeStyle")!=undefined)ctx.strokeStyle=m.slot("strokeStyle")};var hvInsideTbl={model:function(m,x,y,painter){return false},circle:function(m,x,y,painter){var r=m.slot("radius");var d2=pow(x-r,2)+pow(y-r,2);return d2<=r*r},convex:function(m,x,y,painter){var vs=m.slot("vertexes");var len=vs.length;var accum=0;var diffSign=false;var onSide=false;for(var i=0;i<len;++i){var p1=vs[i];var p2=vs[(i+1)%len];var s=x-p1.x,t=y-p1.y;var u=x-p2.x,v=y-p2.y;var cross=s*v-t*u;var lastaccum=accum;if(cross>0){accum+=1}else if(cross===0){if(s*u<=0){onSide=true}}else{accum-=1}if(abs(accum)<abs(lastaccum)){diffSign=true;break}}if(diffSign){return false}if(accum===0){return onSide}return true},text:function(m,x,y,painter){return true},image:function(m,x,y,painter){return true}};var beginDrawMode=function(m,ctx){var oldStyles={fillStyle:ctx.fillStyle,strokeStyle:ctx.strokeStyle};var fillc=m.slot("fillStyle");debug.assert(typeof fillc=="string"||fillc==undefined,"color format changed to rgb(0, 0, 0)");if(fillc!==undefined){ctx.fillStyle=fillc}var sc=m.slot("strokeStyle");if(sc!==undefined){ctx.strokeStyle=sc}return oldStyles};var endDrawMode=function(m,ctx,oldStyles){ctx.fillStyle=oldStyles.fillStyle;ctx.strokeStyle=oldStyles.strokeStyle};var hvDraw={model:function(m,painter){},circle:function(m,painter,spad){var ctx=spad||painter.slot("_ctx");var r=m.slot("radius");var oldStyles=beginDrawMode(m,ctx);ctx.translate(r,r);ctx.beginPath();ctx.arc(0,0,r,Math.PI*2,0,true);ctx.closePath();var oldAlpha=ctx.globalAlpha;if(m.slot("fillStyle")!=undefined){if(m.slot("fillAlpha")!=undefined)ctx.globalAlpha=m.slot("fillAlpha");ctx.fill();ctx.globalAlpha=oldAlpha}if(m.slot("strokeStyle")!=undefined){if(m.slot("strokeAlpha")!=undefined)ctx.globalAlpha=m.slot("strokeAlpha");ctx.stroke();ctx.globalAlpha=oldAlpha}endDrawMode(m,ctx,oldStyles);ctx.translate(-r,-r)},convex:function(m,painter,spad){var ctx=spad||painter.slot("_ctx");var vs=m.slot("vertexes");var oldStyles=beginDrawMode(m,ctx);ctx.beginPath();if(vs.length>0)ctx.moveTo(vs[0].x,vs[0].y);for(var i=0;i<vs.length;++i){var p=vs[i];ctx.lineTo(p.x,p.y)}ctx.closePath();var oldAlpha=ctx.globalAlpha;if(m.slot("fillStyle")!=undefined){if(m.slot("fillAlpha")!=undefined)ctx.globalAlpha=m.slot("fillAlpha");ctx.fill();ctx.globalAlpha=oldAlpha}if(m.slot("strokeStyle")!=undefined){setLineStyle(ctx,m);if(m.slot("strokeAlpha")!=undefined)ctx.globalAlpha=m.slot("strokeAlpha");ctx.stroke();ctx.globalAlpha=oldAlpha}endDrawMode(m,ctx,oldStyles)},text:function(m,painter,spad){var ctx=spad||painter.slot("_ctx");var str=m.slot("text");var oldStyles=beginDrawMode(m,ctx);var oldFont=ctx.font;var font=m.slot("font");var sFont=helper.joinFont(font);ctx.font=sFont;var oldTextAlign=ctx.textAlign;ctx.textAlign=m.slot("textAlign");var oldTextBaseline=ctx.textBaseline;ctx.textBaseline="top";ctx.fillText(str,0,0);ctx.textBaseline=oldTextBaseline;ctx.font=oldFont;ctx.textAlign=oldTextAlign;endDrawMode(m,ctx,oldStyles)},image:function(m,painter,spad){var ctx=spad||painter.slot("_ctx");var i=m.slot("image");if((i.complete||i.readyState==="complete")&&i.naturalWidth!=0){var w=m.slot("width");var h=m.slot("height");var alpha=m.slot("alpha");var gAlpha=ctx.globalAlpha;if(alpha!=gAlpha){ctx.globalAlpha*=alpha}ctx.drawImage(i,0,0,i.width,i.height,0,0,w,h);ctx.globalAlpha=gAlpha}else{if(painter.exec("showUnloadedImage")){ctx.fillStyle="white";ctx.fillRect(0,0,m.width,m.height);var oldWidth=ctx.lineWidth;ctx.lineWidth=5;ctx.fillStyle="blue";ctx.strokeStyle="blue";ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(m.width-1,m.height-1);ctx.moveTo(m.width-1,0);ctx.lineTo(0,m.height-1);ctx.stroke();var oldFont=ctx.font;var oldTextBaseline=ctx.textBaseline;ctx.font="32 Arial";ctx.textBaseline="top";ctx.fillText("未加载\n的图片",0,0);ctx.font=oldFont;ctx.textBaseline=oldTextBaseline}}}};var doEffect=function(painter,effect){var ctx=painter.exec("getContext","2d");if(effect.alpha!=undefined)ctx.globalAlpha*=effect.alpha};var honestPainterTrait=Trait.extend({initialize:function(param){this.execProto("initialize");this.slot("_canvas",param);this.slot("_ctx",param.getContext("2d"));this.slot("_showUnloadedImage",true)},sketchpad:function(){return this.slot("_canvas")},getContext:function(contextId){return this.slot("_canvas").getContext(contextId)},bbox:function(m){return m.exec("bbox",this)},inside:function(m,p){var bbox=this.exec("bbox",m);var x=p.x,y=p.y;if(bbox.origin.x<=x&&x<bbox.origin.x+bbox.size.width&&bbox.origin.y<=y&&y<bbox.origin.y+bbox.size.height){var f=hvInsideTbl[m.slot("type")];assert(f,"no inside function for the `"+m.slot("type")+"' of model");return f(m,x,y,this)}else{return false}},showUnloadedImage:function(flag){if(flag===undefined){return this.slot("_showUnloadedImage")}else{this.slot("_showUnloadedImage",flag);return flag}},draw:function(m,spad){var ctx=spad||this.slot("_ctx");var t=m.slot("type");var f=hvDraw[t];assert(f,"no draw function for type `"+t+"'");ctx.save();f(m,this,ctx);ctx.restore()},clear:function(){var ctx=this.slot("_ctx");ctx.clearRect(0,0,this.slot("_canvas").width,this.slot("_canvas").height)},drawModel:function(model,effect){var t=model.slot("type");var f=hvDraw[t];var mat=effect.matrix;var ctx=this.slot("_ctx");ctx.save();doEffect(this,effect);ctx.transform(mat.a,mat.b,mat.c,mat.d,Math.round(mat.tx),Math.round(mat.ty));f(model,this);ctx.restore()},drawModels:function(ms){var self=this;ms.forEach(function(mp){self.exec("drawModel",mp.model,mp.effect)})},drawDispList:function(list){var ctx=this.slot("_ctx");for(var i=0;i<list.length;++i){var mat=list[i][0];var m=list[i][1];var t=m.slot("type");var f=hvDraw[t];ctx.save();assert(f,"no draw function for type `"+t+"'");ctx.transform(mat.a,mat.b,mat.c,mat.d,Math.round(mat.tx),Math.round(mat.ty));f(m,this);ctx.restore()}},canvasEventObservables:function(){if(!this.slot("_canvasEventObservables")){this.slot("_canvasEventObservables",new CanvasEventObservables(this.exec("sketchpad")))}return this.slot("_canvasEventObservables")}});var HonestPainter=Klass.extend([honestPainterTrait]);HonestPainter.register=function(type,fs){assert(!hvDraw[type],type+" has already exist in draw functions table");assert(!hvInsideTbl[type],type+" has already exist in inside functions table");assert(fs.bbox===undefined,"you should Override model's bbox function");hvDraw[type]=fs.draw;hvInsideTbl[type]=fs.inside;return fs};hvDraw=hvDraw;hvInsideTbl=hvInsideTbl;exports.HonestPainter=HonestPainter}};__resources__["/__builtin__/painter/index.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){exports.HonestPainter=require("./honestpainter").HonestPainter}};__resources__["/__builtin__/path.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var path={dirname:function(path){var tokens=path.split("/");tokens.pop();return tokens.join("/")},basename:function(path){var tokens=path.split("/");return tokens[tokens.length-1]},join:function(){return module.exports.normalize(Array.prototype.join.call(arguments,"/"))},exists:function(path){return __resources__[path]!==undefined},normalizeArray:function(parts,keepBlanks){var directories=[],prev;for(var i=0,l=parts.length-1;i<=l;i++){var directory=parts[i];if(directory===""&&i!==0&&i!==l&&!keepBlanks)continue;if(directory==="."&&prev!==undefined)continue;if(directories.length===1&&directories[0]===""&&(directory==="."||directory===".."))continue;if(directory===".."&&directories.length&&prev!==".."&&prev!=="."&&prev!==undefined&&(prev!==""||keepBlanks)){directories.pop();prev=directories.slice(-1)[0]}else{if(prev===".")directories.pop();directories.push(directory);prev=directory}}return directories},normalize:function(path,keepBlanks){return module.exports.normalizeArray(path.split("/"),keepBlanks).join("/")}};module.exports=path}};__resources__["/__builtin__/platform.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var ex={domReady:function(){if(this._isReady){return}if(!document.body){setTimeout(function(){ex.domReady()},13);return}window.__isReady=true;if(window.__readyList){var fn,i=0;while(fn=window.__readyList[i++]){fn.call(document)}window.__readyList=null}},bindReady:function(){if(window.__readyBound){return}window.__readyBound=true;if(document.readyState==="complete"){return ex.domReady()}if(document.addEventListener){window.addEventListener("load",ex.domReady,false)}else if(document.attachEvent){window.attachEvent("onload",ex.domReady)}},ready:function(func){if(window.__isReady){func()}else{if(!window.__readyList){window.__readyList=[]}window.__readyList.push(func)}if(!document.createElement("canvas").getContext)require("excanvas");ex.bindReady()}};module.exports=ex}};__resources__["/__builtin__/rx/index.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){exports.rx=require("./rx");exports.html=require("./rx.html");exports.helper=require("./rx.helper");exports.aggregates=require("./rx.aggregates");exports.time=require("./rx.time");exports.binding=require("./rx.binding")}};__resources__["/__builtin__/rx/rx.aggregates.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){(function(root,factory){var freeExports=typeof exports=="object"&&exports,freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module,freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal}if(typeof module==="object"&&module&&module.exports===freeExports){module.exports=factory(root,module.exports,require("./rx"))}else{root.Rx=factory(root,{},root.Rx)}})(this,function(global,exp,Rx,undefined){var Observable=Rx.Observable,observableProto=Observable.prototype,CompositeDisposable=Rx.CompositeDisposable,AnonymousObservable=Rx.Internals.AnonymousObservable;var argumentOutOfRange="Argument out of range";var sequenceContainsNoElements="Sequence contains no elements.";function defaultComparer(x,y){return x===y}function identity(x){return x}function subComparer(x,y){if(x>y){return 1}if(x===y){return 0}return-1}function extremaBy(source,keySelector,comparer){return new AnonymousObservable(function(observer){var hasValue=false,lastKey=null,list=[];return source.subscribe(function(x){var comparison,key;try{key=keySelector(x)}catch(ex){observer.onError(ex);return}comparison=0;if(!hasValue){hasValue=true;lastKey=key}else{try{comparison=comparer(key,lastKey)}catch(ex1){observer.onError(ex1);return}}if(comparison>0){lastKey=key;list=[]}if(comparison>=0){list.push(x)}},observer.onError.bind(observer),function(){observer.onNext(list);observer.onCompleted()})})}function firstOnly(x){if(x.length===0){throw new Error(sequenceContainsNoElements)}return x[0]}observableProto.aggregate=function(){var seed,hasSeed,accumulator;if(arguments.length===2){seed=arguments[0];hasSeed=true;accumulator=arguments[1]}else{accumulator=arguments[0]}return hasSeed?this.scan(seed,accumulator).startWith(seed).finalValue():this.scan(accumulator).finalValue()};observableProto.reduce=function(){var seed,hasSeed,accumulator=arguments[0];if(arguments.length===2){hasSeed=true;seed=arguments[1]}return hasSeed?this.scan(seed,accumulator).startWith(seed).finalValue():this.scan(accumulator).finalValue()};observableProto.any=function(predicate,thisArg){var source=this;return predicate?source.where(predicate,thisArg).any():new AnonymousObservable(function(observer){return source.subscribe(function(){observer.onNext(true);observer.onCompleted()},observer.onError.bind(observer),function(){observer.onNext(false);observer.onCompleted()})})};observableProto.some=observableProto.any;observableProto.isEmpty=function(){return this.any().select(function(b){return!b})};observableProto.all=function(predicate,thisArg){return this.where(function(v){return!predicate(v)},thisArg).any().select(function(b){return!b})};observableProto.every=observableProto.all;observableProto.contains=function(value,comparer){comparer||(comparer=defaultComparer);return this.where(function(v){return comparer(v,value)}).any()};observableProto.count=function(predicate){return predicate?this.where(predicate).count():this.aggregate(0,function(count){return count+1})};observableProto.sum=function(keySelector){return keySelector?this.select(keySelector).sum():this.aggregate(0,function(prev,curr){return prev+curr})};observableProto.minBy=function(keySelector,comparer){comparer||(comparer=subComparer);return extremaBy(this,keySelector,function(x,y){return comparer(x,y)*-1})};observableProto.min=function(comparer){return this.minBy(identity,comparer).select(function(x){return firstOnly(x)})};observableProto.maxBy=function(keySelector,comparer){comparer||(comparer=subComparer);return extremaBy(this,keySelector,comparer)};observableProto.max=function(comparer){return this.maxBy(identity,comparer).select(function(x){return firstOnly(x)})};observableProto.average=function(keySelector){return keySelector?this.select(keySelector).average():this.scan({sum:0,count:0},function(prev,cur){return{sum:prev.sum+cur,count:prev.count+1}}).finalValue().select(function(s){return s.sum/s.count})};function sequenceEqualArray(first,second,comparer){return new AnonymousObservable(function(observer){var count=0,len=second.length;return first.subscribe(function(value){var equal=false;try{if(count<len){equal=comparer(value,second[count++])}}catch(e){observer.onError(e);return}if(!equal){observer.onNext(false);observer.onCompleted()}},observer.onError.bind(observer),function(){observer.onNext(count===len);observer.onCompleted()})})}observableProto.sequenceEqual=function(second,comparer){var first=this;comparer||(comparer=defaultComparer);if(Array.isArray(second)){return sequenceEqualArray(first,second,comparer)}return new AnonymousObservable(function(observer){var donel=false,doner=false,ql=[],qr=[];var subscription1=first.subscribe(function(x){var equal,v;if(qr.length>0){v=qr.shift();try{equal=comparer(v,x)}catch(e){observer.onError(e);return}if(!equal){observer.onNext(false);observer.onCompleted()}}else if(doner){observer.onNext(false);observer.onCompleted()}else{ql.push(x)}},observer.onError.bind(observer),function(){donel=true;if(ql.length===0){if(qr.length>0){observer.onNext(false);observer.onCompleted()}else if(doner){observer.onNext(true);observer.onCompleted()}}});var subscription2=second.subscribe(function(x){var equal,v;if(ql.length>0){v=ql.shift();try{equal=comparer(v,x)}catch(exception){observer.onError(exception);return}if(!equal){observer.onNext(false);observer.onCompleted()}}else if(donel){observer.onNext(false);observer.onCompleted()}else{qr.push(x)}},observer.onError.bind(observer),function(){doner=true;if(qr.length===0){if(ql.length>0){observer.onNext(false);observer.onCompleted()}else if(donel){observer.onNext(true);observer.onCompleted()}}});return new CompositeDisposable(subscription1,subscription2)})};function elementAtOrDefault(source,index,hasDefault,defaultValue){if(index<0){throw new Error(argumentOutOfRange)}return new AnonymousObservable(function(observer){var i=index;return source.subscribe(function(x){if(i===0){observer.onNext(x);observer.onCompleted()}i--},observer.onError.bind(observer),function(){if(!hasDefault){observer.onError(new Error(argumentOutOfRange))}else{observer.onNext(defaultValue);observer.onCompleted()}})})}observableProto.elementAt=function(index){return elementAtOrDefault(this,index,false)};observableProto.elementAtOrDefault=function(index,defaultValue){return elementAtOrDefault(this,index,true,defaultValue)};function singleOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(observer){var value=defaultValue,seenValue=false;return source.subscribe(function(x){if(seenValue){observer.onError(new Error("Sequence contains more than one element"))}else{value=x;seenValue=true}},observer.onError.bind(observer),function(){if(!seenValue&&!hasDefault){observer.onError(new Error(sequenceContainsNoElements))}else{observer.onNext(value);observer.onCompleted()}})})}observableProto.single=function(predicate){if(predicate){return this.where(predicate).single()}return singleOrDefaultAsync(this,false)};observableProto.singleOrDefault=function(predicate,defaultValue){if(predicate){return this.where(predicate).singleOrDefault(null,defaultValue)}return singleOrDefaultAsync(this,true,defaultValue)};function firstOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(observer){return source.subscribe(function(x){observer.onNext(x);observer.onCompleted()},observer.onError.bind(observer),function(){if(!hasDefault){observer.onError(new Error(sequenceContainsNoElements))}else{observer.onNext(defaultValue);observer.onCompleted()}})})}observableProto.first=function(predicate){if(predicate){return this.where(predicate).first()}return firstOrDefaultAsync(this,false)};observableProto.firstOrDefault=function(predicate,defaultValue){if(predicate){return this.where(predicate).firstOrDefault(null,defaultValue)}return firstOrDefaultAsync(this,true,defaultValue)};function lastOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(observer){var value=defaultValue,seenValue=false;return source.subscribe(function(x){value=x;seenValue=true},observer.onError.bind(observer),function(){if(!seenValue&&!hasDefault){observer.onError(new Error(sequenceContainsNoElements))}else{observer.onNext(value);observer.onCompleted()}})})}observableProto.last=function(predicate){if(predicate){return this.where(predicate).last()}return lastOrDefaultAsync(this,false)};observableProto.lastOrDefault=function(predicate,defaultValue){if(predicate){return this.where(predicate).lastOrDefault(null,defaultValue)}return lastOrDefaultAsync(this,true,defaultValue)};function findValue(source,predicate,thisArg,yieldIndex){return new AnonymousObservable(function(observer){return source.subscribe(function(x){if(predicate.call(thisArg,x,i,source)){observer.onNext(yieldIndex?i:x);observer.onCompleted()}else{i++}},observer.onError.bind(observer),function(){observer.onNext(yieldIndex?-1:undefined);observer.onCompleted()})})}observableProto.find=function(predicate){return findValue(this,predicate,arguments[1],false)};observableProto.findIndex=function(predicate){return findValue(this,predicate,arguments[1],true)};return Rx})}};__resources__["/__builtin__/rx/rx.binding.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){(function(root,factory){var freeExports=typeof exports=="object"&&exports,freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module,freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal}if(typeof module==="object"&&module&&module.exports===freeExports){module.exports=factory(root,module.exports,require("./rx"))}else{root.Rx=factory(root,{},root.Rx)}})(this,function(global,exp,Rx,undefined){var Observable=Rx.Observable,observableProto=Observable.prototype,AnonymousObservable=Rx.Internals.AnonymousObservable,Subject=Rx.Subject,AsyncSubject=Rx.AsyncSubject,Observer=Rx.Observer,ScheduledObserver=Rx.Internals.ScheduledObserver,disposableCreate=Rx.Disposable.create,disposableEmpty=Rx.Disposable.empty,CompositeDisposable=Rx.CompositeDisposable,currentThreadScheduler=Rx.Scheduler.currentThread,inherits=Rx.Internals.inherits,addProperties=Rx.Internals.addProperties;var objectDisposed="Object has been disposed";function checkDisposed(){if(this.isDisposed){throw new Error(objectDisposed)}}observableProto.multicast=function(subjectOrSubjectSelector,selector){var source=this;return typeof subjectOrSubjectSelector==="function"?new AnonymousObservable(function(observer){var connectable=source.multicast(subjectOrSubjectSelector());return new CompositeDisposable(selector(connectable).subscribe(observer),connectable.connect())}):new ConnectableObservable(source,subjectOrSubjectSelector)};observableProto.publish=function(selector){return!selector?this.multicast(new Subject):this.multicast(function(){return new Subject},selector)};observableProto.publishLast=function(selector){return!selector?this.multicast(new AsyncSubject):this.multicast(function(){return new AsyncSubject},selector)};observableProto.publishValue=function(initialValueOrSelector,initialValue){return arguments.length===2?this.multicast(function(){return new BehaviorSubject(initialValue)},initialValueOrSelector):this.multicast(new BehaviorSubject(initialValueOrSelector))};observableProto.replay=function(selector,bufferSize,window,scheduler){return!selector?this.multicast(new ReplaySubject(bufferSize,window,scheduler)):this.multicast(function(){return new ReplaySubject(bufferSize,window,scheduler)},selector)};var InnerSubscription=function(subject,observer){this.subject=subject;this.observer=observer};InnerSubscription.prototype.dispose=function(){if(!this.subject.isDisposed&&this.observer!==null){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1);this.observer=null}};var BehaviorSubject=Rx.BehaviorSubject=function(_super){function subscribe(observer){var ex;checkDisposed.call(this);if(!this.isStopped){this.observers.push(observer);observer.onNext(this.value);return new InnerSubscription(this,observer)}ex=this.exception;if(ex){observer.onError(ex)}else{observer.onCompleted()}return disposableEmpty}inherits(BehaviorSubject,_super);function BehaviorSubject(value){_super.call(this,subscribe);this.value=value,this.observers=[],this.isDisposed=false,this.isStopped=false,this.exception=null}addProperties(BehaviorSubject.prototype,Observer,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;for(var i=0,len=os.length;i<len;i++){os[i].onCompleted()}this.observers=[]}},onError:function(error){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;this.exception=error;for(var i=0,len=os.length;i<len;i++){os[i].onError(error)}this.observers=[]}},onNext:function(value){checkDisposed.call(this);if(!this.isStopped){this.value=value;var os=this.observers.slice(0);for(var i=0,len=os.length;i<len;i++){os[i].onNext(value)}}},dispose:function(){this.isDisposed=true;this.observers=null;this.value=null;this.exception=null}});return BehaviorSubject}(Observable);var ReplaySubject=Rx.ReplaySubject=function(_super){var RemovableDisposable=function(subject,observer){this.subject=subject;this.observer=observer};RemovableDisposable.prototype.dispose=function(){this.observer.dispose();if(!this.subject.isDisposed){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1)}};function subscribe(observer){var so=new ScheduledObserver(this.scheduler,observer),subscription=new RemovableDisposable(this,so);checkDisposed.call(this);this._trim(this.scheduler.now());this.observers.push(so);var n=this.q.length;for(var i=0,len=this.q.length;i<len;i++){so.onNext(this.q[i].value)}if(this.hasError){n++;so.onError(this.error)}else if(this.isStopped){n++;so.onCompleted()}so.ensureActive(n);return subscription}inherits(ReplaySubject,_super);function ReplaySubject(bufferSize,window,scheduler){this.bufferSize=bufferSize==null?Number.MAX_VALUE:bufferSize;this.window=window==null?Number.MAX_VALUE:window;this.scheduler=scheduler||currentThreadScheduler;this.q=[];this.observers=[];this.isStopped=false;this.isDisposed=false;this.hasError=false;this.error=null;_super.call(this,subscribe)}addProperties(ReplaySubject.prototype,Observer,{hasObservers:function(){return this.observers.length>0},_trim:function(now){while(this.q.length>this.bufferSize){this.q.shift()}while(this.q.length>0&&now-this.q[0].interval>this.window){this.q.shift()}},onNext:function(value){var observer;checkDisposed.call(this);if(!this.isStopped){var now=this.scheduler.now();this.q.push({interval:now,value:value});this._trim(now);var o=this.observers.slice(0);for(var i=0,len=o.length;i<len;i++){observer=o[i];observer.onNext(value);observer.ensureActive()}}},onError:function(error){var observer;checkDisposed.call(this);if(!this.isStopped){this.isStopped=true;this.error=error;this.hasError=true;var now=this.scheduler.now();this._trim(now);var o=this.observers.slice(0);for(var i=0,len=o.length;i<len;i++){observer=o[i];observer.onError(error);observer.ensureActive()}this.observers=[]}},onCompleted:function(){var observer;checkDisposed.call(this);if(!this.isStopped){this.isStopped=true;var now=this.scheduler.now();this._trim(now);var o=this.observers.slice(0);for(var i=0,len=o.length;i<len;i++){observer=o[i];observer.onCompleted();observer.ensureActive()}this.observers=[]}},dispose:function(){this.isDisposed=true;this.observers=null}});return ReplaySubject}(Observable);var ConnectableObservable=function(_super){inherits(ConnectableObservable,_super);function ConnectableObservable(source,subject){var state={subject:subject,source:source.asObservable(),hasSubscription:false,subscription:null};this.connect=function(){if(!state.hasSubscription){state.hasSubscription=true;state.subscription=new CompositeDisposable(state.source.subscribe(state.subject),disposableCreate(function(){state.hasSubscription=false}))}return state.subscription};function subscribe(observer){return state.subject.subscribe(observer)}_super.call(this,subscribe)}ConnectableObservable.prototype.connect=function(){return this.connect()};ConnectableObservable.prototype.refCount=function(){var connectableSubscription=null,count=0,source=this;return new AnonymousObservable(function(observer){var shouldConnect,subscription;count++;shouldConnect=count===1;subscription=source.subscribe(observer);if(shouldConnect){connectableSubscription=source.connect()}return disposableCreate(function(){subscription.dispose();count--;if(count===0){connectableSubscription.dispose()}})})};return ConnectableObservable}(Observable);return Rx})}};__resources__["/__builtin__/rx/rx.helper.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){(function(root,factory){var freeExports=typeof exports=="object"&&exports&&(typeof root=="object"&&root&&root==root.global&&(window=root),exports);if(typeof module=="object"&&module&&module.exports==freeExports){var rxroot=factory(root,module.exports,require("./rx"));module.exports=rxroot}else{root.Rx=factory(root,{},root.Rx)}})(this,function(global,exports,root,undefined){var Observable=root.Observable,observableProto=Observable.prototype,observableCreateWithDisposable=Observable.createWithDisposable,disposableCreate=root.Disposable.create,CompositeDisposable=root.CompositeDisposable,RefCountDisposable=root.RefCountDisposable,AsyncSubject=root.AsyncSubject;Observable.prototype.then=function(selector,eventName){return this.select(selector).switchLatest()};return root})}};__resources__["/__builtin__/rx/rx.html.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){(function(root,factory){var freeExports=typeof exports=="object"&&exports&&(typeof root=="object"&&root&&root==root.global&&(window=root),exports);if(typeof module=="object"&&module&&module.exports==freeExports){var rxroot=factory(root,module.exports,require("./rx"));module.exports=rxroot}else{root.Rx=factory(root,{},root.Rx)}})(this,function(global,exports,root,undefined){var Observable=root.Observable,observableProto=Observable.prototype,observableCreateWithDisposable=Observable.createWithDisposable,disposableCreate=root.Disposable.create,CompositeDisposable=root.CompositeDisposable,RefCountDisposable=root.RefCountDisposable,AsyncSubject=root.AsyncSubject;var createEventListener=function(el,eventName,handler){var disposables=new CompositeDisposable,createListener=function(element,eventName,handler){if(element.addEventListener){element.addEventListener(eventName,handler,false);return disposableCreate(function(){element.removeEventListener(eventName,handler,false)})}else if(element.attachEvent){element.attachEvent("on"+eventName,handler);return disposableCreate(function(){element.detachEvent("on"+eventName,handler)})}else{element["on"+eventName]=handler;return disposableCreate(function(){element["on"+eventName]=null})}};if(el&&el.nodeName||el===global){disposables.add(createListener(el,eventName,handler))}else if(el&&el.length){for(var i=0,len=el.length;i<len;i++){disposables.add(createEventListener(el[i],eventName,handler))}}return disposables};Observable.fromEvent=function(element,eventName){return observableCreateWithDisposable(function(observer){var handler=function(e){observer.onNext(e)};return createEventListener(element,eventName,handler)})};var destroy=function(){var trash=document.createElement("div");return function(element){trash.appendChild(element);trash.innerHTML=""}}();Observable.getJSONPRequest=function(){var uniqueId=0;return function(url){var subject=new AsyncSubject,head=document.getElementsByTagName("head")[0]||document.documentElement,tag=document.createElement("script"),handler="rxjscallback"+uniqueId++,url=url.replace("=JSONPCallback","="+handler);global[handler]=function(data){subject.onNext(data);subject.onCompleted()};tag.src=url;tag.async=true;tag.onload=tag.onreadystatechange=function(_,abort){if(abort||!tag.readyState||/loaded|complete/.test(tag.readyState)){tag.onload=tag.onreadystatechange=null;if(head&&tag.parentNode){destroy(tag)}tag=undefined;delete global[handler]}};head.insertBefore(tag,head.firstChild);var refCount=new RefCountDisposable(disposableCreate(function(){if(!/loaded|complete/.test(tag.readyState)){tag.abort();tag.onload=tag.onreadystatechange=null;if(head&&tag.parentNode){destroy(tag)}tag=undefined;delete global[handler];subject.onError(new Error("The script has been aborted"))}}));return observableCreateWithDisposable(function(subscriber){return new CompositeDisposable(subject.subscribe(subscriber),refCount.getDisposable())})}}();function getXMLHttpRequest(){if(global.XMLHttpRequest){return new global.XMLHttpRequest}else{try{return new global.ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}}var observableAjax=Observable.ajax=function(settings){if(typeof settings==="string"){settings={method:"GET",url:settings,async:true}}if(settings.async===undefined){settings.async=true}var subject=new AsyncSubject,xhr=getXMLHttpRequest();if(settings.headers){var headers=settings.headers,header;for(header in headers){xhr.setRequestHeader(header,headers[header])}}try{if(details.user){xhr.open(settings.method,settings.url,settings.async,settings.user,settings.password)}else{xhr.open(settings.method,settings.url,settings.async)}xhr.onreadystatechange=xhr.onload=function(){if(xhr.readyState===4){var status=xhr.status;if(status>=200&&status<=300||status===0||status===""){subject.onNext(xhr);subject.onCompleted()}else{subject.onError(xhr)}}};xhr.onerror=xhr.onabort=function(){subject.onError(xhr)};xhr.send(settings.body||null)}catch(e){subject.onError(e)}var refCount=new RefCountDisposable(disposableCreate(function(){if(xhr.readyState!==4){xhr.abort();subject.onError(xhr)}}));return observableCreateWithDisposable(function(subscriber){return new CompositeDisposable(subject.subscribe(subscriber),refCount.getDisposable())})};Observable.post=function(url,body){return observableAjax({url:url,body:body,method:"POST",async:true})};var observableGet=Observable.get=function(url){return observableAjax({url:url,method:"GET",async:true})};if(typeof window.JSON!=="undefined"){Observable.getJSON=function(url){return observableGet(url).select(function(xhr){return JSON.parse(xhr.responseText)})}}return root})}};__resources__["/__builtin__/rx/rx.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){(function(window1,undefined){var freeExports=typeof exports=="object"&&exports,freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module,freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal}var Rx={Internals:{}};function noop(){}function identity(x){return x}function defaultNow(){return(new Date).getTime()}function defaultComparer(x,y){return x===y}function defaultSubComparer(x,y){return x-y}function defaultKeySerializer(x){return x.toString()}function defaultError(err){throw err}var sequenceContainsNoElements="Sequence contains no elements.";var argumentOutOfRange="Argument out of range";var objectDisposed="Object has been disposed";function checkDisposed(){if(this.isDisposed){throw new Error(objectDisposed)}}var slice=Array.prototype.slice;function argsOrArray(args,idx){return args.length===1&&Array.isArray(args[idx])?args[idx]:slice.call(args)}var hasProp={}.hasOwnProperty;var inherits=this.inherits=Rx.Internals.inherits=function(child,parent){function __(){this.constructor=child}__.prototype=parent.prototype;child.prototype=new __};var addProperties=Rx.Internals.addProperties=function(obj){var sources=slice.call(arguments,1);for(var i=0,len=sources.length;i<len;i++){var source=sources[i];for(var prop in source){obj[prop]=source[prop]}}};var addRef=Rx.Internals.addRef=function(xs,r){return new AnonymousObservable(function(observer){return new CompositeDisposable(r.getDisposable(),xs.subscribe(observer))})};function arrayInitialize(count,factory){var a=new Array(count);for(var i=0;i<count;i++){a[i]=factory()}return a}if(!Function.prototype.bind){Function.prototype.bind=function(that){var target=this,args=slice.call(arguments,1);var bound=function(){if(this instanceof bound){function F(){}F.prototype=target.prototype;var self=new F;var result=target.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result){return result}return self}else{return target.apply(that,args.concat(slice.call(arguments)))}};return bound}}var boxedString=Object("a"),splitString=boxedString[0]!="a"||!(0 in boxedString);if(!Array.prototype.every){Array.prototype.every=function every(fun){var object=Object(this),self=splitString&&{}.toString.call(this)=="[object String]"?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if({}.toString.call(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}for(var i=0;i<length;i++){if(i in self&&!fun.call(thisp,self[i],i,object)){return false}}return true}}if(!Array.prototype.map){Array.prototype.map=function map(fun){var object=Object(this),self=splitString&&{}.toString.call(this)=="[object String]"?this.split(""):object,length=self.length>>>0,result=Array(length),thisp=arguments[1];if({}.toString.call(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}for(var i=0;i<length;i++){if(i in self)result[i]=fun.call(thisp,self[i],i,object)}return result}}if(!Array.prototype.filter){Array.prototype.filter=function(predicate){var results=[],item,t=new Object(this);for(var i=0,len=t.length>>>0;i<len;i++){item=t[i];if(i in t&&predicate.call(arguments[1],item,i,t)){results.push(item)}}return results}}if(!Array.isArray){Array.isArray=function(arg){return Object.prototype.toString.call(arg)=="[object Array]"}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function indexOf(searchElement){var t=Object(this);var len=t.length>>>0;if(len===0){return-1}var n=0;if(arguments.length>1){n=Number(arguments[1]);if(n!==n){n=0}else if(n!==0&&n!=Infinity&&n!==-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n))}}if(n>=len){return-1}var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k}}return-1}}var IndexedItem=function(id,value){this.id=id;this.value=value};IndexedItem.prototype.compareTo=function(other){var c=this.value.compareTo(other.value);if(c===0){c=this.id-other.id}return c};var PriorityQueue=function(capacity){this.items=new Array(capacity);this.length=0};var priorityProto=PriorityQueue.prototype;priorityProto.isHigherPriority=function(left,right){return this.items[left].compareTo(this.items[right])<0};priorityProto.percolate=function(index){if(index>=this.length||index<0){return}var parent=index-1>>1;if(parent<0||parent===index){return}if(this.isHigherPriority(index,parent)){var temp=this.items[index];this.items[index]=this.items[parent];this.items[parent]=temp;this.percolate(parent)}};priorityProto.heapify=function(index){if(index===undefined){index=0}if(index>=this.length||index<0){return}var left=2*index+1,right=2*index+2,first=index;if(left<this.length&&this.isHigherPriority(left,first)){first=left}if(right<this.length&&this.isHigherPriority(right,first)){first=right}if(first!==index){var temp=this.items[index];this.items[index]=this.items[first];this.items[first]=temp;this.heapify(first)}};priorityProto.peek=function(){return this.items[0].value};priorityProto.removeAt=function(index){this.items[index]=this.items[--this.length];delete this.items[this.length];this.heapify()};priorityProto.dequeue=function(){var result=this.peek();this.removeAt(0);return result};priorityProto.enqueue=function(item){var index=this.length++;this.items[index]=new IndexedItem(PriorityQueue.count++,item);this.percolate(index)};priorityProto.remove=function(item){for(var i=0;i<this.length;i++){if(this.items[i].value===item){this.removeAt(i);return true}}return false};PriorityQueue.count=0;var CompositeDisposable=Rx.CompositeDisposable=function(){this.disposables=argsOrArray(arguments,0);this.isDisposed=false;this.length=this.disposables.length};var CompositeDisposablePrototype=CompositeDisposable.prototype;CompositeDisposablePrototype.add=function(item){if(this.isDisposed){item.dispose()}else{this.disposables.push(item);this.length++}};CompositeDisposablePrototype.remove=function(item){var shouldDispose=false;if(!this.isDisposed){var idx=this.disposables.indexOf(item);if(idx!==-1){shouldDispose=true;this.disposables.splice(idx,1);this.length--;item.dispose()}}return shouldDispose};CompositeDisposablePrototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var currentDisposables=this.disposables.slice(0);this.disposables=[];this.length=0;for(var i=0,len=currentDisposables.length;i<len;i++){currentDisposables[i].dispose()}}};CompositeDisposablePrototype.clear=function(){var currentDisposables=this.disposables.slice(0);this.disposables=[];this.length=0;for(var i=0,len=currentDisposables.length;i<len;i++){currentDisposables[i].dispose()}};CompositeDisposablePrototype.contains=function(item){return this.disposables.indexOf(item)!==-1};CompositeDisposablePrototype.toArray=function(){return this.disposables.slice(0)};var Disposable=Rx.Disposable=function(action){this.isDisposed=false;this.action=action};Disposable.prototype.dispose=function(){if(!this.isDisposed){this.action();this.isDisposed=true}};var disposableCreate=Disposable.create=function(action){return new Disposable(action)};var disposableEmpty=Disposable.empty={dispose:noop};var SingleAssignmentDisposable=Rx.SingleAssignmentDisposable=function(){this.isDisposed=false;this.current=null};var SingleAssignmentDisposablePrototype=SingleAssignmentDisposable.prototype;SingleAssignmentDisposablePrototype.disposable=function(value){return!value?this.getDisposable():this.setDisposable(value)};SingleAssignmentDisposablePrototype.getDisposable=function(){return this.current};SingleAssignmentDisposablePrototype.setDisposable=function(value){if(this.current){throw new Error("Disposable has already been assigned")}var shouldDispose=this.isDisposed;if(!shouldDispose){this.current=value}if(shouldDispose&&value){value.dispose()}};SingleAssignmentDisposablePrototype.dispose=function(){var old;if(!this.isDisposed){this.isDisposed=true;old=this.current;this.current=null}if(old){old.dispose()}};var SerialDisposable=Rx.SerialDisposable=function(){this.isDisposed=false;this.current=null};SerialDisposable.prototype.getDisposable=function(){return this.current};SerialDisposable.prototype.setDisposable=function(value){var shouldDispose=this.isDisposed,old;if(!shouldDispose){old=this.current;this.current=value}if(old){old.dispose()}if(shouldDispose&&value){value.dispose()}};SerialDisposable.prototype.disposable=function(value){if(!value){return this.getDisposable()}else{this.setDisposable(value)}};SerialDisposable.prototype.dispose=function(){var old;if(!this.isDisposed){this.isDisposed=true;old=this.current;this.current=null}if(old){old.dispose()}};var RefCountDisposable=Rx.RefCountDisposable=function(){function InnerDisposable(disposable){this.disposable=disposable;this.disposable.count++;this.isInnerDisposed=false}InnerDisposable.prototype.dispose=function(){if(!this.disposable.isDisposed){if(!this.isInnerDisposed){this.isInnerDisposed=true;this.disposable.count--;if(this.disposable.count===0&&this.disposable.isPrimaryDisposed){this.disposable.isDisposed=true;this.disposable.underlyingDisposable.dispose()}}}};function RefCountDisposable(disposable){this.underlyingDisposable=disposable;this.isDisposed=false;this.isPrimaryDisposed=false;this.count=0}RefCountDisposable.prototype.dispose=function(){if(!this.isDisposed){if(!this.isPrimaryDisposed){this.isPrimaryDisposed=true;if(this.count===0){this.isDisposed=true;this.underlyingDisposable.dispose()}}}};RefCountDisposable.prototype.getDisposable=function(){return this.isDisposed?disposableEmpty:new InnerDisposable(this)};return RefCountDisposable}();function ScheduledDisposable(scheduler,disposable){this.scheduler=scheduler,this.disposable=disposable,this.isDisposed=false}ScheduledDisposable.prototype.dispose=function(){var parent=this;this.scheduler.schedule(function(){if(!parent.isDisposed){parent.isDisposed=true;parent.disposable.dispose()}})};function ScheduledItem(scheduler,state,action,dueTime,comparer){this.scheduler=scheduler;this.state=state;this.action=action;this.dueTime=dueTime;this.comparer=comparer||defaultSubComparer;this.disposable=new SingleAssignmentDisposable}ScheduledItem.prototype.invoke=function(){this.disposable.disposable(this.invokeCore())};ScheduledItem.prototype.compareTo=function(other){return this.comparer(this.dueTime,other.dueTime)};ScheduledItem.prototype.isCancelled=function(){return this.disposable.isDisposed};ScheduledItem.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var Scheduler=Rx.Scheduler=function(){function Scheduler(now,schedule,scheduleRelative,scheduleAbsolute){this.now=now;this._schedule=schedule;this._scheduleRelative=scheduleRelative;this._scheduleAbsolute=scheduleAbsolute}function invokeRecImmediate(scheduler,pair){var state=pair.first,action=pair.second,group=new CompositeDisposable,recursiveAction=function(state1){action(state1,function(state2){var isAdded=false,isDone=false,d=scheduler.scheduleWithState(state2,function(scheduler1,state3){if(isAdded){group.remove(d)}else{isDone=true}recursiveAction(state3);return disposableEmpty});if(!isDone){group.add(d);isAdded=true}})};recursiveAction(state);return group}function invokeRecDate(scheduler,pair,method){var state=pair.first,action=pair.second,group=new CompositeDisposable,recursiveAction=function(state1){action(state1,function(state2,dueTime1){var isAdded=false,isDone=false,d=scheduler[method].call(scheduler,state2,dueTime1,function(scheduler1,state3){if(isAdded){group.remove(d)}else{isDone=true}recursiveAction(state3);return disposableEmpty});if(!isDone){group.add(d);isAdded=true}})};recursiveAction(state);return group}function invokeAction(scheduler,action){action();return disposableEmpty}var schedulerProto=Scheduler.prototype;schedulerProto.catchException=function(handler){return new CatchScheduler(this,handler)};schedulerProto.schedulePeriodic=function(period,action){return this.schedulePeriodicWithState(null,period,function(){action()})};schedulerProto.schedulePeriodicWithState=function(state,period,action){var s=state,id=window.setInterval(function(){s=action(s)},period);return disposableCreate(function(){window.clearInterval(id)})};schedulerProto.schedule=function(action){return this._schedule(action,invokeAction)};schedulerProto.scheduleWithState=function(state,action){return this._schedule(state,action)};schedulerProto.scheduleWithRelative=function(dueTime,action){return this._scheduleRelative(action,dueTime,invokeAction)};schedulerProto.scheduleWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative(state,dueTime,action)};schedulerProto.scheduleWithAbsolute=function(dueTime,action){return this._scheduleAbsolute(action,dueTime,invokeAction)};schedulerProto.scheduleWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute(state,dueTime,action)};schedulerProto.scheduleRecursive=function(action){return this.scheduleRecursiveWithState(action,function(_action,self){_action(function(){self(_action)})})};schedulerProto.scheduleRecursiveWithState=function(state,action){return this.scheduleWithState({first:state,second:action},function(s,p){return invokeRecImmediate(s,p)})};schedulerProto.scheduleRecursiveWithRelative=function(dueTime,action){return this.scheduleRecursiveWithRelativeAndState(action,dueTime,function(_action,self){_action(function(dt){self(_action,dt)})})};schedulerProto.scheduleRecursiveWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative({first:state,second:action},dueTime,function(s,p){return invokeRecDate(s,p,"scheduleWithRelativeAndState")})};schedulerProto.scheduleRecursiveWithAbsolute=function(dueTime,action){return this.scheduleRecursiveWithAbsoluteAndState(action,dueTime,function(_action,self){_action(function(dt){self(_action,dt)})})};schedulerProto.scheduleRecursiveWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute({first:state,second:action},dueTime,function(s,p){return invokeRecDate(s,p,"scheduleWithAbsoluteAndState")})};Scheduler.now=defaultNow;Scheduler.normalize=function(timeSpan){if(timeSpan<0){timeSpan=0}return timeSpan};return Scheduler}();var schedulerNoBlockError="Scheduler is not allowed to block the thread";var immediateScheduler=Scheduler.immediate=function(){function scheduleNow(state,action){return action(this,state)}function scheduleRelative(state,dueTime,action){if(dueTime>0)throw new Error(schedulerNoBlockError);return action(this,state)}function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action)}return new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute)}();var currentThreadScheduler=Scheduler.currentThread=function(){var queue;function Trampoline(){queue=new PriorityQueue(4)}Trampoline.prototype.dispose=function(){queue=null};Trampoline.prototype.run=function(){var item;while(queue.length>0){item=queue.dequeue();if(!item.isCancelled()){while(item.dueTime-Scheduler.now()>0){}if(!item.isCancelled()){item.invoke()}}}};function scheduleNow(state,action){return this.scheduleWithRelativeAndState(state,0,action)}function scheduleRelative(state,dueTime,action){var dt=this.now()+Scheduler.normalize(dueTime),si=new ScheduledItem(this,state,action,dt),t;if(!queue){t=new Trampoline;try{queue.enqueue(si);t.run()}catch(e){throw e}finally{t.dispose()}}else{queue.enqueue(si)}return si.disposable}function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action)}var currentScheduler=new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute);currentScheduler.scheduleRequired=function(){return queue===null};currentScheduler.ensureTrampoline=function(action){if(queue===null){return this.schedule(action)}else{return action()}};return currentScheduler}();var SchedulePeriodicRecursive=function(){function tick(command,recurse){recurse(0,this._period);try{this._state=this._action(this._state)}catch(e){this._cancel.dispose();throw e}}function SchedulePeriodicRecursive(scheduler,state,period,action){this._scheduler=scheduler;this._state=state;this._period=period;this._action=action}SchedulePeriodicRecursive.prototype.start=function(){var d=new SingleAssignmentDisposable;this._cancel=d;d.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,tick.bind(this)));return d};return SchedulePeriodicRecursive}();Rx.VirtualTimeScheduler=function(_super){function localNow(){return this.toDateTimeOffset(this.clock)}function scheduleNow(state,action){return this.scheduleAbsoluteWithState(state,this.clock,action)}function scheduleRelative(state,dueTime,action){return this.scheduleRelativeWithState(state,this.toRelative(dueTime),action)}function scheduleAbsolute(state,dueTime,action){return this.scheduleRelativeWithState(state,this.toRelative(dueTime-this.now()),action)}function invokeAction(scheduler,action){action();return disposableEmpty}inherits(VirtualTimeScheduler,_super);function VirtualTimeScheduler(initialClock,comparer){this.clock=initialClock;this.comparer=comparer;this.isEnabled=false;this.queue=new PriorityQueue(1024);_super.call(this,localNow,scheduleNow,scheduleRelative,scheduleAbsolute)}var VirtualTimeSchedulerPrototype=VirtualTimeScheduler.prototype;VirtualTimeSchedulerPrototype.schedulePeriodicWithState=function(state,period,action){var s=new SchedulePeriodicRecursive(this,state,period,action);return s.start()};VirtualTimeSchedulerPrototype.scheduleRelativeWithState=function(state,dueTime,action){var runAt=this.add(this.clock,dueTime);return this.scheduleAbsoluteWithState(state,runAt,action)};VirtualTimeSchedulerPrototype.scheduleRelative=function(dueTime,action){return this.scheduleRelativeWithState(action,dueTime,invokeAction)};VirtualTimeSchedulerPrototype.start=function(){var next;if(!this.isEnabled){this.isEnabled=true;do{next=this.getNext();if(next!==null){if(this.comparer(next.dueTime,this.clock)>0){this.clock=next.dueTime}next.invoke()}else{this.isEnabled=false}}while(this.isEnabled)}};VirtualTimeSchedulerPrototype.stop=function(){this.isEnabled=false};VirtualTimeSchedulerPrototype.advanceTo=function(time){var next;var dueToClock=this.comparer(this.clock,time);if(this.comparer(this.clock,time)>0){throw new Error(argumentOutOfRange)}if(dueToClock===0){return}if(!this.isEnabled){this.isEnabled=true;do{next=this.getNext();if(next!==null&&this.comparer(next.dueTime,time)<=0){if(this.comparer(next.dueTime,this.clock)>0){this.clock=next.dueTime}next.invoke()}else{this.isEnabled=false}}while(this.isEnabled);this.clock=time}};VirtualTimeSchedulerPrototype.advanceBy=function(time){var dt=this.add(this.clock,time);var dueToClock=this.comparer(this.clock,dt);if(dueToClock>0){throw new Error(argumentOutOfRange)}if(dueToClock===0){return}return this.advanceTo(dt)};VirtualTimeSchedulerPrototype.sleep=function(time){var dt=this.add(this.clock,time);if(this.comparer(this.clock,dt)>=0){throw new Error(argumentOutOfRange)}this.clock=dt};VirtualTimeSchedulerPrototype.getNext=function(){var next;while(this.queue.length>0){next=this.queue.peek();if(next.isCancelled()){this.queue.dequeue()}else{return next}}return null};VirtualTimeSchedulerPrototype.scheduleAbsolute=function(dueTime,action){return this.scheduleAbsoluteWithState(action,dueTime,invokeAction)};VirtualTimeSchedulerPrototype.scheduleAbsoluteWithState=function(state,dueTime,action){var self=this,run=function(scheduler,state1){self.queue.remove(si);return action(scheduler,state1)},si=new ScheduledItem(self,state,run,dueTime,self.comparer);self.queue.enqueue(si);return si.disposable};return VirtualTimeScheduler}(Scheduler);Rx.HistoricalScheduler=function(_super){inherits(HistoricalScheduler,_super);function HistoricalScheduler(initialClock,comparer){var clock=initialClock==null?0:initialClock;var cmp=comparer||defaultSubComparer;_super.call(this,clock,cmp)}var HistoricalSchedulerProto=HistoricalScheduler.prototype;HistoricalSchedulerProto.add=function(absolute,relative){return absolute+relative};HistoricalSchedulerProto.toDateTimeOffset=function(absolute){return(new Date(absolute)).getTime()};HistoricalSchedulerProto.toRelative=function(timeSpan){return timeSpan};return HistoricalScheduler}(Rx.VirtualTimeScheduler);var scheduleMethod,clearMethod=noop;(function(){function postMessageSupported(){if(!window.postMessage||window.importScripts){return false}var isAsync=false,oldHandler=window.onmessage;window.onmessage=function(){isAsync=true};window.postMessage("","*");window.onmessage=oldHandler;return isAsync}if(typeof window.process==="object"&&Object.prototype.toString.call(window.process)==="[object process]"){scheduleMethod=window.process.nextTick}else if(typeof window.setImmediate==="function"){scheduleMethod=window.setImmediate;clearMethod=window.clearImmediate}else if(postMessageSupported()){var MSG_PREFIX="ms.rx.schedule"+Math.random(),tasks={},taskId=0;function onGlobalPostMessage(event){if(typeof event.data==="string"&&event.data.substring(0,MSG_PREFIX.length)===MSG_PREFIX){var handleId=event.data.substring(MSG_PREFIX.length),action=tasks[handleId];action();delete tasks[handleId]}}if(window.addEventListener){window.addEventListener("message",onGlobalPostMessage,false)}else{window.attachEvent("onmessage",onGlobalPostMessage,false)}scheduleMethod=function(action){var currentId=taskId++;tasks[currentId]=action;window.postMessage(MSG_PREFIX+currentId,"*")}}else if(!!window.MessageChannel){var channel=new window.MessageChannel,channelTasks={},channelTaskId=0;channel.port1.onmessage=function(event){var id=event.data,action=channelTasks[id];action();delete channelTasks[id]};scheduleMethod=function(action){var id=channelTaskId++;channelTasks[id]=action;channel.port2.postMessage(id)}}else if("document"in window&&"onreadystatechange"in window.document.createElement("script")){scheduleMethod=function(action){var scriptElement=window.document.createElement("script");scriptElement.onreadystatechange=function(){action();scriptElement.onreadystatechange=null;scriptElement.parentNode.removeChild(scriptElement);scriptElement=null};window.document.documentElement.appendChild(scriptElement)}}else{scheduleMethod=function(action){return window.setTimeout(action,0)};clearMethod=window.clearTimeout}})();var timeoutScheduler=Scheduler.timeout=function(){function scheduleNow(state,action){var scheduler=this,disposable=new SingleAssignmentDisposable;var id=scheduleMethod(function(){if(!disposable.isDisposed){disposable.setDisposable(action(scheduler,state))}});return new CompositeDisposable(disposable,disposableCreate(function(){clearMethod(id)}))}function scheduleRelative(state,dueTime,action){var scheduler=this,dt=Scheduler.normalize(dueTime);if(dt===0){return scheduler.scheduleWithState(state,action)}var disposable=new SingleAssignmentDisposable;var id=window.setTimeout(function(){if(!disposable.isDisposed){disposable.setDisposable(action(scheduler,state))}},dt);return new CompositeDisposable(disposable,disposableCreate(function(){window.clearTimeout(id)}))}function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action)}return new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute)}();var CatchScheduler=function(_super){function localNow(){return this._scheduler.now()}function scheduleNow(state,action){return this._scheduler.scheduleWithState(state,this._wrap(action))}function scheduleRelative(state,dueTime,action){return this._scheduler.scheduleWithRelativeAndState(state,dueTime,this._wrap(action))}function scheduleAbsolute(state,dueTime,action){return this._scheduler.scheduleWithAbsoluteAndState(state,dueTime,this._wrap(action))}inherits(CatchScheduler,_super);function CatchScheduler(scheduler,handler){this._scheduler=scheduler;this._handler=handler;this._recursiveOriginal=null;this._recursiveWrapper=null;_super.call(this,localNow,scheduleNow,scheduleRelative,scheduleAbsolute)}CatchScheduler.prototype._clone=function(scheduler){return new CatchScheduler(scheduler,this._handler)};CatchScheduler.prototype._wrap=function(action){var parent=this;return function(self,state){try{return action(parent._getRecursiveWrapper(self),state)}catch(e){if(!parent._handler(e)){throw e}return disposableEmpty}}};CatchScheduler.prototype._getRecursiveWrapper=function(scheduler){if(this._recursiveOriginal!==scheduler){this._recursiveOriginal=scheduler;var wrapper=this._clone(scheduler);wrapper._recursiveOriginal=scheduler;wrapper._recursiveWrapper=wrapper;this._recursiveWrapper=wrapper}return this._recursiveWrapper};CatchScheduler.prototype.schedulePeriodicWithState=function(state,period,action){var self=this,failed=false,d=new SingleAssignmentDisposable;d.setDisposable(this._scheduler.schedulePeriodicWithState(state,period,function(state1){if(failed){return null}try{return action(state1)}catch(e){failed=true;if(!self._handler(e)){throw e}d.dispose();return null}}));return d};return CatchScheduler}(Scheduler);var Notification=Rx.Notification=function(){function Notification(kind,hasValue){this.hasValue=hasValue==null?false:hasValue;this.kind=kind}var NotificationPrototype=Notification.prototype;NotificationPrototype.accept=function(observerOrOnNext,onError,onCompleted){if(arguments.length===1&&typeof observerOrOnNext==="object"){return this._acceptObservable(observerOrOnNext)}return this._accept(observerOrOnNext,onError,onCompleted)};NotificationPrototype.toObservable=function(scheduler){var notification=this;scheduler=scheduler||immediateScheduler;return new AnonymousObservable(function(observer){return scheduler.schedule(function(){notification._acceptObservable(observer);if(notification.kind==="N"){observer.onCompleted()}})})};NotificationPrototype.equals=function(other){var otherString=other==null?"":other.toString();return this.toString()===otherString};return Notification}();var notificationCreateOnNext=Notification.createOnNext=function(){function _accept(onNext){return onNext(this.value)}function _acceptObservable(observer){return observer.onNext(this.value)}function toString(){return"OnNext("+this.value+")"}return function(value){var notification=new Notification("N",true);notification.value=value;notification._accept=_accept.bind(notification);notification._acceptObservable=_acceptObservable.bind(notification);notification.toString=toString.bind(notification);return notification}}();var notificationCreateOnError=Notification.createOnError=function(){function _accept(onNext,onError){return onError(this.exception)}function _acceptObservable(observer){return observer.onError(this.exception)}function toString(){return"OnError("+this.exception+")"}return function(exception){var notification=new Notification("E");notification.exception=exception;notification._accept=_accept.bind(notification);notification._acceptObservable=_acceptObservable.bind(notification);notification.toString=toString.bind(notification);return notification}}();var notificationCreateOnCompleted=Notification.createOnCompleted=function(){function _accept(onNext,onError,onCompleted){return onCompleted()}function _acceptObservable(observer){return observer.onCompleted()}function toString(){return"OnCompleted()"}return function(){var notification=new Notification("C");notification._accept=_accept.bind(notification);notification._acceptObservable=_acceptObservable.bind(notification);notification.toString=toString.bind(notification);return notification}}();var Enumerator=Rx.Internals.Enumerator=function(moveNext,getCurrent,dispose){this.moveNext=moveNext;this.getCurrent=getCurrent;this.dispose=dispose};var enumeratorCreate=Enumerator.create=function(moveNext,getCurrent,dispose){var done=false;dispose||(dispose=noop);return new Enumerator(function(){if(done){return false}var result=moveNext();if(!result){done=true;dispose()}return result},function(){return getCurrent()},function(){if(!done){dispose();done=true}})};var Enumerable=Rx.Internals.Enumerable=function(){function Enumerable(getEnumerator){this.getEnumerator=getEnumerator}Enumerable.prototype.concat=function(){var sources=this;return new AnonymousObservable(function(observer){var e=sources.getEnumerator(),isDisposed=false,subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursive(function(self){var current,ex,hasNext=false;if(!isDisposed){try{hasNext=e.moveNext();if(hasNext){current=e.getCurrent()}else{e.dispose()}}catch(exception){ex=exception;e.dispose()}}else{return}if(ex){observer.onError(ex);return}if(!hasNext){observer.onCompleted();return}var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),observer.onError.bind(observer),function(){self()}))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true;e.dispose()}))})};Enumerable.prototype.catchException=function(){var sources=this;return new AnonymousObservable(function(observer){var e=sources.getEnumerator(),isDisposed=false,lastException;var subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursive(function(self){var current,ex,hasNext;hasNext=false;if(!isDisposed){try{hasNext=e.moveNext();if(hasNext){current=e.getCurrent()}}catch(exception){ex=exception}}else{return}if(ex){observer.onError(ex);return}if(!hasNext){if(lastException){observer.onError(lastException)}else{observer.onCompleted()}return}var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),function(exn){lastException=exn;self()},observer.onCompleted.bind(observer)))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true}))})};return Enumerable}();var enumerableRepeat=Enumerable.repeat=function(value,repeatCount){if(repeatCount===undefined){repeatCount=-1}return new Enumerable(function(){var current,left=repeatCount;return enumeratorCreate(function(){if(left===0){return false}if(left>0){left--}current=value;return true},function(){return current})})};var enumerableFor=Enumerable.forEach=function(source,selector){selector||(selector=identity);return new Enumerable(function(){var current,index=-1;return enumeratorCreate(function(){if(++index<source.length){current=selector(source[index],index);return true}return false},function(){return current})})};var Observer=Rx.Observer=function(){};Observer.prototype.toNotifier=function(){var observer=this;return function(n){return n.accept(observer)}};Observer.prototype.asObserver=function(){return new AnonymousObserver(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))};Observer.prototype.checked=function(){return new CheckedObserver(this)};var observerCreate=Observer.create=function(onNext,onError,onCompleted){onNext||(onNext=noop);onError||(onError=defaultError);onCompleted||(onCompleted=noop);return new AnonymousObserver(onNext,onError,onCompleted)};Observer.fromNotifier=function(handler){return new AnonymousObserver(function(x){return handler(notificationCreateOnNext(x))},function(exception){return handler(notificationCreateOnError(exception))},function(){return handler(notificationCreateOnCompleted())})};var AbstractObserver=Rx.Internals.AbstractObserver=function(_super){inherits(AbstractObserver,_super);function AbstractObserver(){this.isStopped=false;_super.call(this)}AbstractObserver.prototype.onNext=function(value){if(!this.isStopped){this.next(value)}};AbstractObserver.prototype.onError=function(error){if(!this.isStopped){this.isStopped=true;this.error(error)}};AbstractObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.completed()}};AbstractObserver.prototype.dispose=function(){this.isStopped=true};AbstractObserver.prototype.fail=function(){if(!this.isStopped){this.isStopped=true;this.error(true);return true}return false};return AbstractObserver}(Observer);var AnonymousObserver=Rx.AnonymousObserver=function(_super){inherits(AnonymousObserver,_super);function AnonymousObserver(onNext,onError,onCompleted){_super.call(this);this._onNext=onNext;this._onError=onError;this._onCompleted=onCompleted}AnonymousObserver.prototype.next=function(value){this._onNext(value)};AnonymousObserver.prototype.error=function(exception){this._onError(exception)};AnonymousObserver.prototype.completed=function(){this._onCompleted()};return AnonymousObserver}(AbstractObserver);var CheckedObserver=function(_super){inherits(CheckedObserver,_super);function CheckedObserver(observer){_super.call(this);this._observer=observer;this._state=0}var CheckedObserverPrototype=CheckedObserver.prototype;CheckedObserverPrototype.onNext=function(value){this.checkAccess();try{this._observer.onNext(value)}catch(e){throw e}finally{this._state=0}};CheckedObserverPrototype.onError=function(err){this.checkAccess();try{this._observer.onError(err)}catch(e){throw e}finally{this._state=2}};CheckedObserverPrototype.onCompleted=function(){this.checkAccess();try{this._observer.onCompleted()}catch(e){throw e}finally{this._state=2}};CheckedObserverPrototype.checkAccess=function(){if(this._state===1){throw new Error("Re-entrancy detected")}if(this._state===2){throw new Error("Observer completed")}if(this._state===0){this._state=1}};return CheckedObserver}(Observer);var ScheduledObserver=Rx.Internals.ScheduledObserver=function(_super){inherits(ScheduledObserver,_super);function ScheduledObserver(scheduler,observer){_super.call(this);this.scheduler=scheduler;this.observer=observer;this.isAcquired=false;this.hasFaulted=false;this.queue=[];this.disposable=new SerialDisposable}ScheduledObserver.prototype.next=function(value){var self=this;this.queue.push(function(){self.observer.onNext(value)})};ScheduledObserver.prototype.error=function(exception){var self=this;this.queue.push(function(){self.observer.onError(exception)})};ScheduledObserver.prototype.completed=function(){var self=this;this.queue.push(function(){self.observer.onCompleted()})};ScheduledObserver.prototype.ensureActive=function(){var isOwner=false,parent=this;if(!this.hasFaulted&&this.queue.length>0){isOwner=!this.isAcquired;this.isAcquired=true}if(isOwner){this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(self){var work;if(parent.queue.length>0){work=parent.queue.shift()}else{parent.isAcquired=false;return}try{work()}catch(ex){parent.queue=[];parent.hasFaulted=true;throw ex}self()}))}};ScheduledObserver.prototype.dispose=function(){_super.prototype.dispose.call(this);this.disposable.dispose()};return ScheduledObserver}(AbstractObserver);var ObserveOnObserver=function(_super){inherits(ObserveOnObserver,_super);function ObserveOnObserver(){_super.apply(this,arguments)}ObserveOnObserver.prototype.next=function(value){_super.prototype.next.call(this,value);this.ensureActive()};ObserveOnObserver.prototype.error=function(e){_super.prototype.error.call(this,e);this.ensureActive()};ObserveOnObserver.prototype.completed=function(){_super.prototype.completed.call(this);this.ensureActive()};return ObserveOnObserver}(ScheduledObserver);var observableProto;var Observable=Rx.Observable=function(){function Observable(subscribe){this._subscribe=subscribe}observableProto=Observable.prototype;observableProto.finalValue=function(){var source=this;return new AnonymousObservable(function(observer){var hasValue=false,value;return source.subscribe(function(x){hasValue=true;value=x},observer.onError.bind(observer),function(){if(!hasValue){observer.onError(new Error(sequenceContainsNoElements))}else{observer.onNext(value);observer.onCompleted()}})})};observableProto.subscribe=observableProto.forEach=function(observerOrOnNext,onError,onCompleted){var subscriber;if(typeof observerOrOnNext==="object"){subscriber=observerOrOnNext}else{subscriber=observerCreate(observerOrOnNext,onError,onCompleted)}return this._subscribe(subscriber)};observableProto.toArray=function(){function accumulator(list,i){var newList=list.slice(0);newList.push(i);return newList}return this.scan([],accumulator).startWith([]).finalValue()};return Observable}();Observable.start=function(func,scheduler,context){return observableToAsync(func,scheduler)()};var observableToAsync=Observable.toAsync=function(func,scheduler,context){scheduler||(scheduler=timeoutScheduler);return function(){var args=slice.call(arguments,0),subject=new AsyncSubject;scheduler.schedule(function(){var result;try{result=func.apply(context,args)}catch(e){subject.onError(e);return}subject.onNext(result);subject.onCompleted()});return subject.asObservable()}};observableProto.observeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(new ObserveOnObserver(scheduler,observer))})};observableProto.subscribeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable,d=new SerialDisposable;d.setDisposable(m);m.setDisposable(scheduler.schedule(function(){d.setDisposable(new ScheduledDisposable(scheduler,source.subscribe(observer)))}));return d})};Observable.create=function(subscribe){return new AnonymousObservable(function(o){return disposableCreate(subscribe(o))})};Observable.createWithDisposable=function(subscribe){return new AnonymousObservable(subscribe)};var observableDefer=Observable.defer=function(observableFactory){return new AnonymousObservable(function(observer){var result;try{result=observableFactory()}catch(e){return observableThrow(e).subscribe(observer)}return result.subscribe(observer)})};var observableEmpty=Observable.empty=function(scheduler){scheduler||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.schedule(function(){observer.onCompleted()})})};var observableFromArray=Observable.fromArray=function(array,scheduler){scheduler||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(observer){var count=0;return scheduler.scheduleRecursive(function(self){if(count<array.length){observer.onNext(array[count++]);self()}else{observer.onCompleted()}})})};Observable.generate=function(initialState,condition,iterate,resultSelector,scheduler){scheduler||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(observer){var first=true,state=initialState;return scheduler.scheduleRecursive(function(self){var hasResult,result;try{if(first){first=false}else{state=iterate(state)}hasResult=condition(state);if(hasResult){result=resultSelector(state)}}catch(exception){observer.onError(exception);return}if(hasResult){observer.onNext(result);self()}else{observer.onCompleted()}})})};var observableNever=Observable.never=function(){return new AnonymousObservable(function(){return disposableEmpty})};Observable.range=function(start,count,scheduler){scheduler||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(observer){return scheduler.scheduleRecursiveWithState(0,function(i,self){if(i<count){observer.onNext(start+i);self(i+1)}else{observer.onCompleted()}})})};Observable.repeat=function(value,repeatCount,scheduler){scheduler||(scheduler=currentThreadScheduler);if(repeatCount==null){repeatCount=-1}return observableReturn(value,scheduler).repeat(repeatCount)};var observableReturn=Observable.returnValue=function(value,scheduler){scheduler||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.schedule(function(){observer.onNext(value);observer.onCompleted()})})};var observableThrow=Observable.throwException=function(exception,scheduler){scheduler||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.schedule(function(){observer.onError(exception)})})};Observable.using=function(resourceFactory,observableFactory){return new AnonymousObservable(function(observer){var disposable=disposableEmpty,resource,source;try{resource=resourceFactory();if(resource){disposable=resource}source=observableFactory(resource)}catch(exception){return new CompositeDisposable(observableThrow(exception).subscribe(observer),disposable)}return new CompositeDisposable(source.subscribe(observer),disposable)})};observableProto.amb=function(rightSource){var leftSource=this;return new AnonymousObservable(function(observer){var choice,leftChoice="L",rightChoice="R",leftSubscription=new SingleAssignmentDisposable,rightSubscription=new SingleAssignmentDisposable;function choiceL(){if(!choice){choice=leftChoice;rightSubscription.dispose()}}function choiceR(){if(!choice){choice=rightChoice;leftSubscription.dispose()}}leftSubscription.setDisposable(leftSource.subscribe(function(left){choiceL();if(choice===leftChoice){observer.onNext(left)}},function(err){choiceL();if(choice===leftChoice){observer.onError(err)}},function(){choiceL();if(choice===leftChoice){observer.onCompleted()}}));rightSubscription.setDisposable(rightSource.subscribe(function(right){choiceR();if(choice===rightChoice){observer.onNext(right)}},function(err){choiceR();if(choice===rightChoice){observer.onError(err)}},function(){choiceR();if(choice===rightChoice){observer.onCompleted()}}));return new CompositeDisposable(leftSubscription,rightSubscription)})};Observable.amb=function(){var acc=observableNever(),items=argsOrArray(arguments,0);function func(previous,current){return previous.amb(current)}for(var i=0,len=items.length;i<len;i++){acc=func(acc,items[i])}return acc};function observableCatchHandler(source,handler){return new AnonymousObservable(function(observer){var d1=new SingleAssignmentDisposable,subscription=new SerialDisposable;subscription.setDisposable(d1);d1.setDisposable(source.subscribe(observer.onNext.bind(observer),function(exception){var d,result;try{result=handler(exception)}catch(ex){observer.onError(ex);return}d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(result.subscribe(observer))},observer.onCompleted.bind(observer)));return subscription})}observableProto.catchException=function(handlerOrSecond){if(typeof handlerOrSecond==="function"){return observableCatchHandler(this,handlerOrSecond)}return observableCatch([this,handlerOrSecond])};var observableCatch=Observable.catchException=function(){var items=argsOrArray(arguments,0);return enumerableFor(items).catchException()};observableProto.combineLatest=function(){var args=slice.call(arguments);if(Array.isArray(args[0])){args[0].unshift(this)}else{args.unshift(this)}return combineLatest.apply(this,args)};var combineLatest=Observable.combineLatest=function(){var args=slice.call(arguments),resultSelector=args.pop();if(Array.isArray(args[0])){args=args[0]}return new AnonymousObservable(function(observer){var falseFactory=function(){return false},n=args.length,hasValue=arrayInitialize(n,falseFactory),hasValueAll=false,isDone=arrayInitialize(n,falseFactory),values=new Array(n);function next(i){var res;hasValue[i]=true;if(hasValueAll||(hasValueAll=hasValue.every(function(x){return x}))){try{res=resultSelector.apply(null,values)}catch(ex){observer.onError(ex);return}observer.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(function(x){return x})){observer.onCompleted()}}function done(i){isDone[i]=true;if(isDone.every(function(x){return x})){observer.onCompleted()}}var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){subscriptions[i]=new SingleAssignmentDisposable;subscriptions[i].setDisposable(args[i].subscribe(function(x){values[i]=x;next(i)},observer.onError.bind(observer),function(){done(i)}))})(idx)}return new CompositeDisposable(subscriptions)})};observableProto.concat=function(){var items=slice.call(arguments,0);items.unshift(this);return observableConcat.apply(this,items)};var observableConcat=Observable.concat=function(){var sources=argsOrArray(arguments,0);return enumerableFor(sources).concat()};observableProto.concatObservable=observableProto.concatAll=function(){return this.merge(1)};observableProto.merge=function(maxConcurrentOrOther){if(typeof maxConcurrentOrOther!=="number"){return observableMerge(this,maxConcurrentOrOther)}var sources=this;return new AnonymousObservable(function(observer){var activeCount=0,group=new CompositeDisposable,isStopped=false,q=[],subscribe=function(xs){var subscription=new SingleAssignmentDisposable;group.add(subscription);subscription.setDisposable(xs.subscribe(observer.onNext.bind(observer),observer.onError.bind(observer),function(){var s;group.remove(subscription);if(q.length>0){s=q.shift();subscribe(s)}else{activeCount--;if(isStopped&&activeCount===0){observer.onCompleted()}}}))};group.add(sources.subscribe(function(innerSource){if(activeCount<maxConcurrentOrOther){activeCount++;subscribe(innerSource)}else{q.push(innerSource)}},observer.onError.bind(observer),function(){isStopped=true;if(activeCount===0){observer.onCompleted()}}));return group})};var observableMerge=Observable.merge=function(){var scheduler,sources;if(!arguments[0]){scheduler=immediateScheduler;sources=slice.call(arguments,1)}else if(arguments[0].now){scheduler=arguments[0];sources=slice.call(arguments,1)}else{scheduler=immediateScheduler;sources=slice.call(arguments,0)}if(Array.isArray(sources[0])){sources=sources[0]}return observableFromArray(sources,scheduler).mergeObservable()};observableProto.mergeObservable=observableProto.mergeAll=function(){var sources=this;return new AnonymousObservable(function(observer){var group=new CompositeDisposable,isStopped=false,m=new SingleAssignmentDisposable;group.add(m);m.setDisposable(sources.subscribe(function(innerSource){var innerSubscription=new SingleAssignmentDisposable;group.add(innerSubscription);innerSubscription.setDisposable(innerSource.subscribe(function(x){observer.onNext(x)},observer.onError.bind(observer),function(){group.remove(innerSubscription);if(isStopped&&group.length===1){observer.onCompleted()}}))},observer.onError.bind(observer),function(){isStopped=true;if(group.length===1){observer.onCompleted()}}));return group})};observableProto.onErrorResumeNext=function(second){if(!second){throw new Error("Second observable is required")}return onErrorResumeNext([this,second])};var onErrorResumeNext=Observable.onErrorResumeNext=function(){var sources=argsOrArray(arguments,0);return new AnonymousObservable(function(observer){var pos=0,subscription=new SerialDisposable,cancelable=immediateScheduler.scheduleRecursive(function(self){var current,d;if(pos<sources.length){current=sources[pos++];d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),function(){self()},function(){self()}))}else{observer.onCompleted()}});return new CompositeDisposable(subscription,cancelable)})};observableProto.skipUntil=function(other){var source=this;return new AnonymousObservable(function(observer){var isOpen=false;var disposables=new CompositeDisposable(source.subscribe(function(left){if(isOpen){observer.onNext(left)}},observer.onError.bind(observer),function(){if(isOpen){observer.onCompleted()}}));var rightSubscription=new SingleAssignmentDisposable;disposables.add(rightSubscription);rightSubscription.setDisposable(other.subscribe(function(){isOpen=true;rightSubscription.dispose()},observer.onError.bind(observer),function(){rightSubscription.dispose()}));return disposables})};observableProto.switchLatest=function(){var sources=this;return new AnonymousObservable(function(observer){var hasLatest=false,innerSubscription=new SerialDisposable,isStopped=false,latest=0,subscription=sources.subscribe(function(innerSource){var d=new SingleAssignmentDisposable,id=++latest;hasLatest=true;innerSubscription.setDisposable(d);d.setDisposable(innerSource.subscribe(function(x){if(latest===id){observer.onNext(x)}},function(e){if(latest===id){observer.onError(e)}},function(){if(latest===id){hasLatest=false;if(isStopped){observer.onCompleted()}}}))},observer.onError.bind(observer),function(){isStopped=true;if(!hasLatest){observer.onCompleted()}});return new CompositeDisposable(subscription,innerSubscription)})};observableProto.takeUntil=function(other){var source=this;return new AnonymousObservable(function(observer){return new CompositeDisposable(source.subscribe(observer),other.subscribe(observer.onCompleted.bind(observer),observer.onError.bind(observer),noop))})};function zipArray(second,resultSelector){var first=this;return new AnonymousObservable(function(observer){var index=0,len=second.length;return first.subscribe(function(left){if(index<len){var right=second[index++],result;try{result=resultSelector(left,right)}catch(e){observer.onError(e);return}observer.onNext(result)}else{observer.onCompleted()}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})}observableProto.zip=function(){if(Array.isArray(arguments[0])){return zipArray.apply(this,arguments)}var parent=this,sources=slice.call(arguments),resultSelector=sources.pop();sources.unshift(parent);return new AnonymousObservable(function(observer){var n=sources.length,queues=arrayInitialize(n,function(){return[]}),isDone=arrayInitialize(n,function(){return false});var next=function(i){var res,queuedValues;if(queues.every(function(x){return x.length>0})){try{queuedValues=queues.map(function(x){return x.shift()});res=resultSelector.apply(parent,queuedValues)}catch(ex){observer.onError(ex);return}observer.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(function(x){return x})){observer.onCompleted()}};function done(i){isDone[i]=true;if(isDone.every(function(x){return x})){observer.onCompleted()}}var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){subscriptions[i]=new SingleAssignmentDisposable;subscriptions[i].setDisposable(sources[i].subscribe(function(x){queues[i].push(x);next(i)},observer.onError.bind(observer),function(){done(i)}))})(idx)}return new CompositeDisposable(subscriptions)})};Observable.zip=function(sources,resultSelector){var first=sources[0],rest=sources.slice(1);rest.push(resultSelector);return first.zip.apply(first,rest)};observableProto.asObservable=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(observer)})};observableProto.bufferWithCount=function(count,skip){if(skip===undefined){skip=count}return this.windowWithCount(count,skip).selectMany(function(x){return x.toArray()}).where(function(x){return x.length>0})};observableProto.dematerialize=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(function(x){return x.accept(observer)},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.distinctUntilChanged=function(keySelector,comparer){var source=this;keySelector||(keySelector=identity);comparer||(comparer=defaultComparer);return new AnonymousObservable(function(observer){var hasCurrentKey=false,currentKey;return source.subscribe(function(value){var comparerEquals=false,key;try{key=keySelector(value)}catch(exception){observer.onError(exception);return}if(hasCurrentKey){try{comparerEquals=comparer(currentKey,key)}catch(exception){observer.onError(exception);return}}if(!hasCurrentKey||!comparerEquals){hasCurrentKey=true;currentKey=key;observer.onNext(value)}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.doAction=function(observerOrOnNext,onError,onCompleted){var source=this,onNextFunc;if(typeof observerOrOnNext==="function"){onNextFunc=observerOrOnNext}else{onNextFunc=observerOrOnNext.onNext.bind(observerOrOnNext);onError=observerOrOnNext.onError.bind(observerOrOnNext);onCompleted=observerOrOnNext.onCompleted.bind(observerOrOnNext)}return new AnonymousObservable(function(observer){return source.subscribe(function(x){try{onNextFunc(x)}catch(e){observer.onError(e)}observer.onNext(x)},function(exception){if(!onError){observer.onError(exception)}else{try{onError(exception)}catch(e){observer.onError(e)}observer.onError(exception)}},function(){if(!onCompleted){observer.onCompleted()}else{try{onCompleted()}catch(e){observer.onError(e)}observer.onCompleted()}})})};observableProto.finallyAction=function(action){var source=this;return new AnonymousObservable(function(observer){var subscription=source.subscribe(observer);return disposableCreate(function(){try{subscription.dispose()}catch(e){throw e}finally{action()}})})};observableProto.ignoreElements=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(noop,observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.materialize=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(function(value){observer.onNext(notificationCreateOnNext(value))},function(exception){observer.onNext(notificationCreateOnError(exception));observer.onCompleted()},function(){observer.onNext(notificationCreateOnCompleted());observer.onCompleted()})})};observableProto.repeat=function(repeatCount){return enumerableRepeat(this,repeatCount).concat()};observableProto.retry=function(retryCount){return enumerableRepeat(this,retryCount).catchException()};observableProto.scan=function(){var seed,hasSeed=false,accumulator;if(arguments.length===2){seed=arguments[0];accumulator=arguments[1];hasSeed=true}else{accumulator=arguments[0]}var source=this;return observableDefer(function(){var hasAccumulation=false,accumulation;return source.select(function(x){if(hasAccumulation){accumulation=accumulator(accumulation,x)}else{accumulation=hasSeed?accumulator(seed,x):x;hasAccumulation=true}return accumulation})})};observableProto.skipLast=function(count){var source=this;return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){q.push(x);if(q.length>count){observer.onNext(q.shift())}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.startWith=function(){var values,scheduler,start=0;if(!!arguments.length&&"now"in Object(arguments[0])){scheduler=arguments[0];start=1}else{scheduler=immediateScheduler}values=slice.call(arguments,start);return enumerableFor([observableFromArray(values,scheduler),this]).concat()};observableProto.takeLast=function(count,scheduler){return this.takeLastBuffer(count).selectMany(function(xs){return observableFromArray(xs,scheduler)})};observableProto.takeLastBuffer=function(count){var source=this;return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){q.push(x);if(q.length>count){q.shift()}},observer.onError.bind(observer),function(){observer.onNext(q);observer.onCompleted()})})};observableProto.windowWithCount=function(count,skip){var source=this;if(count<=0){throw new Error(argumentOutOfRange)}if(skip==null){skip=count}if(skip<=0){throw new Error(argumentOutOfRange)}return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable,refCountDisposable=new RefCountDisposable(m),n=0,q=[],createWindow=function(){var s=new Subject;q.push(s);observer.onNext(addRef(s,refCountDisposable))};createWindow();m.setDisposable(source.subscribe(function(x){var s;for(var i=0,len=q.length;i<len;i++){q[i].onNext(x)}var c=n-count+1;if(c>=0&&c%skip===0){s=q.shift();s.onCompleted()}n++;if(n%skip===0){createWindow()}},function(exception){while(q.length>0){q.shift().onError(exception)}observer.onError(exception)},function(){while(q.length>0){q.shift().onCompleted()}observer.onCompleted()}));return refCountDisposable})};observableProto.defaultIfEmpty=function(defaultValue){var source=this;if(defaultValue===undefined){defaultValue=null}return new AnonymousObservable(function(observer){var found=false;return source.subscribe(function(x){found=true;observer.onNext(x)},observer.onError.bind(observer),function(){if(!found){observer.onNext(defaultValue)}observer.onCompleted()})})};observableProto.distinct=function(keySelector,keySerializer){var source=this;keySelector||(keySelector=identity);keySerializer||(keySerializer=defaultKeySerializer);return new AnonymousObservable(function(observer){var hashSet={};return source.subscribe(function(x){var key,serializedKey,otherKey,hasMatch=false;try{key=keySelector(x);serializedKey=keySerializer(key)}catch(exception){observer.onError(exception);return}for(otherKey in hashSet){if(serializedKey===otherKey){hasMatch=true;break}}if(!hasMatch){hashSet[serializedKey]=null;observer.onNext(x)}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.groupBy=function(keySelector,elementSelector,keySerializer){return this.groupByUntil(keySelector,elementSelector,function(){return observableNever()},keySerializer)};observableProto.groupByUntil=function(keySelector,elementSelector,durationSelector,keySerializer){var source=this;elementSelector||(elementSelector=identity);keySerializer||(keySerializer=defaultKeySerializer);return new AnonymousObservable(function(observer){var map={},groupDisposable=new CompositeDisposable,refCountDisposable=new RefCountDisposable(groupDisposable);groupDisposable.add(source.subscribe(function(x){var duration,durationGroup,element,fireNewMapEntry,group,key,serializedKey,md,writer,w;try{key=keySelector(x);serializedKey=keySerializer(key)}catch(e){for(w in map){map[w].onError(e)}observer.onError(e);return}fireNewMapEntry=false;try{writer=map[serializedKey];if(!writer){writer=new Subject;map[serializedKey]=writer;fireNewMapEntry=true}}catch(e){for(w in map){map[w].onError(e)}observer.onError(e);return}if(fireNewMapEntry){group=new GroupedObservable(key,writer,refCountDisposable);durationGroup=new GroupedObservable(key,writer);try{duration=durationSelector(durationGroup)}catch(e){for(w in map){map[w].onError(e)}observer.onError(e);return}observer.onNext(group);md=new SingleAssignmentDisposable;groupDisposable.add(md);var expire=function(){if(serializedKey in map){delete map[serializedKey];writer.onCompleted()}groupDisposable.remove(md)};md.setDisposable(duration.take(1).subscribe(noop,function(exn){for(w in map){map[w].onError(exn)}observer.onError(exn)},function(){expire()}))}try{element=elementSelector(x)}catch(e){for(w in map){map[w].onError(e)}observer.onError(e);return}writer.onNext(element)},function(ex){for(var w in map){map[w].onError(ex)}observer.onError(ex)},function(){for(var w in map){map[w].onCompleted()}observer.onCompleted()}));return refCountDisposable})};observableProto.select=function(selector,thisArg){var parent=this;return new AnonymousObservable(function(observer){var count=0;return parent.subscribe(function(value){var result;try{result=selector.call(thisArg,value,count++,parent)}catch(exception){observer.onError(exception);return}observer.onNext(result)},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.map=observableProto.select;function selectMany(selector){return this.select(selector).mergeObservable()}observableProto.selectMany=observableProto.flatMap=function(selector,resultSelector){if(resultSelector){return this.selectMany(function(x){return selector(x).select(function(y){return resultSelector(x,y)})})}if(typeof selector==="function"){return selectMany.call(this,selector)}return selectMany.call(this,function(){return selector})};observableProto.skip=function(count){if(count<0){throw new Error(argumentOutOfRange)}var observable=this;return new AnonymousObservable(function(observer){var remaining=count;return observable.subscribe(function(x){if(remaining<=0){observer.onNext(x)}else{remaining--}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.skipWhile=function(predicate){var source=this;return new AnonymousObservable(function(observer){var i=0,running=false;return source.subscribe(function(x){if(!running){try{running=!predicate(x,i++)}catch(e){observer.onError(e);return}}if(running){observer.onNext(x)}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.take=function(count,scheduler){if(count<0){throw new Error(argumentOutOfRange)}if(count===0){return observableEmpty(scheduler)}var observable=this;return new AnonymousObservable(function(observer){var remaining=count;return observable.subscribe(function(x){if(remaining>0){remaining--;observer.onNext(x);if(remaining===0){observer.onCompleted()}}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.takeWhile=function(predicate){var observable=this;return new AnonymousObservable(function(observer){var i=0,running=true;return observable.subscribe(function(x){if(running){try{running=predicate(x,i++)}catch(e){observer.onError(e);return}if(running){observer.onNext(x)}else{observer.onCompleted()}}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.where=function(predicate,thisArg){var parent=this;return new AnonymousObservable(function(observer){var count=0;return parent.subscribe(function(value){var shouldRun;try{shouldRun=predicate.call(thisArg,value,count++,parent)}catch(exception){observer.onError(exception);return}if(shouldRun){observer.onNext(value)}},observer.onError.bind(observer),observer.onCompleted.bind(observer))})};observableProto.filter=observableProto.where;var AnonymousObservable=Rx.Internals.AnonymousObservable=function(_super){inherits(AnonymousObservable,_super);function AnonymousObservable(subscribe){if(!(this instanceof AnonymousObservable)){return new AnonymousObservable(subscribe)}function s(observer){var autoDetachObserver=new AutoDetachObserver(observer);if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.schedule(function(){try{autoDetachObserver.disposable(subscribe(autoDetachObserver))}catch(e){if(!autoDetachObserver.fail(e)){throw e}}})}else{try{autoDetachObserver.disposable(subscribe(autoDetachObserver))}catch(e){if(!autoDetachObserver.fail(e)){throw e}}}return autoDetachObserver}_super.call(this,s)}return AnonymousObservable}(Observable);var AutoDetachObserver=function(_super){inherits(AutoDetachObserver,_super);function AutoDetachObserver(observer){_super.call(this);this.observer=observer;this.m=new SingleAssignmentDisposable}var AutoDetachObserverPrototype=AutoDetachObserver.prototype;AutoDetachObserverPrototype.next=function(value){var noError=false;try{this.observer.onNext(value);noError=true}catch(e){throw e}finally{if(!noError){this.dispose()}}};AutoDetachObserverPrototype.error=function(exn){try{this.observer.onError(exn)}catch(e){throw e}finally{this.dispose()}};AutoDetachObserverPrototype.completed=function(){try{this.observer.onCompleted()}catch(e){throw e}finally{this.dispose()}};AutoDetachObserverPrototype.disposable=function(value){return this.m.disposable(value)};AutoDetachObserverPrototype.dispose=function(){_super.prototype.dispose.call(this);this.m.dispose()};return AutoDetachObserver}(AbstractObserver);var GroupedObservable=function(_super){inherits(GroupedObservable,_super);function subscribe(observer){return this.underlyingObservable.subscribe(observer)}function GroupedObservable(key,underlyingObservable,mergedDisposable){_super.call(this,subscribe);this.key=key;this.underlyingObservable=!mergedDisposable?underlyingObservable:new AnonymousObservable(function(observer){return new CompositeDisposable(mergedDisposable.getDisposable(),underlyingObservable.subscribe(observer))})}return GroupedObservable}(Observable);var InnerSubscription=function(subject,observer){this.subject=subject;this.observer=observer};InnerSubscription.prototype.dispose=function(){if(!this.subject.isDisposed&&this.observer!==null){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1);this.observer=null}};var Subject=Rx.Subject=function(_super){function subscribe(observer){checkDisposed.call(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer)}if(this.exception){observer.onError(this.exception);return disposableEmpty}observer.onCompleted();return disposableEmpty}inherits(Subject,_super);function Subject(){_super.call(this,subscribe);this.isDisposed=false,this.isStopped=false,this.observers=[]}addProperties(Subject.prototype,Observer,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;for(var i=0,len=os.length;i<len;i++){os[i].onCompleted()}this.observers=[]}},onError:function(exception){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;this.exception=exception;for(var i=0,len=os.length;i<len;i++){os[i].onError(exception)}this.observers=[]}},onNext:function(value){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);for(var i=0,len=os.length;i<len;i++){os[i].onNext(value)}}},dispose:function(){this.isDisposed=true;this.observers=null}});Subject.create=function(observer,observable){return new AnonymousSubject(observer,observable)};return Subject}(Observable);var AsyncSubject=Rx.AsyncSubject=function(_super){function subscribe(observer){checkDisposed.call(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer)}var ex=this.exception;var hv=this.hasValue;var v=this.value;if(ex){observer.onError(ex)}else if(hv){observer.onNext(v);observer.onCompleted()}else{observer.onCompleted()}return disposableEmpty}inherits(AsyncSubject,_super);function AsyncSubject(){_super.call(this,subscribe);this.isDisposed=false,this.isStopped=false,this.value=null,this.hasValue=false,this.observers=[],this.exception=null}addProperties(AsyncSubject.prototype,Observer,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){var o,i,len;checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;var v=this.value;var hv=this.hasValue;if(hv){for(i=0,len=os.length;i<len;i++){o=os[i];o.onNext(v);o.onCompleted()}}else{for(i=0,len=os.length;i<len;i++){os[i].onCompleted()}}this.observers=[]}},onError:function(exception){checkDisposed.call(this);if(!this.isStopped){var os=this.observers.slice(0);this.isStopped=true;this.exception=exception;for(var i=0,len=os.length;i<len;i++){os[i].onError(exception)}this.observers=[]}},onNext:function(value){checkDisposed.call(this);if(!this.isStopped){this.value=value;this.hasValue=true}},dispose:function(){this.isDisposed=true;this.observers=null;this.exception=null;this.value=null}});return AsyncSubject}(Observable);var AnonymousSubject=function(_super){inherits(AnonymousSubject,_super);function subscribe(observer){return this.observable.subscribe(observer)}function AnonymousSubject(observer,observable){_super.call(this,subscribe);this.observer=observer;this.observable=observable}addProperties(AnonymousSubject.prototype,Observer,{onCompleted:function(){this.observer.onCompleted()},onError:function(exception){this.observer.onError(exception)},onNext:function(value){this.observer.onNext(value)}});return AnonymousSubject}(Observable);if(freeExports){if(typeof module=="object"&&module&&module.exports==freeExports){module.exports=Rx}else{freeExports=Rx}}else{window.Rx=Rx}})(this)}};__resources__["/__builtin__/rx/rx.time.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){(function(root,factory){var freeExports=typeof exports=="object"&&exports,freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module,freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal){window=freeGlobal}if(typeof module==="object"&&module&&module.exports===freeExports){module.exports=factory(root,module.exports,require("./rx"))}else{root.Rx=factory(root,{},root.Rx)}})(this,function(global,exp,Rx,undefined){var Observable=Rx.Observable,observableProto=Observable.prototype,AnonymousObservable=Rx.Internals.AnonymousObservable,observableDefer=Observable.defer,observableEmpty=Observable.empty,observableThrow=Observable.throwException,observableFromArray=Observable.fromArray,timeoutScheduler=Rx.Scheduler.timeout,SingleAssignmentDisposable=Rx.SingleAssignmentDisposable,SerialDisposable=Rx.SerialDisposable,CompositeDisposable=Rx.CompositeDisposable,RefCountDisposable=Rx.RefCountDisposable,Subject=Rx.Subject,BinaryObserver=Rx.Internals.BinaryObserver,addRef=Rx.Internals.addRef,normalizeTime=Rx.Scheduler.normalize;function observableTimerDate(dueTime,scheduler){return new AnonymousObservable(function(observer){return scheduler.scheduleWithAbsolute(dueTime,function(){observer.onNext(0);observer.onCompleted()})})}function observableTimerDateAndPeriod(dueTime,period,scheduler){var p=normalizeTime(period);return new AnonymousObservable(function(observer){var count=0,d=dueTime;return scheduler.scheduleRecursiveWithAbsolute(d,function(self){var now;if(p>0){now=scheduler.now();d=d+p;if(d<=now){d=now+p}}observer.onNext(count++);self(d)})})}function observableTimerTimeSpan(dueTime,scheduler){var d=normalizeTime(dueTime);return new AnonymousObservable(function(observer){return scheduler.scheduleWithRelative(d,function(){observer.onNext(0);observer.onCompleted()})})}function observableTimerTimeSpanAndPeriod(dueTime,period,scheduler){if(dueTime===period){return new AnonymousObservable(function(observer){return scheduler.schedulePeriodicWithState(0,period,function(count){observer.onNext(count);return count+1})})}return observableDefer(function(){return observableTimerDateAndPeriod(scheduler.now()+dueTime,period,scheduler)})}var observableinterval=Observable.interval=function(period,scheduler){scheduler||(scheduler=timeoutScheduler);return observableTimerTimeSpanAndPeriod(period,period,scheduler)};var observableTimer=Observable.timer=function(dueTime,periodOrScheduler,scheduler){var period;scheduler||(scheduler=timeoutScheduler);if(periodOrScheduler!==undefined&&typeof periodOrScheduler==="number"){period=periodOrScheduler}else if(periodOrScheduler!==undefined&&typeof periodOrScheduler==="object"){scheduler=periodOrScheduler}if(dueTime instanceof Date&&period===undefined){return observableTimerDate(dueTime.getTime(),scheduler)}if(dueTime instanceof Date&&period!==undefined){period=periodOrScheduler;return observableTimerDateAndPeriod(dueTime.getTime(),period,scheduler)}if(period===undefined){return observableTimerTimeSpan(dueTime,scheduler)}return observableTimerTimeSpanAndPeriod(dueTime,period,scheduler)};function observableDelayTimeSpan(dueTime,scheduler){var source=this;return new AnonymousObservable(function(observer){var active=false,cancelable=new SerialDisposable,exception=null,q=[],running=false,subscription;subscription=source.materialize().timestamp(scheduler).subscribe(function(notification){var d,shouldRun;if(notification.value.kind==="E"){q=[];q.push(notification);exception=notification.value.exception;shouldRun=!running}else{q.push({value:notification.value,timestamp:notification.timestamp+dueTime});shouldRun=!active;active=true}if(shouldRun){if(exception!==null){observer.onError(exception)}else{d=new SingleAssignmentDisposable;cancelable.disposable(d);d.disposable(scheduler.scheduleRecursiveWithRelative(dueTime,function(self){var e,recurseDueTime,result,shouldRecurse;if(exception!==null){return}running=true;do{result=null;if(q.length>0&&q[0].timestamp-scheduler.now()<=0){result=q.shift().value}if(result!==null){result.accept(observer)}}while(result!==null);shouldRecurse=false;recurseDueTime=0;if(q.length>0){shouldRecurse=true;recurseDueTime=Math.max(0,q[0].timestamp-scheduler.now())}else{active=false}e=exception;running=false;if(e!==null){observer.onError(e)}else if(shouldRecurse){self(recurseDueTime)}}))}}});return new CompositeDisposable(subscription,cancelable)})}function observableDelayDate(dueTime,scheduler){var self=this;return observableDefer(function(){var timeSpan=dueTime-scheduler.now();return observableDelayTimeSpan.call(self,timeSpan,scheduler)})}observableProto.delay=function(dueTime,scheduler){scheduler||(scheduler=timeoutScheduler);return dueTime instanceof Date?observableDelayDate.call(this,dueTime.getTime(),scheduler):observableDelayTimeSpan.call(this,dueTime,scheduler)};observableProto.throttle=function(dueTime,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){var cancelable=new SerialDisposable,hasvalue=false,id=0,subscription,value=null;subscription=source.subscribe(function(x){var currentId,d;hasvalue=true;value=x;id++;currentId=id;d=new SingleAssignmentDisposable;cancelable.disposable(d);d.disposable(scheduler.scheduleWithRelative(dueTime,function(){if(hasvalue&&id===currentId){observer.onNext(value)}hasvalue=false}))},function(exception){cancelable.dispose();observer.onError(exception);hasvalue=false;id++},function(){cancelable.dispose();if(hasvalue){observer.onNext(value)}observer.onCompleted();hasvalue=false;id++});return new CompositeDisposable(subscription,cancelable)})};observableProto.windowWithTime=function(timeSpan,timeShiftOrScheduler,scheduler){var source=this,timeShift;if(timeShiftOrScheduler===undefined){timeShift=timeSpan}if(scheduler===undefined){scheduler=timeoutScheduler}if(typeof timeShiftOrScheduler==="number"){timeShift=timeShiftOrScheduler}else if(typeof timeShiftOrScheduler==="object"){timeShift=timeSpan;scheduler=timeShiftOrScheduler}return new AnonymousObservable(function(observer){var createTimer,groupDisposable,nextShift=timeShift,nextSpan=timeSpan,q=[],refCountDisposable,timerD=new SerialDisposable,totalTime=0;groupDisposable=new CompositeDisposable(timerD);refCountDisposable=new RefCountDisposable(groupDisposable);createTimer=function(){var isShift,isSpan,m,newTotalTime,ts;m=new SingleAssignmentDisposable;timerD.disposable(m);isSpan=false;isShift=false;if(nextSpan===nextShift){isSpan=true;isShift=true}else if(nextSpan<nextShift){isSpan=true}else{isShift=true}newTotalTime=isSpan?nextSpan:nextShift;ts=newTotalTime-totalTime;totalTime=newTotalTime;if(isSpan){nextSpan+=timeShift}if(isShift){nextShift+=timeShift}m.disposable(scheduler.scheduleWithRelative(ts,function(){var s;if(isShift){s=new Subject;q.push(s);observer.onNext(addRef(s,refCountDisposable))}if(isSpan){s=q.shift();s.onCompleted()}createTimer()}))};q.push(new Subject);observer.onNext(addRef(q[0],refCountDisposable));createTimer();groupDisposable.add(source.subscribe(function(x){var i,s;for(i=0;i<q.length;i++){s=q[i];s.onNext(x)}},function(e){var i,s;for(i=0;i<q.length;i++){s=q[i];s.onError(e)}observer.onError(e)},function(){var i,s;for(i=0;i<q.length;i++){s=q[i];s.onCompleted()}observer.onCompleted()}));return refCountDisposable})};observableProto.windowWithTimeOrCount=function(timeSpan,count,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var createTimer,groupDisposable,n=0,refCountDisposable,s,timerD=new SerialDisposable,windowId=0;groupDisposable=new CompositeDisposable(timerD);refCountDisposable=new RefCountDisposable(groupDisposable);createTimer=function(id){var m=new SingleAssignmentDisposable;timerD.disposable(m);m.disposable(scheduler.scheduleWithRelative(timeSpan,function(){var newId;if(id!==windowId){return}n=0;newId=++windowId;s.onCompleted();s=new Subject;observer.onNext(addRef(s,refCountDisposable));createTimer(newId)}))};s=new Subject;observer.onNext(addRef(s,refCountDisposable));createTimer(0);groupDisposable.add(source.subscribe(function(x){var newId=0,newWindow=false;s.onNext(x);n++;if(n===count){newWindow=true;n=0;newId=++windowId;s.onCompleted();s=new Subject;observer.onNext(addRef(s,refCountDisposable))}if(newWindow){createTimer(newId)}},function(e){s.onError(e);observer.onError(e)},function(){s.onCompleted();observer.onCompleted()}));return refCountDisposable})};observableProto.bufferWithTime=function(timeSpan,timeShiftOrScheduler,scheduler){var timeShift;if(timeShiftOrScheduler===undefined){timeShift=timeSpan}scheduler||(scheduler=timeoutScheduler);if(typeof timeShiftOrScheduler==="number"){timeShift=timeShiftOrScheduler}else if(typeof timeShiftOrScheduler==="object"){timeShift=timeSpan;scheduler=timeShiftOrScheduler}return this.windowWithTime(timeSpan,timeShift,scheduler).selectMany(function(x){return x.toArray()})};observableProto.bufferWithTimeOrCount=function(timeSpan,count,scheduler){scheduler||(scheduler=timeoutScheduler);return this.windowWithTimeOrCount(timeSpan,count,scheduler).selectMany(function(x){return x.toArray()})};observableProto.timeInterval=function(scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return observableDefer(function(){var last=scheduler.now();return source.select(function(x){var now=scheduler.now(),span=now-last;last=now;return{value:x,interval:span}})})};observableProto.timestamp=function(scheduler){scheduler||(scheduler=timeoutScheduler);return this.select(function(x){return{value:x,timestamp:scheduler.now()}})};function sampleObservable(source,sampler){return new AnonymousObservable(function(observer){var atEnd,value,hasValue;function sampleSubscribe(){if(hasValue){hasValue=false;observer.onNext(value)}if(atEnd){observer.onCompleted()}}return new CompositeDisposable(source.subscribe(function(newValue){hasValue=true;value=newValue},observer.onError.bind(observer),function(){atEnd=true}),sampler.subscribe(sampleSubscribe,observer.onError.bind(observer),sampleSubscribe))})}observableProto.sample=function(intervalOrSampler,scheduler){scheduler||(scheduler=timeoutScheduler);if(typeof intervalOrSampler==="number"){return sampleObservable(this,observableinterval(intervalOrSampler,scheduler))}return sampleObservable(this,intervalOrSampler)};observableProto.timeout=function(dueTime,other,scheduler){var schedulerMethod,source=this;other||(other=observableThrow(new Error("Timeout")));scheduler||(scheduler=timeoutScheduler);if(dueTime instanceof Date){schedulerMethod=function(dt,action){scheduler.scheduleWithAbsolute(dt,action)}}else{schedulerMethod=function(dt,action){scheduler.scheduleWithRelative(dt,action)}}return new AnonymousObservable(function(observer){var createTimer,id=0,original=new SingleAssignmentDisposable,subscription=new SerialDisposable,switched=false,timer=new SerialDisposable;subscription.disposable(original);createTimer=function(){var myId=id;timer.disposable(schedulerMethod(dueTime,function(){switched=id===myId;var timerWins=switched;if(timerWins){subscription.disposable(other.subscribe(observer))}}))};createTimer();original.disposable(source.subscribe(function(x){var onNextWins=!switched;if(onNextWins){id++;observer.onNext(x);createTimer()}},function(e){var onErrorWins=!switched;if(onErrorWins){id++;observer.onError(e)}},function(){var onCompletedWins=!switched;if(onCompletedWins){id++;observer.onCompleted()}}));return new CompositeDisposable(subscription,timer)})};Observable.generateWithAbsoluteTime=function(initialState,condition,iterate,resultSelector,timeSelector,scheduler){scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var first=true,hasResult=false,result,state=initialState,time;return scheduler.scheduleRecursiveWithAbsolute(scheduler.now(),function(self){if(hasResult){observer.onNext(result)}try{if(first){first=false}else{state=iterate(state)}hasResult=condition(state);if(hasResult){result=resultSelector(state);time=timeSelector(state)}}catch(e){observer.onError(e);return}if(hasResult){self(time)}else{observer.onCompleted()}})})};Observable.generateWithRelativeTime=function(initialState,condition,iterate,resultSelector,timeSelector,scheduler){scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var first=true,hasResult=false,result,state=initialState,time;return scheduler.scheduleRecursiveWithRelative(0,function(self){if(hasResult){observer.onNext(result)}try{if(first){first=false}else{state=iterate(state)}hasResult=condition(state);if(hasResult){result=resultSelector(state);time=timeSelector(state)}}catch(e){observer.onError(e);return}if(hasResult){self(time)}else{observer.onCompleted()}})})};observableProto.delaySubscription=function(dueTime,scheduler){scheduler||(scheduler=timeoutScheduler);return this.delayWithSelector(observableTimer(dueTime,scheduler),function(){return observableEmpty()})};observableProto.delayWithSelector=function(subscriptionDelay,delayDurationSelector){var source=this,subDelay,selector;if(typeof subscriptionDelay==="function"){selector=subscriptionDelay}else{subDelay=subscriptionDelay;selector=delayDurationSelector}return new AnonymousObservable(function(observer){var delays=new CompositeDisposable,atEnd=false,done=function(){if(atEnd&&delays.length===0){observer.onCompleted()}},subscription=new SerialDisposable,start=function(){subscription.setDisposable(source.subscribe(function(x){var delay;try{delay=selector(x)}catch(error){observer.onError(error);return}var d=new SingleAssignmentDisposable;delays.add(d);d.setDisposable(delay.subscribe(function(){observer.onNext(x);delays.remove(d);done()},observer.onError.bind(observer),function(){observer.onNext(x);delays.remove(d);done()}))},observer.onError.bind(observer),function(){atEnd=true;subscription.dispose();done()}))};if(!subDelay){start()}else{subscription.setDisposable(subDelay.subscribe(function(){start()},observer.onError.bind(observer),function(){start()}))}return new CompositeDisposable(subscription,delays)})};observableProto.timeoutWithSelector=function(firstTimeout,timeoutdurationSelector,other){firstTimeout||(firstTimeout=observableNever());other||(other=observableThrow(new Error("Timeout")));var source=this;return new AnonymousObservable(function(observer){var subscription=new SerialDisposable,timer=new SerialDisposable,original=new SingleAssignmentDisposable;subscription.setDisposable(original);var id=0,switched=false,setTimer=function(timeout){var myId=id,timerWins=function(){return id===myId};var d=new SingleAssignmentDisposable;timer.setDisposable(d);d.setDisposable(timeout.subscribe(function(){if(timerWins()){subscription.setDisposable(other.subscribe(observer))}d.dispose()},function(e){if(timerWins()){observer.onError(e)}},function(){if(timerWins()){subscription.setDisposable(other.subscribe(observer))}}))};setTimer(firstTimeout);var observerWins=function(){var res=!switched;if(res){id++}return res};original.setDisposable(source.subscribe(function(x){if(observerWins()){observer.onNext(x);var timeout;try{timeout=timeoutdurationSelector(x)}catch(e){observer.onError(e);return}setTimer(timeout)}},function(e){if(observerWins()){observer.onError(e)}},function(){if(observerWins()){observer.onCompleted()}}));return new CompositeDisposable(subscription,timer)})};observableProto.throttleWithSelector=function(throttleDurationSelector){var source=this;return new AnonymousObservable(function(observer){var value,hasValue=false,cancelable=new SerialDisposable,id=0,subscription=source.subscribe(function(x){var throttle;try{throttle=throttleDurationSelector(x)}catch(e){observer.onError(e);return}hasValue=true;value=x;id++;var currentid=id,d=new SingleAssignmentDisposable;cancelable.setDisposable(d);d.setDisposable(throttle.subscribe(function(){if(hasValue&&id===currentid){observer.onNext(value)}hasValue=false;d.dispose()},observer.onError.bind(observer),function(){if(hasValue&&id===currentid){observer.onNext(value)}hasValue=false;d.dispose()}))},function(e){cancelable.dispose();observer.onError(e);hasValue=false;id++},function(){cancelable.dispose();if(hasValue){observer.onNext(value)}observer.onCompleted();hasValue=false;id++});return new CompositeDisposable(subscription,cancelable)})};observableProto.skipLastWithTime=function(duration,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){var now=scheduler.now();q.push({interval:now,value:x});while(q.length>0&&now-q[0].interval>=duration){observer.onNext(q.shift().value)}},observer.onError.bind(observer),function(){var now=scheduler.now();while(q.length>0&&now-q[0].interval>=duration){observer.onNext(q.shift().value)}observer.onCompleted()})})};observableProto.takeLastWithTime=function(duration,timerScheduler,loopScheduler){return this.takeLastBufferWithTime(duration,timerScheduler).selectMany(function(xs){return observableFromArray(xs,loopScheduler)})};observableProto.takeLastBufferWithTime=function(duration,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var q=[];return source.subscribe(function(x){var now=scheduler.now();q.push({interval:now,value:x});while(q.length>0&&now-q[0].interval>=duration){q.shift()}},observer.onError.bind(observer),function(){var now=scheduler.now(),res=[];while(q.length>0){var next=q.shift();if(now-next.interval<=duration){res.push(next.value)}}observer.onNext(res);observer.onCompleted()})})};observableProto.takeWithTime=function(duration,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var t=scheduler.scheduleWithRelative(duration,function(){observer.onCompleted()});return new CompositeDisposable(t,source.subscribe(observer))})};observableProto.skipWithTime=function(duration,scheduler){var source=this;scheduler||(scheduler=timeoutScheduler);return new AnonymousObservable(function(observer){var open=false,t=scheduler.scheduleWithRelative(duration,function(){open=true}),d=source.subscribe(function(x){if(open){observer.onNext(x)}},observer.onError.bind(observer),observer.onCompleted.bind(observer));return new CompositeDisposable(t,d)})};observableProto.skipUntilWithTime=function(startTime,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){var open=false,t=scheduler.scheduleWithAbsolute(startTime,function(){open=true}),d=source.subscribe(function(x){if(open){observer.onNext(x)}},observer.onError.bind(observer),observer.onCompleted.bind(observer));return new CompositeDisposable(t,d)})};observableProto.takeUntilWithTime=function(endTime,scheduler){scheduler||(scheduler=timeoutScheduler);var source=this;return new AnonymousObservable(function(observer){return new CompositeDisposable(scheduler.scheduleWithAbsolute(endTime,function(){observer.onCompleted()}),source.subscribe(observer))})};return Rx})}};__resources__["/__builtin__/transformable.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var geo=require("geometry"),util=require("util"),Klass=require("base").Klass,Trait=require("oo").Trait,assert=require("debug").assert;var transformableTrait=Trait.extend({initialize:function(timeStamp,dep){assert(timeStamp,"param error");var m=[];m[0]={x:0,y:0,z:0,sx:1,sy:1,r:0};this.slot("__matrixs__",m);this.slot("__timeStamper__",timeStamp);this.slot("__curStamp__",timeStamp.exec("now"));this.slot("__lastStamp__",timeStamp.exec("now")-1);this.slot("__depTransformable__",dep);this.slot("__matrix__",this.exec("matrix"))},setX:function(val){var m=this.slot("__matrixs__")[0];m.x=val;this.exec("__stepForwardTimeStamp__")},applyX:function(val){var m=this.slot("__matrixs__")[0];m.x+=val;this.exec("__stepForwardTimeStamp__")},setY:function(val){var m=this.slot("__matrixs__")[0];m.y=val;this.exec("__stepForwardTimeStamp__")},applyY:function(val){var m=this.slot("__matrixs__")[0];m.y+=val;this.exec("__stepForwardTimeStamp__")},translate:function(x,y,z){var m=this.slot("__matrixs__")[0];m.x=x;m.y=y;if(typeof z=="number")m.z=z;this.exec("__stepForwardTimeStamp__")},applyTranslate:function(x,y,z){var m=this.slot("__matrixs__")[0];m.x+=x;m.y+=y;if(typeof z=="number")m.z+=z;this.exec("__stepForwardTimeStamp__")},rotate:function(radian){var m=this.slot("__matrixs__")[0];m.r=radian;this.exec("__stepForwardTimeStamp__")},applyRotate:function(radian){var m=this.slot("__matrixs__")[0];m.r+=radian;this.exec("__stepForwardTimeStamp__")},scaleX:function(sx){var m=this.slot("__matrixs__")[0];m.sx=sx;this.exec("__stepForwardTimeStamp__")},applyScaleX:function(sx){var m=this.slot("__matrixs__")[0];m.sx*=sx;this.exec("__stepForwardTimeStamp__")},scaleY:function(sy){var m=this.slot("__matrixs__")[0];m.sy=sy;this.exec("__stepForwardTimeStamp__")},applyScaleY:function(sy){var m=this.slot("__matrixs__")[0];m.sy*=sy;this.exec("__stepForwardTimeStamp__")},scale:function(sx,sy){var m=this.slot("__matrixs__")[0];m.sx=sx;m.sy=sy;this.exec("__stepForwardTimeStamp__")},applyScale:function(sx,sy){var m=this.slot("__matrixs__")[0];m.sx*=sx;m.sy*=sy;this.exec("__stepForwardTimeStamp__")},affineTransform:function(m){var affine=geo.decomposeMatrix(m);var m=this.slot("__matrixs__")[0];m.x=affine.x;m.y=affine.y;m.sx=affine.sx;m.sy=affine.sy;m.r=affine.r;this.exec("__stepForwardTimeStamp__")},pushTransform:function(){var ms=this.slot("__matrixs__");var m=Array.prototype.slice.call(arguments);ms.push(m);this.exec("__stepForwardTimeStamp__")},popTransform:function(){var ms=this.slot("__matrixs__");assert(ms.length>1,"logical error");this.exec("__stepForwardTimeStamp__");return ms.pop()},getTransformSteps:function(){var ms=this.slot("__matrixs__");var steps=[["translate",ms[0].x,ms[0].y,ms[0].z],["scale",ms[0].sx,ms[0].sy],["rotate",ms[0].r]];return steps.concat(ms.slice(1))},__rotatematrix:function(m,r){return geo.matrixRotateBy(m,r)},__scalematrix:function(m,sx,sy){return geo.matrixScaleBy(m,sx,sy)},__translatematrix:function(m,x,y,z){return geo.matrixTranslateBy(m,x,y,z)},__matrixmatrix:function(m,m1){return geo.matrixMultBy(m,m1)},matrix:function(){if(this.exec("__transformable_dirty__")){var dep=this.slot("__depTransformable__");var matrix=dep?util.copy(dep.exec("matrix")):geo.identityMatrix();var ms=this.slot("__matrixs__");var affine=ms[0];if(affine.x!=0||affine.y!=0||affine.z!=0)geo.matrixTranslateBy(matrix,affine.x,affine.y,affine.z);if(affine.sx!=1||affine.sy!=1)geo.matrixScaleBy(matrix,affine.sx,affine.sy);if(affine.r!=0)geo.matrixRotateBy(matrix,affine.r);for(var i=1;i<ms.length;i++){this.exec.apply(this,["__"+ms[i][0]+"matrix",matrix].concat(ms[i].slice(1)))}this.slot("__lastStamp__",this.slot("__timeStamper__").exec("now"));this.slot("__matrix__",matrix);return matrix}else return this.slot("__matrix__")},setDepTransformable:function(dep){var oldOne=this.slot("__depTransformable__");this.slot("__depTransformable__",dep);this.exec("__stepForwardTimeStamp__");return oldOne},stamp:function(){return this.slot("__lastStamp__")},__transformable_dirty__:function(){var dep=this.slot("__depTransformable__");if(this.slot("__lastStamp__")==this.slot("__timeStamper__").exec("now"))return false;var bDirty=this.slot("__lastStamp__")<this.slot("__curStamp__")||dep&&dep.exec("__transformable_dirty__")||dep&&this.exec("stamp")<dep.exec("stamp");if(!bDirty){this.slot("__lastStamp__",this.slot("__timeStamper__").exec("now"));this.slot("__curStamp__",this.slot("__lastStamp__"))}return bDirty},__stepForwardTimeStamp__:function(){this.slot("__timeStamper__").exec("stepForward");this.slot("__curStamp__",this.slot("__timeStamper__").exec("now"))}});exports.transformableTrait=transformableTrait}};__resources__["/__builtin__/util.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){(function(){var __idGenter=0;function object_id_getter(obj){if(obj.hasOwnProperty("__identifier")){return obj.__identifier}else{var newId=__idGenter++;obj.__identifier=newId;return newId}}Object.getIdentifier=object_id_getter})();var util={extend:function(target,ext){if(arguments.length<2)throw"at least 2 params provide to extend";var i,obj;for(i=1;i<arguments.length;i++){obj=arguments[i];if(!obj)continue;var key,val;for(key in obj){if(!obj.hasOwnProperty(key))continue;val=obj[key];if(val===undefined||val===target)continue;target[key]=val}}return target},beget:function(o){var F=function(){};F.prototype=o;return new F},each:function(obj,callback){if(typeof obj=="array"){var i=0,len=obj.length;for(;i<len;i++){callback(obj[i],i)}}else{var key;for(key in obj){if(obj.hasOwnProperty(key))callback(obj[key],key)}}},callback:function(target,method){if(typeof method=="string"){method=target[method]}if(typeof method=="function"){return function(){method.apply(target,arguments)}}else{debug.log("cannot create callback!!!")}},copy:function(obj){if(obj===null){return null}else if(obj===undefined)return undefined;var copy;if(obj instanceof Array){copy=[];for(var i=0,len=obj.length;i<len;i++){copy[i]=util.copy(obj[i])}}else if(typeof obj=="object"){if(typeof obj.copy=="function"){copy=obj.copy()}else{copy={};var o,x;for(x in obj){copy[x]=util.copy(obj[x])}}}else{copy=obj}return copy}};if(!Object.freeze){Object.freeze=function(x){return x}}if(!Object.keys){Object.keys=function(properties){var keys=[];var i=0;for(var key in properties){if(properties.hasOwnProperty(key))keys[i++]=key}return keys}}var notSpecifiedValue={};var reduce=function(cb,initialValue){var previousValue=arguments.length==2?initialValue:notSpecifiedValue;var keys=Object.keys(this);if(keys.length==0)return previousValue;var curIdx=0;if(previousValue==notSpecifiedValue){previousValue=this(keys[0]);curIdx=1}while(curIdx<keys.length){previousValue=cb(previousValue,this[keys[curIdx]],keys[curIdx],this);curIdx++}return previousValue};if(!Array.prototype.reduce){Array.prototype.reduce=reduce}if(!Array.prototype.forEach){Array.prototype.forEach=function(cb){return this.reduce(function(prev,cur,key,obj){cb(cur,key,obj)},undefined)}}if(!Array.prototype.some){Array.prototype.some=function(cb){var keys=Object.keys(this);var i=0;while(i<keys.length){if(cb(this[keys[i]],keys[i],this))return true;i++}return false}}if(!Array.prototype.map){Array.prototype.map=function(cb){return this.reduce(function(prev,cur,key,obj){prev[key]=cb(cur,key,obj);return prev},{})}}if(!Array.prototype.filter){Array.prototype.filter=function(cb){return this.reduce(function(prev,cur,key,obj){if(cb(cur,key,obj)){prev[key]=cur}return prev},{})}}if(Function.prototype.bind==undefined){Function.prototype.bind=function(obj){var self=this;return function(){return self.apply(obj,Array.prototype.slice.call(arguments,0))}}}var createNormalObject=function(proto,properties){var newobj;if(Object.create){newobj=Object.create(proto)}else{var CreateObj=function(){var NewFun=function(){};NewFun.prototype=proto;return NewFun}();newobj=new CreateObj}Object.keys(properties).forEach(function(key){var val=properties[key];newobj[key]=val});return newobj};var createObject=function(proto,properties){var newobj=createNormalObject(proto,properties);newobj.__proto__=proto;return newobj};util.createNormalObject=createNormalObject;util.createObject=createObject;module.exports=util}};__resources__["/__builtin__/actortraits.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Trait=require("oo").Trait,util=require("util"),debug=require("debug"),ClipModel=require("model").ClipModel,ImageModel=require("model").ImageModel,Rx=require("rx").binding;var frameUpdate=function(t,actor){var data=actor.exec("satelliteData","frame");var imgWidth=data._clipModel.get("model").get("width");var imgHeight=data._clipModel.get("model").get("height");var endX=data._endX==-1?imgWidth:data._endX;var endY=data._endY==-1?imgHeight:data._endY;var compelete=false;dt=dt*data._factor;if(data._times==0)return;data._elapsed+=dt;while(data._elapsed>=data._interval){data._elapsed-=data._interval;data._x+=data._hSpan;if(data._x>=imgWidth){data._x=0;data._y+=data._vSpan}if(data._x+data._hSpan>endX&&data._y+data._vSpan==endY||data._y+data._vSpan>endY){data._times--;data._x=data._startX;data._y=data._startY;if(0==data._times)break}}data._clipModel.get("x")=data._x;data._clipModel.get("y")=data._y};var frameSeqTrait=Trait.extend({initialize:function(param){var data=this.exec("querySatelliteData","frame",{});var imgModel=new ImageModel({image:param.image});data._clipModel=new ClipModel({w:param.w,h:param.h,model:imgModel});if(typeof param.HSpan=="number")data._hSpan=param.HSpan;else data._hSpan=param.w;if(typeof param.VSpan=="number")data._vSpan=param.VSpan;else data._vSpan=param.h;var startFrame={x:0,y:0};if(typeof param.startFrame=="number"){startFrame.x=param.startFrame;startFrame.y=0}else if(param.startFrame){startFrame=param.startFrame}var endFrame={x:-1,y:-1};if(typeof param.endFrame=="number"){endFrame.x=param.endFrame;endFrame.y=1}else if(param.endFrame){endFrame=param.endFrame}debug.assert(typeof startFrame.x=="number"&&typeof startFrame.y=="number"&&typeof endFrame.x=="number"&&typeof (endFrame.y=="number"),"parameter error");data._startX=startFrame.x*param.w;data._startY=startFrame.y*param.h;data._endX=endFrame.x==-1?-1:endFrame.x*param.w;data._endY=endFrame.y==-1?-1:endFrame.y*param.h;if(typeof param.times=="number")data._times=param.times;else data._times=1;data._interval=param.interval;if(typeof param.factor=="number")data._factor=param.factor;else data._factor=1;data._clipModel.x=data._x=data._startX;data._clipModel.y=data._y=data._startY;data._elapsed=0;this.exec("regUpdate",frameUpdate)},_frameData:function(){return this.exec("satelliteData","frame")},setFrameSeqFactor:function(factor){debug.assert(typeof factor=="number","frameseq component setFrameSeqFactor parameter error");this.exec("satelliteData","frame")._factor=factor},getModel:function(){return this.exec("satelliteData","frame")._clipModel}});var emitterTrait=Trait.extend({initialize:function(param){debug.assert(param.emitter,"parameter error");this.exec("querySatelliteData","emitter",param.emitter);var update=function(t,actor){actor.exec("querySatelliteData","emitter").exec("update",dt,null,{})};this.exec("regUpdate",update)},getEmitter:function(){return this.exec("querySatelliteData","emitter")}});var unitTrait=Trait.extend({unitTraitInitialize:function(param){},isUnit:function(host){return true}});var isoVerActorTrait=Trait.extend({isoVerActorTraitInitailze:function(param){},emmitModels:function(v){var m=this.exec("model");var mat=this.exec("matrix");debug.assert(typeof mat.tz=="number","logical error");v.push({model:m,effect:{matrix:mat,vertical:true,z:mat.tz}})},emmitControlModels:function(v){return this.exec("emmitModels",v)}});var interactorTrait=Trait.extend({initialize:function(param){debug.assert(param!=null||param.director!=null,"interactorTrait require param error");this.slot("_eventDecider",param.director.exec("eventDecider"));this.slot("_active",false)},addNamedInteractor:function(name,interactor){if(interactor==null||name==null)return;if(this.slot("_interactors")===undefined)this.slot("_interactors",{});if(this.slot("_interactors")[name]!=null)this.exec("removeInteractor",name);interactor.exec("bindActor",this);this.slot("_interactors")[name]=interactor;return interactor},addInteractor:function(Interactor,callback){if(Interactor==null||callback==null)return;var interactor=Interactor.create({onNext:callback});return this.exec("addNamedInteractor",Object.getIdentifier(interactor),interactor)},removeInteractor:function(interactor){if(interactor==null)return;this.exec("removeInteractorByName",Object.getIdentifier(interactor))},removeInteractors:function(){var interactors=this.slot("_interactors");for(var name in interactors){this.slot("_interactors")[name].exec("unbindActor",this);delete this.slot("_interactors")[name]}},queryInteractor:function(name){if(this.slot("_interactors")===undefined)return;return this.slot("_interactors")[name]},getSubjectByType:function(type){return this.slot("_primitiveEvents")[type].subject},carePrimitiveEvent:function(type){debug.assert(type==="mouseOver"||type==="mouseMoved"||type==="mouseOut"||type=="mousemove"||type=="mousePressed"||type==="mouseReleased"||type==="keyPressed"||type==="keyReleased"||type==="mousewheel","actor.primitiveObservable param: bad type");if(this.slot("_primitiveEvents")===undefined)this.slot("_primitiveEvents",{});if(this.slot("_primitiveEvents")[type]===undefined){var subject=new Rx.Subject;this.slot("_primitiveEvents")[type]={subject:subject,observable:subject.asObservable(),refCount:1,regist:false};if(this.slot("_active")===true){this.slot("_eventDecider").exec("registWaiter",this,type);this.slot("_primitiveEvents")[type].regist=true}}else{this.slot("_primitiveEvents")[type].refCount+=1}return this.slot("_primitiveEvents")[type].observable},doNotCarePrimitiveEvent:function(type){this.slot("_primitiveEvents")[type].refCount-=1;if(this.slot("_primitiveEvents")[type].refCount===0){if(this.slot("_active"))this.slot("_eventDecider").exec("cancelWaiter",this,type);delete this.slot("_primitiveEvents")[type]}},onActive:function(){this.slot("_active",true);for(var type in this.slot("_primitiveEvents")){var primitiveEvent=this.slot("_primitiveEvents")[type];if(primitiveEvent.regist===false){this.slot("_eventDecider").exec("registWaiter",this,type);primitiveEvent.regist=true}}},onDeactive:function(){this.slot("_active",false);for(var type in this.slot("_primitiveEvents")){var primitiveEvent=this.slot("_primitiveEvents")[type];if(primitiveEvent.regist==true){this.slot("_eventDecider").exec("cancelWaiter",this,type);primitiveEvent.regist=false}}}});exports.emitterTrait=emitterTrait;exports.frameSeqTrait=frameSeqTrait;exports.unitTrait=unitTrait;exports.isoVerActorTrait=isoVerActorTrait;exports.interactorTrait=interactorTrait}};__resources__["/__builtin__/director.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var util=require("util"),debug=require("debug"),helper=require("helper"),view=require("view"),painter=require("painter"),model=require("model"),TopView=view.TopView,geo=require("geometry"),CommonEventDecider=require("eventdecider").CommonEventDecider;var Klass=require("base").Klass,Trait=require("oo").Trait;var Rx=require("rx").binding;var timeStamperTrait=Trait.extend({initialize:function(param){this.execProto("initialize");param=param||{};if(param.startTime!=undefined)this.slot("_startTime",param.startTime);else this.slot("_startTime",0);this.slot("_curTime",this.slot("_startTime"));if(param.step!=undefined)this.slot("_step",param.step);else this.slot("_step",1);return this},stepForward:function(dt){if(dt!=undefined)this.slot("_curTime",this.slot("_curTime")+dt);else this.slot("_curTime",this.slot("_curTime")+this.slot("_step"))},adjust:function(t){this.slot("_curTime",t)},now:function(){return this.slot("_curTime")}});var TimeStamper=Klass.extend([timeStamperTrait]);var timeStamp=TimeStamper.create();function createMouseEventSelectCb(type){return function(e){var evt={type:type};evt.mouseX=e.x;evt.mouseY=e.y;evt.sourceEvt=e.sourceEvt;return evt}}function createKeyEventSelectCb(type){return function(e){var evt={type:type};evt.key=e.key;evt.keyCode=e.keyCode;evt.sourceEvt=e.sourceEvt;return evt}}function redrawLevel2Painter(level,painter){var displayList=[];painter.exec("clear");director().exec("defaultView")(painter,level.exec("scene"))}var eventIdGenerator=0;var directorTrait=Trait.extend({initialize:function(param){this.execProto("initialize");this.slot("_timeStamper",TimeStamper.create());this.slot("_globalTimeStamper",TimeStamper.create());debug.assert(param.painter,"param error");this.slot("_defaultPainter",param.painter);this.slot("_displayList",[]);this.slot("_now",0);if(param.view)this.slot("_defaultView",param.view);else this.slot("_defaultView",TopView.create());this.exec("initEventObservable");this.exec("initEventDecider");this.exec("initInvalidate")},initEventObservable:function(){var canvasEventObservables=this.slot("_defaultPainter").exec("canvasEventObservables");var eventObservable=canvasEventObservables.mousemoveObservable.select(createMouseEventSelectCb("mouseMoved"));eventObservable=eventObservable.merge(canvasEventObservables.mousedownObservable.select(createMouseEventSelectCb("mousePressed")));eventObservable=eventObservable.merge(canvasEventObservables.mousemoveObservable.select(createMouseEventSelectCb("mousemove")));eventObservable=eventObservable.merge(canvasEventObservables.mouseupObservable.select(createMouseEventSelectCb("mouseReleased")));eventObservable=eventObservable.merge(canvasEventObservables.keydownObservable.select(createKeyEventSelectCb("keyPressed")));eventObservable=eventObservable.merge(canvasEventObservables.keyupObservable.select(createKeyEventSelectCb("keyReleased")));eventObservable=eventObservable.merge(canvasEventObservables.mousewheelObservable);this.slot("_eventObservable",eventObservable)},initEventDecider:function(){this.slot("_eventDecider",CommonEventDecider.create({eventObservable:this.slot("_eventObservable"),painter:this.exec("defaultPainter"),view:this.exec("defaultView")}))},initInvalidate:function(){this.slot("_invalidate",false);this.slot("_invalidateSubject",new Rx.Subject);this.slot("_invalidateObservable",this.slot("_invalidateSubject").asObservable().switchLatest());var self=this;this.slot("_invalidateObservable").subscribe(function(e){self.exec("update",1);self.slot("_invalidate",false)})},eventDecider:function(){return this.slot("_eventDecider")},eventObservable:function(){return this.slot("_eventObservable")},globalTimeStamper:function(){return this.slot("_globalTimeStamper")},getGameWorldToViewMatrix:function(){return this.slot("_gameWorldToViewMatrix")},setGameWorldToViewMatrix:function(mat){return this.slot("_gameWorldToViewMatrix",util.copy(mat))},update:function(t){this.slot("_timeStamper").exec("adjust",t);this.slot("_globalTimeStamper").exec("adjust",t);this.slot("_now",this.slot("_now")+1);if(this.slot("_level")){this.slot("_level").exec("update",t);this.slot("_defaultPainter").exec("clear");this.slot("_defaultView").exec("view",this.slot("_defaultPainter"),this.slot("_level").exec("scene"))}},setLevel:function(level){if(this.slot("_level")===level)return;if(this.slot("_level"))this.slot("_level").exec("onDeactive");this.slot("_level",level);if(this.slot("_level"))this.slot("_level").exec("onActive",this)},getLevel:function(){return this.slot("_level")},getScene:function(){return this.slot("_level").exec("scene")},defaultPainter:function(){return this.slot("_defaultPainter")},defaultView:function(){return this.slot("_defaultView")},defaultPainterWidth:function(){return this.slot("_defaultPainter").exec("sketchpad").width},defaultPainterHeight:function(){return this.slot("_defaultPainter").exec("sketchpad").height},invalidate:function(){if(this.slot("_invalidate")===true)return;this.slot("_invalidate",true);this.slot("_invalidateSubject").onNext(Rx.Observable.start(function(){return true}))},invalidateObservable:function(){return this.slot("_invalidateObservable")}});var Director=Klass.extend([directorTrait]);function World(width,height,parent){var Level=require("level").Level;var wSchpad=helper.createSketchpad(width,height,parent);var wPainter=painter.HonestPainter.create(wSchpad);var wView=view.TopView.create();var wDirector=Director.create({painter:wPainter,view:wView});var wLevel=Level.create();wDirector.exec("setLevel",wLevel);return wDirector}exports.Director=Director;exports.timeStamp=timeStamp;exports.TimeStamper=TimeStamper;exports.World=World}};__resources__["/__builtin__/eventdecider.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var geo=require("geometry"),debug=require("debug"),Klass=require("base").Klass,Trait=require("oo").Trait,Rx=require("rx").binding;Rx=require("rx").helper;var addPstnInGameWorld=function(view,evt){var mat=geo.matrixInvert(view.exec("getGameToViewMatrix"));var gamePstn=geo.pointApplyMatrix({x:evt.mouseX,y:evt.mouseY},mat);evt.gameX=gamePstn.x;evt.gameY=gamePstn.y;return evt};var cloneEvent=function(evt){var newEvt={};for(var pro in evt){newEvt[pro]=evt[pro]}return newEvt};var deciderTrait=Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_waiters",{});this.slot("_painter",param.painter);this.slot("_view",param.view);this.slot("_originalThen",function(evt){return Rx.Observable.returnValue(evt)});this.slot("then",this.slot("_originalThen"));var self=this;var originalDeciderObservable=param.eventObservable.then(function(evt){return self.exec("decideEvent",self.slot("_painter"),self.slot("_view"),evt)});this.slot("_deciderObservable",originalDeciderObservable.then(function(evt){return self.slot("then")(evt)}));this.slot("_deciderObservable").subscribe(function(waiter){if(waiter===undefined||waiter.node===undefined||waiter.evt===undefined){debug.assert("_deciderObservable message error")}if(waiter.evt.actor==null)debug.assert("bad event actor");waiter.node.exec("getSubjectByType",waiter.evt.type).onNext(waiter.evt)})},deciderObservable:function(){return this.slot("_deciderObservable")},registThenFun:function(then){this.slot("then",then)},removeThenFun:function(then){debug.assert(this.slot("then")===then,"_deciderObservable message error");this.slot("then",this.slot("_originalThen"))},registWaiter:function(node,type,destSubject){if(!this.slot("_waiters")[type])this.slot("_waiters")[type]={};this.slot("_waiters")[type][Object.getIdentifier(node)]={node:node}},cancelWaiter:function(node,type){delete this.slot("_waiters")[type][Object.getIdentifier(node)]},getNodeWaiterByType:function(node,type){if(this.slot("_waiters")===undefined||this.slot("_waiters")[type]===undefined)return undefined;return this.slot("_waiters")[type][Object.getIdentifier(node)]},decideEvent:function(painter,view,evt){var waiters=this.slot("_waiters")[evt.type];addPstnInGameWorld(view,evt);return this.exec("doDecideEvent",painter,view,evt,waiters)},doDecideEvent:function(painter,view,evt,dests){debug.assert("cannot be here:decideEvent is base")},hitTestNodes:function(painter,view,pos,waiters){var self=this;var controlmodels=[];for(var id in waiters){var waiter=waiters[id];var cms=[];waiter.node.exec("emmitControlModels",cms);cms.forEach(function(cm){cm.ownerWaiter=waiter});controlmodels=controlmodels.concat(cms)}var hitOne,modelPath;controlmodels.sort(function(c1,c2){return view.exec("compareModel",painter,c1.model,c1.effect.matrix,c2.model,c2.effect.matrix)}).some(function(controlModel){modelPath=self.exec("hitTest",painter,view,pos,controlModel);if(modelPath!=false){hitOne=controlModel;return true}return false});if(hitOne){debug.assert(hitOne.model&&hitOne.ownerWaiter,"logical error");return{waiter:hitOne.ownerWaiter,model:hitOne.model,modelPath:typeof modelPath=="string"?modelPath:undefined}}},hitTest:function(painter,view,viewPstn,controlModel){debug.assert(controlModel.model&&controlModel.effect.matrix,"parameter error");var pstnRel2Model=view.exec("getPstnRelativeToModel",viewPstn,controlModel.model,controlModel.effect);return painter.exec("inside",controlModel.model,pstnRel2Model)}});var Decider=Klass.extend([deciderTrait]);var hoverEventDeciderTrait=Trait.extend({initialize:function(param){},doDecideEvent:function(painter,view,evt,waiters){debug.assert(evt.type==="mouseMoved","hovereventDecider receive unknown evtType:"+evt.type);var hitInfo=this.exec("hitTestNodes",painter,view,{x:evt.mouseX,y:evt.mouseY},waiters);var targetNode=hitInfo?hitInfo.waiter.node:undefined;var subject=new Rx.ReplaySubject;if(this.slot("_activeNode")&&targetNode!==this.slot("_activeNode")){var relWaiter=this.exec("getNodeWaiterByType",this.slot("_activeNode"),"mouseOut");if(relWaiter!=null){var newEvt=cloneEvent(evt);newEvt.type="mouseOut";newEvt.model=this.slot("_activeModel");newEvt.modelPath=this.slot("_activeModelPath");newEvt.actor=this.slot("_activeNode");subject.onNext({evt:newEvt,node:this.slot("_activeNode")})}this.slot("_activeNode",undefined);this.slot("_activeModel",undefined);this.slot("_activeModelPath",undefined)}else if(hitInfo&&targetNode&&targetNode==this.slot("_activeNode")){var newEvt=cloneEvent(evt);newEvt.type="mouseMoved";newEvt.model=hitInfo.model;newEvt.modelPath=hitInfo.modelPath;newEvt.actor=this.slot("_activeNode");subject.onNext({evt:newEvt,node:this.slot("_activeNode")})}else if(targetNode&&targetNode!==this.slot("_activeNode")){this.slot("_activeNode",hitInfo.waiter.node);this.slot("_activeModel",hitInfo.model);this.slot("_activeModelPath",hitInfo.modelPath);var relWaiter=this.exec("getNodeWaiterByType",this.slot("_activeNode"),"mouseOver");if(relWaiter!=undefined){var newEvt=cloneEvent(evt);newEvt.type="mouseOver";newEvt.modelPath=hitInfo.modelPath;newEvt.actor=this.slot("_activeNode");subject.onNext({evt:newEvt,node:this.slot("_activeNode")})}}return subject.asObservable()}});var HoverEventDecider=Decider.extend([hoverEventDeciderTrait]);var keyEventDeciderTrait=Trait.extend({initialize:function(param){},doDecideEvent:function(painter,view,evt,waiters){debug.assert(evt.type=="keyPressed"||evt.type=="keyReleased"||evt.type=="mousewheel","I cannot decide event type:"+evt.type);var i,waiter;var subject=new Rx.ReplaySubject;for(var id in waiters){var waiter=waiters[id];var newEvt=cloneEvent(evt);newEvt.actor=waiter.node;subject.onNext({evt:newEvt,node:waiter.node})}return subject.asObservable()}});var KeyEventDecider=Decider.extend([keyEventDeciderTrait]);var mouseButtonEventDeciderTrait=Trait.extend({initialize:function(param){},doDecideEvent:function(painter,view,evt,waiters){debug.assert(evt.type=="mousePressed"||evt.type=="mouseReleased"||evt.type=="mousemove","I cannot decide event type:"+evt.type);var subject=new Rx.ReplaySubject;var observable=subject.asObservable();var hitInfo=this.exec("hitTestNodes",painter,view,{x:evt.mouseX,y:evt.mouseY},waiters);var targetNode=hitInfo?hitInfo.waiter.node:undefined;switch(evt.type){case"mousePressed":if(this.slot("_pressedInfo")){var relWaiter=this.exec("getNodeWaiterByType",this.slot("_pressedInfo").waiter.node,"mouseReleased");if(relWaiter!=undefined){var newEvt=cloneEvent(evt);newEvt.type="mouseReleased";newEvt.actor=relWaiter.node;this.slot("_pressedInfo",undefined);this.slot("_pressedEvent",undefined);subject.onNext({evt:newEvt,node:relWaiter.node})}}if(hitInfo){this.slot("_pressedInfo",hitInfo);this.slot("_pressedEvent",cloneEvent(evt));this.slot("_pressedEvent").actor=this.slot("_pressedInfo").waiter.node;this.slot("_pressedEvent").modelPath=hitInfo.modelPath;subject.onNext({evt:this.slot("_pressedEvent"),node:this.slot("_pressedInfo").waiter.node})}break;case"mouseReleased":if(this.slot("_pressedInfo")){debug.assert(this.slot("_pressedEvent"),"logical error!");var relWaiter=this.exec("getNodeWaiterByType",this.slot("_pressedInfo").waiter.node,"mouseReleased");if(relWaiter===undefined){this.slot("_pressedInfo",undefined);this.slot("_pressedEvent",undefined)}else{var newEvt=cloneEvent(evt);newEvt.modelPath=this.slot("_pressedInfo").modelPath;newEvt.actor=relWaiter.node;this.slot("_pressedInfo",undefined);this.slot("_pressedEvent",undefined);subject.onNext({evt:newEvt,node:relWaiter.node})}}break;case"mousemove":if(this.slot("_pressedInfo")){debug.assert(this.slot("_pressedEvent"),"logical error!");var relWaiter=this.exec("getNodeWaiterByType",this.slot("_pressedInfo").waiter.node,"mousemove");if(relWaiter!=null){var newEvt=cloneEvent(evt);newEvt.modelPath=this.slot("_pressedInfo").modelPath;newEvt.actor=relWaiter.node;subject.onNext({evt:newEvt,node:relWaiter.node})}}break;default:debug.assert(false,"cannot be here!");break}return subject.asObservable()},testShake:function(evtPressed,evtDragged){var shakeSpan=10;var distX=evtDragged.mouseX-evtPressed.mouseX;var distY=evtDragged.mouseY-evtPressed.mouseY;return distX*distX+distY*distY<shakeSpan*shakeSpan}});var commonEventDeciderTrait=Trait.extend({initialize:function(param){},doDecideEvent:function(painter,view,evt,waiters){var i,waiter;var subject=new Rx.ReplaySubject;for(var id in waiters){var waiter=waiters[id];var newEvt=cloneEvent(evt);newEvt.actor=waiter.node;subject.onNext({evt:newEvt,node:waiter.node})}return subject.asObservable()}});var CommonEventDecider=Decider.extend([hoverEventDeciderTrait.rename({initialize:"hoverEvtDeciderInit",doDecideEvent:"doDecideHoverEvent"}),keyEventDeciderTrait.rename({initialize:"keyEvtDeciderInit",doDecideEvent:"doDecideKeyEvent"}),mouseButtonEventDeciderTrait.rename({initialize:"mouseEvtDeciderInit",doDecideEvent:"doDecideButtonEvent"}),commonEventDeciderTrait.rename({initialize:"commonEvtDeciderInit",doDecideEvent:"doDecideCommonEvent"})],{initialize:function(param){this.execProto("initialize",param);this.exec("hoverEvtDeciderInit",param);this.exec("keyEvtDeciderInit",param);this.exec("commonEvtDeciderInit",param);this.exec("mouseEvtDeciderInit",param)},doDecideEvent:function(painter,view,evt,waiters){switch(evt.type){case"mouseMoved":return this.exec("doDecideHoverEvent",painter,view,evt,waiters);case"mousewheel":case"keyPressed":case"keyReleased":return this.exec("doDecideKeyEvent",painter,view,evt,waiters);case"mousePressed":case"mouseReleased":case"mousemove":return this.exec("doDecideButtonEvent",painter,view,evt,waiters);default:return this.exec("doDecideCommonEvent",painter,view,evt,waiters)}}});exports.Decider=Decider;exports.CommonEventDecider=CommonEventDecider;exports.HoverEventDecider=HoverEventDecider;exports.KeyEventDecider=KeyEventDecider}};__resources__["/__builtin__/interactor.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var geo=Klass=require("base").Klass,Trait=require("oo").Trait,util=require("util"),debug=require("debug"),Rx=require("rx").binding;Rx=require("rx").helper;Rx=require("rx").aggregates;Rx=require("rx").time;var cloneEvent=function(evt){var newEvt={};for(var pro in evt){newEvt[pro]=evt[pro]}return newEvt};function testShake(evtPressed,evtDragged){var shakeSpan=2;var distX=evtDragged.mouseX-evtPressed.mouseX;var distY=evtDragged.mouseY-evtPressed.mouseY;return distX*distX+distY*distY<shakeSpan*shakeSpan}var interactorTrait=Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_onNext",param.onNext);this.slot("_onComplete",param.onComplete);this.slot("_onError",param.onError);this.slot("_bindActor",false);this.slot("_carePrimitiveEvents",{})},observable:function(param){return this.slot("_observable")},type:function(){return this.slot("_type")},bindActor:function(actor){debug.assert("cannot be here:bind is base")},unbindActor:function(actor){if(this.slot("_bindActor")===false)return;this.slot("_bindActor",false);this.exec("removeCarePrimitiveEvents",actor);this.slot("_observer").dispose();this.slot("_observer",undefined)},getCarePrimitiveEvent:function(actor,type){this.slot("_carePrimitiveEvents")[type]=type;return actor.exec("carePrimitiveEvent",type)},removeCarePrimitiveEvents:function(actor){for(var type in this.slot("_carePrimitiveEvents")){actor.exec("doNotCarePrimitiveEvent",type)}}});var Interactor=Klass.extend([interactorTrait]);var primitiveInteractorTrait=Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_type","primitive");this.slot("_subject",new Rx.Subject);this.slot("_observable",this.slot("_subject").asObservable().switchLatest())},bindActor:function(actor){if(this.slot("_bindActor")===true)debug.assert("cannot be bindActor several times");this.slot("_bindActor",true);this.slot("_observer",this.slot("_observable").subscribe(this.slot("_onNext"),this.slot("_onError"),this.slot("_onComplete")));this.slot("_subject").onNext(this.exec("getCarePrimitiveEvent",actor,this.slot("_type")))},unbindActor:function(actor){debug.assert(actor!=null,"unbindActor bad param:actor is null");this.execProto("unbindActor",actor)}});var PrimitiveInteractor=Interactor.extend([primitiveInteractorTrait]);function createPrimitiveMouseInteractorTrait(type){return Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_type",type)},bindActor:function(actor){this.execProto("bindActor",actor);this.exec("getCarePrimitiveEvent",actor,"mouseMoved")}})}var MouseOverInteractor=PrimitiveInteractor.extend([createPrimitiveMouseInteractorTrait("mouseOver")]);var MouseOutInteractor=PrimitiveInteractor.extend([createPrimitiveMouseInteractorTrait("mouseOut")]);var MouseMovedInteractor=PrimitiveInteractor.extend([createPrimitiveMouseInteractorTrait("mouseMoved")]);function createPrimitiveKeyInteractorTrait(type){return Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_type",type)}})}var MousePressedInteractor=PrimitiveInteractor.extend([createPrimitiveKeyInteractorTrait("mousePressed")]);var KeyPressedInteractor=PrimitiveInteractor.extend([createPrimitiveKeyInteractorTrait("keyPressed")]);var KeyReleasedInteractor=PrimitiveInteractor.extend([createPrimitiveKeyInteractorTrait("keyReleased")]);var MousewheelInteractor=PrimitiveInteractor.extend([createPrimitiveKeyInteractorTrait("mousewheel")]);var mouseReleasedInteractorTrait=Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_type","mouseReleased");this.slot("_subject",new Rx.Subject);this.slot("_observable",this.slot("_subject").asObservable().switchLatest())},bindActor:function(actor){if(this.slot("_bindActor")===true)debug.assert("cannot be bindActor several times");this.slot("_bindActor",true);this.slot("_observer",this.slot("_observable").subscribe(this.slot("_onNext"),this.slot("_onError"),this.slot("_onComplete")));this.slot("_subject").onNext(this.exec("getCarePrimitiveEvent",actor,this.slot("_type")).delay(0))},unbindActor:function(actor){debug.assert(actor!=null,"unbindActor bad param:actor is null");this.execProto("unbindActor",actor)}});var MouseReleasedInteractor=PrimitiveInteractor.extend([mouseReleasedInteractorTrait]);var mouseClickedInteractorTrait=Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_type","mouseClicked");this.slot("_subject",new Rx.Subject);this.slot("_observable",this.slot("_subject").asObservable().switchLatest())},bindActor:function(actor){if(this.slot("_bindActor")===true)debug.assert("cannot be bindActor several times");this.slot("_bindActor",true);this.slot("_observer",this.slot("_observable").subscribe(this.slot("_onNext"),this.slot("_onError"),this.slot("_onComplete")));var self=this;var button=0;var pressObs=this.exec("getCarePrimitiveEvent",actor,"mousePressed").select(function(e){button=e.sourceEvt.button;return e});var moveObs=this.exec("getCarePrimitiveEvent",actor,"mousemove").where(function(e){return e.sourceEvt.button===button});var releaseObs=this.exec("getCarePrimitiveEvent",actor,"mouseReleased").where(function(e){return e.sourceEvt.button===button});var button=0;var relObservable=pressObs.then(function(e){var downEvt=e;var clickEvt=cloneEvent(downEvt);clickEvt.type="mouseClicked";return moveObs.takeUntil(releaseObs).skipWhile(function(e){clickEvt=cloneEvent(e);clickEvt.type="mouseClicked";return testShake(downEvt,e)}).take(1).aggregate(clickEvt,function(clickEvt,e){return false}).where(function(e){return e})});this.slot("_subject").onNext(relObservable)},unbindActor:function(actor){this.execProto("unbindActor",actor)}});var MouseClickedInteractor=Interactor.extend([mouseClickedInteractorTrait]);var mouseDraggedInteractorTrait=Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_type","mouseDragged");this.slot("_subject",new Rx.Subject);this.slot("_observable",this.slot("_subject").asObservable().switchLatest())},bindActor:function(actor){if(this.slot("_bindActor")===true)debug.assert("cannot be bindActor several times");this.slot("_bindActor",true);this.slot("_observer",this.slot("_observable").subscribe(this.slot("_onNext"),this.slot("_onError"),this.slot("_onComplete")));var self=this;var button=0;var dragStartObs=this.exec("getCarePrimitiveEvent",actor,"mousePressed").select(function(e){button=e.sourceEvt.button;return e});var moveObs=this.exec("getCarePrimitiveEvent",actor,"mousemove").where(function(e){return e.sourceEvt.button===button});var dragEndObs=this.exec("getCarePrimitiveEvent",actor,"mouseReleased").where(function(e){return e.sourceEvt.button===button});var button=0;var relObservable=dragStartObs.select(function(e){button=e.sourceEvt.button;return e}).then(function(e){var downEvt=e;var dragObs=moveObs.merge(dragEndObs).skipWhile(function(e){return testShake(downEvt,e)});return dragObs.take(1).select(function(e){var newEvt=cloneEvent(e);newEvt.type="mouseDragged";newEvt.dragStart=true;return newEvt}).concat(dragObs.select(function(e){var newEvt=cloneEvent(e);newEvt.type="mouseDragged";if(e.type=="mouseReleased"){newEvt.dragEnd=true}return newEvt}))});this.slot("_subject").onNext(relObservable)},unbindActor:function(actor){this.execProto("unbindActor",actor)}});var MouseDraggedInteractor=Interactor.extend([mouseDraggedInteractorTrait]);exports.PrimitiveInteractor=PrimitiveInteractor;exports.MouseOverInteractor=MouseOverInteractor;exports.MouseOutInteractor=MouseOutInteractor;exports.MouseMovedInteractor=MouseMovedInteractor;exports.KeyPressedInteractor=KeyPressedInteractor;exports.KeyReleasedInteractor=KeyReleasedInteractor;exports.MousewheelInteractor=MousewheelInteractor;exports.MouseReleasedInteractor=MouseReleasedInteractor;exports.MousePressedInteractor=MousePressedInteractor;exports.MouseClickedInteractor=MouseClickedInteractor;exports.MouseDraggedInteractor=MouseDraggedInteractor}};__resources__["/__builtin__/level.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var util=require("util"),debug=require("debug"),TimeStamper=require("director").TimeStamper,Scene=require("scene").TreeScene,geo=require("geometry");var Klass=require("base").Klass,Trait=require("oo").Trait;var levelTrait=Trait.extend({initialize:function(param){this.execProto("initialize");this.slot("_timeStamper",TimeStamper.create());if(param&&param.scene)this.slot("_scene",param.scene);else this.slot("_scene",Scene.create());return this},onActive:function(director){this.slot("_scene").exec("onActive",this);this.slot("_director",director)},onDeactive:function(){this.slot("_scene").exec("onDeactive");this.slot("_director",undefined)},update:function(t){this.slot("_timeStamper").exec("adjust",t);this.slot("_scene").exec("update",t)},scene:function(){return this.slot("_scene")},setScene:function(scene){var bRunningLevel=this.slot("_director").exec("getLevel")==this;var old=this.slot("_scene");if(bRunningLevel&&old)old.exec("onDeactive",this);this.slot("_scene",scene);if(bRunningLevel&&scene)scene.exec("onActive",this);return old},getDirector:function(){return this.slot("_director")}});var Level=Klass.extend([levelTrait]);exports.Level=Level}};__resources__["/__builtin__/model.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Trait=require("oo").Trait,Klass=require("base").Klass,helper=require("helper"),debug=require("debug"),geo=require("geometry"),util=require("util");var helper=require("helper");var hvBboxTbl={model:function(m,painter){return geo.rectMake(0,0,0,0)},circle:function(m,painter){var r=m.slot("radius");return bbox=geo.rectMake(0,0,2*r,2*r)},convex:function(m,painter){var left=Infinity,top=Infinity,right=-Infinity,bottom=-Infinity;var vs=m.slot("vertexes");for(var i in vs){var p=vs[i];left=p.x<left?p.x:left;top=p.y<top?p.y:top;right=p.x>right?p.x:right;bottom=p.y>bottom?p.y:bottom}return geo.rectMake(left,top,right-left+1,bottom-top+1)},text:function(m,painter){var canvas=helper.createSketchpad();var ctx=canvas.getContext("2d");var str=m.slot("text");var font=m.slot("font");var h=parseInt(font.fontSize);var sFont=helper.joinFont(font);var oldFont=ctx.font;ctx.font=sFont;var w=ctx.measureText(str).width;ctx.font=oldFont;canvas.parentNode.removeChild(canvas);var textAlign=m.slot("textAlign");if(textAlign=="start"||textAlign=="left")return geo.rectMake(0,0,w,h);else if(textAlign=="end"||textAlign=="right")return geo.rectMake(-w,0,w,h);else if(textAlign=="center")return geo.rectMake(-w/2,0,w,h)},image:function(m,painter){var bbox=geo.rectMake(0,0,m.slot("width"),m.slot("height"));bbox.nocache=!m.slot("image").complete;return bbox},line:function(m,painter){var lineWidth=m.slot("lineWidth");if(undefined==lineWidth)lineWidth=painter.exec("getContext","2d").lineWidth;return getBBoxByLinePstns(m.slot("l"),lineWidth)},arc:function(m,painter){var x=m.slot("x"),y=m.slot("y"),radius=m.slot("radius");return new geo.Rect(x-radius,y-radius,2*radius,2*radius)},clip:function(m,painter){return geo.rectMake(0,0,m.slot("w"),m.slot("h"))},ProcedureModel:function(m,painter){return m.slot("bbox")(m,painter)},CompositeModel:function(m,painter){var b=geo.rectMake(0,0,0,0);var mat=m.slot("matrix");m.slot("models").forEach(function(subm){var subbbox=geo.rectApplyMatrix(subm.exec("bbox"),mat);b=geo.rectUnion(b,subbbox)});return b}};function registeBboxFun(type,fun){debug.assert(!hvBboxTbl[type],type+" has already exist in bbox functions table");hvBboxTbl[type]=fun}var Model=Klass.extend(undefined,{initialize:function(param){this.execProto("initialize");this.slot("cache",{});var self=this;Object.keys(param).forEach(function(key){self.slot(key,param[key])});if(param.type==undefined)this.slot("type","model")},get:function(key){return this.slot(key)},set:function(key,val){this.slot("cache",{});return this.slot(key,val)},copy:function(){return this},bbox:function(painter){var cache=this.slot("cache");if(cache.bbox!==undefined){return cache.bbox}var f=hvBboxTbl[this.slot("type")];debug.assert(f,"no bounding box calculator for the `"+this.slot("type")+"' type of model");var res=f(this,painter);if(!res.nocache){cache.bbox=res}else{cache.bbox=undefined}return res}},function(){this.slot=function(key,val){if(arguments.length==2)Model.superClass.slot.call(this,"cache",{});return Model.superClass.slot.apply(this,Array.prototype.slice.call(arguments,0))}});var CircleModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);if(param.radius==undefined)this.slot("radius",0);if(param.fillStyle==undefined)this.slot("fillStyle","rgba(255, 255, 255, 255)");this.slot("fillAlpha",param.fillAlpha===undefined?1:param.fillAlpha);this.slot("strokeAlpha",param.strokeAlpha===undefined?1:param.strokeAlpha);this.slot("strokeStyle",param.strokeStyle);this.slot("type","circle")}});var ConvexModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);if(param.vertexes==undefined)this.slot("vertexes",[]);if(param.fillStyle==undefined)this.slot("fillStyle","rgba(255, 255, 255, 255)");this.slot("fillAlpha",param.fillAlpha===undefined?1:param.fillAlpha);this.slot("strokeAlpha",param.strokeAlpha===undefined?1:param.strokeAlpha);this.slot("strokeStyle",param.strokeStyle);this.slot("type","convex")}});var setLineStyle=function(ctx,m){if(m.slot("lineWidth")!=undefined)ctx.lineWidth=m.slot("lineWidth");if(m.slot("lineCap")!=undefined)ctx.lineCap=m.slot("lineCap");if(m.slot("lineJoin")!=undefined)ctx.lineJoin=m.slot("lineJoin");if(m.slot("miterLimit")!=undefined)ctx.miterLimit=m.slot("miterLimit");if(m.slot("lineDash")!=undefined)ctx.setLineDash(m.slot("lineDash"));if(m.slot("lineDashOffset")!=undefined)ctx.lineDashOffset=m.slot("lineDashOffset");if(m.slot("strokeStyle")!=undefined)ctx.strokeStyle=m.slot("strokeStyle")};var LineModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);debug.assert(param.l!=undefined,"parameter error");this.slot("type","line");this.slot("strokeAlpha",param.strokeAlpha===undefined?1:param.strokeAlpha)}});var drawLineModel=function(model,painter){var ctx=painter.exec("getContext","2d");ctx.save();setLineStyle(ctx,model);var ls=model.slot("l");if(ls==null||ls.length<1)return;ctx.beginPath();ctx.moveTo(ls[0].x,ls[0].y);for(var i=1;i<ls.length;i++){ctx.lineTo(ls[i].x,ls[i].y)}var oldGlobalAlpha=ctx.globalAlpha;ctx.globalAlpha=model.slot("strokeAlpha");ctx.stroke();ctx.globalAlpha=oldGlobalAlpha;ctx.restore()};var getBBoxByLinePstns=function(pstns,lineWidth){var xmin,xmax,ymin,ymax;var bHorizontal=true;var bVertical=true;var firstX;var firstY;var i=0;pstns.forEach(function(pstn){if(i==0){firstX=pstn.x;firstY=pstn.y}else{if(bHorizontal&&pstn.y!=firstY)bHorizontal=false;if(bVertical&&pstn.x!=firstX)bVertical=false}if(pstn.x<xmin||xmin==undefined)xmin=pstn.x;if(pstn.x>xmax||xmax==undefined)xmax=pstn.x;if(pstn.y<ymin||ymin==undefined)ymin=pstn.y;if(pstn.y>ymax||ymax==undefined)ymax=pstn.y;++i});var bbox=new geo.Rect(xmin,ymin,xmax-xmin,ymax-ymin);if(bHorizontal){bbox.size.height=lineWidth;bbox.origin.y=bbox.origin.y-lineWidth/2}if(bVertical){bbox.size.width=lineWidth;bbox.origin.x=bbox.origin.x-lineWidth/2}return bbox};var lineHittest=function(m,x,y,painter){var isPointInLine=function(p1,p2,x,y,lineWidth){var matrix=geo.identityMatrix();var angle=geo.getVectorAngle({x:1,y:0},geo.ccpSub(p1,p2));matrix=geo.matrixRotateBy(matrix,-angle);matrix=geo.matrixTranslateBy(matrix,-p2.x,-p2.y);var localPstn=geo.pointApplyMatrix({x:x,y:y},matrix);var newp1=geo.pointApplyMatrix(p1,matrix);return geo.rectContainsPoint(new geo.Rect(0,-lineWidth/2,newp1.x,lineWidth),localPstn)};var lineWidth=m.slot("lineWidth");if(undefined==lineWidth)lineWidth=painter.exec("getContext","2d").lineWidth;var pstns=m.slot("l");return pstns.some(function(p,i){if(i==0)return false;return isPointInLine(pstns[i-1],pstns[i],x,y,lineWidth)})};require("painter").HonestPainter.register("line",{draw:drawLineModel,inside:lineHittest});var ArcModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);debug.assert(param.radius!=undefined&&param.startAngle!=undefined&&param.endAngle!=undefined,"parameter error");if(param.anticlockwise!=undefined)this.slot("anticlockwise",param.anticlockwise);else this.slot("anticlockwise",false);this.slot("type","arc")}});var drawArcModel=function(m,painter){var ctx=painter.exec("getContext","2d");ctx.save();setLineStyle(ctx,m);ctx.beginPath();ctx.arc(0,0,m.slot("radius"),m.slot("startAngle"),m.slot("endAngle"),m.slot("anticlockwise"));ctx.stroke();ctx.restore()};var arcHittest=function(m,x,y,painter){var startAngle=m.slot("startAngle");var endAngle=m.slot("endAngle");var radius=m.slot("radius");var lineWidth=m.slot("lineWidth");if(undefined==lineWidth)lineWidth=painter.exec("getContext","2d").lineWidth;var r=Math.sqrt(x*x,y*y);var isInTorus=radius-lineWidth/2<=r&&r<=radius+lineWidth/2;if(!isInTorus)return false;if(2*Math.PI<=endAngle-startAngle||endAngle-startAngle<=-2*Math.PI){return true}var startX=radius*Math.cos(startAngle);var startY=radius*Math.sin(startAngle);var angle=geo.getVectorAngle({x:startX,y:startY},{x:x,y:y})+startAngle;if(endAngle<startAngle)endAngle+=Math.PI*2;return angle>=startAngle&&angle<=endAngle};require("painter").HonestPainter.register("arc",{draw:drawArcModel,inside:arcHittest});var TextModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);if(param.text==undefined)this.slot("text","");var sFont;if(param.font==undefined)sFont="18px arial";else sFont=param.font;var font=helper.parseFont(sFont);if(param.fontVariant)font.fontVariant=param.fontVariant;if(param.fontWeight)font.fontWeight=param.fontWeight;if(param.fontSize)font.fontSize=param.fontSize;if(param.lineHeight)font.lineHeight=param.lineHeight;if(param.fontFamily)font.fontFamily=param.fontFamily;this.slot("font",font);if(param.fillStyle==undefined)this.slot("fillStyle","rgba(255, 255, 255, 255)");this.slot("textAlign",param.textAlign===undefined?"start":param.textAlign);this.slot("type","text")}});var defaultWidthForUnloaded=100;var defaultHeightForUnloaded=100;var ImageModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);if(param.image==undefined)this.slot("image",helper.loadImage(""));if(param.fillStyle==undefined)this.slot("fillStyle","rgba(255, 255, 255, 255)");if(param.alpha==undefined)this.slot("alpha",1);this.slot("type","image")}},function(){this.slot=function(key,val){var slotVal=ImageModel.superClass.slot.apply(this,Array.prototype.slice.call(arguments,0));if((key=="width"||key=="height")&&slotVal===undefined){var img=this.slot("image");if(img.complete||img.readyState==="complete")return img[key];else return key=="width"?defaultWidthForUnloaded:defaultHeightForUnloaded}return slotVal}});var ClipModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);this.slot("type","clip");if(param.x==undefined)this.slot("x",0);if(param.y==undefined)this.slot("y",0);if(param.w==undefined)this.slot("w",0);if(param.h==undefined)this.slot("h",0);debug.assert(typeof this.slot("x")=="number"&&typeof this.slot("y")=="number"&&typeof this.slot("w")=="number"&&typeof this.slot("h")=="number"&&this.slot("model"),"ClipModel parameter error!")}});var viewClipModel=function(){var offscreen_buffer;return function(model,painter){debug.assert(model.slot("type")=="clip"&&model.slot("model"),"bad model");var pjs=painter.exec("getContext","2d");var octx=pjs;octx.beginPath();octx.rect(0,0,model.slot("w"),model.slot("h"));octx.clip();octx.translate(-model.slot("x"),-model.slot("y"));painter.exec("draw",model.slot("model"))}}();function clipModelInside(model,x,y,painter){return 0<=x&&x<=model.slot("w")&&0<=y&&y<=model.slot("h")&&painter.exec("inside",model.slot("model"),{x:x+model.slot("x"),y:y+model.slot("y")},painter)}require("painter").HonestPainter.register("clip",{draw:viewClipModel,inside:clipModelInside});var ProcedureModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);this.slot("type","ProcedureModel");if(param.draw==undefined)this.slot("draw",function(){});if(param.bbox==undefined)this.slot("bbox",function(){return geo.rectMake(0,0,0,0)});if(param.inside==undefined)this.slot("inside",function(){return false})}});var drawProcModel=function(m,painter){return m.slot("draw")(m,painter)};var testInsideProcModel=function(m,x,y,painter){return m.slot("inside")(m,x,y,painter)};require("painter").HonestPainter.register("ProcedureModel",{draw:drawProcModel,inside:testInsideProcModel});var BuildingModel=function(alpha,model){var draw=function(m,painter){var octx=painter.exec("getContext","2d");octx.save();if(m.slot("shelterSprites")&&m.slot("shelterSprites").length>0){debug.warning("how to set alpha in inner image model");octx.globalAlpha=alpha}painter.exec("draw",m.slot("model"));octx.restore()};var bbox=function(m,painter){return m.slot("model").exec("bbox",painter)};var testInside=function(m,x,y,painter){return painter.exec("inside",m.slot("model"),x,y,painter)};return ProcedureModel.create({draw:draw,bbox:bbox,inside:testInside,alpha:alpha,model:model})};var CompositeModel=Model.extend(undefined,{initialize:function(param){this.execProto("initialize",param);this.slot("type","CompositeModel");if(param.matrix==undefined)this.slot("matrix",geo.identityMatrix());if(param.models==undefined)this.slot("models",[])},copy:function(){var param={};this.ownSlotKeys().forEach(function(n){param[n]=this.slot(n)},this);if(typeof param.matrix!="function")param.matrix=util.copy(param.matrix);param.models=param.models.map(function(m){return m.exec("copy")});return CompositeModel.create(param)}},function(cls){this.slot=function(key,val){if(arguments.length==1&&key=="matrix"){var mat=CompositeModel.superClass.slot.call(this,key);if(typeof mat=="function")return mat();return mat}return CompositeModel.superClass.slot.apply(this,Array.prototype.slice.call(arguments,0))}});var copyModel=function(m){return m.exec("copy")};var tagModel=function(m,tag){return CompositeModel.create({tag:tag,models:[m]})};var translateModel=function(m,x,y){return CompositeModel.create({matrix:geo.matrixTranslateBy(geo.identityMatrix(),x,y),models:[m]})};var rotateModel=function(m,r){return CompositeModel.create({matrix:geo.matrixRotateBy(geo.identityMatrix(),r),models:[m]})};var scaleModel=function(m,sx,sy){return CompositeModel.create({matrix:geo.matrixScaleBy(geo.identityMatrix(),sx,sy),models:[m]})};var transformModel=function(m,matrix){return CompositeModel.create({matrix:matrix,models:[m]})};var moveRelative=function(ratioX,ratioY,m){var mat=function(painter){var bbox=m.exec("bbox",painter);return geo.matrixTranslateBy(geo.identityMatrix(),bbox.size.width*ratioX,bbox.size.height*ratioY)};return CompositeModel.create({matrix:mat,models:[m]})};var drawCompositeModel=function(m,painter){var pjs=painter.exec("getContext","2d");var mat=m.slot("matrix");pjs.save();pjs.transform(mat.a,mat.b,mat.c,mat.d,mat.tx,mat.ty);m.slot("models").forEach(function(m){painter.exec("draw",m)});pjs.restore()};var inside=function(m,x,y,painter){var matrix=geo.matrixInvert(m.slot("matrix")),newpos=geo.pointApplyMatrix({x:x,y:y},matrix),path=true,subpath=false,tag=m.slot("tag");var bHit=m.slot("models").slice(0).reverse().some(function(subm){subpath=painter.exec("inside",subm,newpos,painter);if(subpath)return true;return false});if(bHit){if(subpath===true){return tag?tag:true}else{debug.assert(subpath.length>0,"logical error");return(tag?tag+"/":"")+subpath}}return false};require("painter").HonestPainter.register("CompositeModel",{draw:drawCompositeModel,inside:inside});var getModelsByPath=function(m,path,ret){var paths=path.split("/");if(paths.length==0)return false;ret.push(m);if(m.slot("tag")==paths[0]){paths.splice(0,1);if(paths.length==0)return true}var bFind=m.slot("models").filter(function(m){if(m.slot("type")=="CompositeModel")return true}).some(function(subm){if(true==getModelsByPath(subm,paths.join("/"),ret)){return true}return false});if(bFind==false){ret.pop(m);return false}return true};var relativePstn=function(m,pstn,path){var ms=[];if(false===getModelsByPath(m,path,ms)){return}var mat=geo.identityMatrix();ms.forEach(function(am){var m=am.slot("matrix");geo.matrixMultBy(mat,m)});geo.matrixInvertBy(mat);return geo.pointApplyMatrix(pstn,mat)};var getPath=function(pm,m){var _getPath=function(pm,m,paths){if(pm.slot("tag"))paths.push(pm.slot("tag"));if(pm==m)return true;var bFind=pm.slot("models").some(function(pm){if(_getPath(pm,m,paths)==true){return true}return false});if(false==bFind){if(pm.slot("tag"))ret.paths.pop();return false}return true};var paths=[];if(false==_getpath(pm,m,paths)){return false}else return paths.join("/")};var findModel=function(m,path){var ms=[];if(getModelsByPath(m,path,ms)===false)return;return ms[ms.length-1]};var removeModel=function(m,path){var ms=[];if(getModelsByPath(m,path,ms)===false)return;if(ms.length<2)return;var pm=ms[ms.length-2],dm=ms[ms.length-1],pms=pm.slot("models");pms.splice(pms.indexOf(dm),1);pm.slot("models",pms);return dm};var replaceModel=function(m,path,nm){var ms=[];if(getModelsByPath(m,path,ms)===false)return;if(ms.length<2)return;var pm=ms[ms.length-2],dm=ms[ms.length-1],pms=pm.slot("models");pms.splice(pms.indexOf(dm),1,nm);pm.slot("models",pms);return dm};var addModel=function(m,nm,path){if(path===undefined&&m.slot("type")=="CompositeModel"){m.slots("models").push(nm);return nm}var ms=[];if(getModelsByPath(m,path,ms)===false)return;ms[ms.length-1].slot("models").push(nm);return nm};var overlap=function(){var models=Array.prototype.slice.call(arguments,0);return CompositeModel.create({matrix:geo.identityMatrix(),models:models})};var alignByBbox=function(bHorizontal,bVertical,spaceX,spaceY){var mat=geo.identityMatrix();var models=Array.prototype.slice.call(arguments,4);var xOffset=0,yOffset=0;var nmodels=models.map(function(m,i){var mat=geo.matrixTranslateBy(geo.identityMatrix(),xOffset,yOffset,0);var nm=CompositeModel.create({matrix:mat,models:[m]});var bbox=m.exec("bbox");if(bHorizontal)xOffset+=bbox.size.width+spaceX;if(bVertical)yOffset+=bbox.size.height+spaceY;return nm});return overlap.apply(undefined,nmodels)};var hAlign=function(s){var args=Array.prototype.slice.call(arguments,1);args.splice(0,0,true,false,s,0);return alignByBbox.apply(undefined,args)};var vAlign=function(s){var args=Array.prototype.slice.call(arguments,1);args.splice(0,0,false,true,0,s);return alignByBbox.apply(undefined,args)};var _changeModelProxy=function(m,painter,dosomething){var subm=m.slot("models")[0];var prop=m.slot("prop");var val=m.slot("val");var changer=m.slot("changer");var restorer=m.slot("restorer");var old;if(changer)old=changer(subm,val);else{old={prop:prop,val:subm.slot(prop)};subm.slot(prop,val)}var ret=dosomething(subm);if(restorer){restorer(subm,old)}else subm.slot(old.prop,old.val);return ret};var _changeModelDraw=function(m,painter){return _changeModelProxy(m,painter,function(subm){return subm.exec("bbox",painter)})};var _changeModelbbox=function(m,painter){return _changeModelProxy(m,painter,function(subm){return subm.exec("bbox",painter)})};var _changeModelInside=function(m,x,y,painter){return _changeModelProxy(m,painter,function(subm){return painter.exec("inside",subm,{x:x,y:y},painter)})};var changePropModel=function(m,prop,val,changer,restorer){return ProcedureModel.create({models:[m],draw:_changeModelDraw,bbox:_changeModelbbox,inside:_changeModelInside,prop:prop,val:val,changer:changer,restorer:restorer})};exports.Model=Model;exports.ArcModel=ArcModel;exports.LineModel=LineModel;exports.CircleModel=CircleModel;exports.ConvexModel=ConvexModel;exports.TextModel=TextModel;exports.ImageModel=ImageModel;exports.ClipModel=ClipModel;exports.ProcedureModel=ProcedureModel;exports.BuildingModel=BuildingModel;exports.CompositeModel=CompositeModel;exports.copyModel=copyModel;exports.tagModel=tagModel;exports.translateModel=translateModel;exports.rotateModel=rotateModel;exports.scaleModel=scaleModel;exports.transformModel=transformModel;exports.moveRelative=moveRelative;exports.getModelsByPath=getModelsByPath;exports.relativePstn=relativePstn;exports.getPath=getPath;exports.findModel=findModel;exports.removeModel=removeModel;exports.replaceModel=replaceModel;exports.addModel=addModel;exports.overlap=overlap;exports.hAlign=hAlign;exports.vAlign=vAlign;exports.changePropModel=changePropModel;exports.registeBboxFun=registeBboxFun}};__resources__["/__builtin__/node.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Klass=require("base").Klass,Trait=require("oo").Trait,transformableTrait=require("transformable").transformableTrait,debug=require("debug"),geo=require("geometry"),interactorTrait=require("actortraits").interactorTrait;var actorTrait=Trait.extend({initialize:function(param){param=param?param:{};this.execProto("initialize");this.slot("_satelliteData",{});this.slot("_updates",[]);this.slot("_scene",param.scene);this.slot("_model",param.model);this.slot("_type",param.type);this.slot("_alpha",param.alpha);this.exec("transformableInitialize",require("director").timeStamp);this.exec("interactorInitialize",param);return this},type:function(){return this.slot("_type")},model:function(){return this.slot("_model")},bbox:function(painter){return geo.rectApplyMatrix(painter.exec("bbox",this.exec("model")),this.exec("matrix"))},setModel:function(model){var oldOne=this.slot("_model");this.slot("_model",model);return oldOne},emmitModels:function(v){v.push({model:this.exec("model"),effect:{matrix:this.exec("matrix"),alpha:this.slot("_alpha")}});return v},emmitControlModels:function(v){return this.exec("emmitModels",v)},getScene:function(){return this.slot("_scene")},setScene:function(s){var oldS=this.exec("getScene");this.slot("_scene",s);return oldS},onActive:function(){this.exec("interactorOnActive")},onDeactive:function(){this.exec("interactorOnDeactive")},onEntered:function(){},onExit:function(){},regUpdate:function(update){debug.assert(-1==this.slot("_updates").indexOf(update),"logical error");this.slot("_updates").push(update)},unRegUpdate:function(update){debug.assert(-1!=this.slot("_updates").indexOf(update),"logical error");var updates=this.slot("_updates");updates.splice(updates.indexOf(update),1)},update:function(t){this.slot("_updates").forEach(function(u){u.call(undefined,t,this)},this)},querySatelliteData:function(sname,initVal){debug.assert(!this.slot("_satelliteData").hasOwnProperty(sname),"cannot query satellite data:"+sname);this.slot("_satelliteData")[sname]=initVal;return initVal},satelliteData:function(sname,val){if(arguments.length==1){return this.slot("_satelliteData")[sname]}else{this.slot("_satelliteData")[sname]=val;return val}},getPosition:function(){var mat=this.exec("matrix");return{x:mat.tx,y:mat.ty,z:mat.tz}}});var Actor=Klass.extend([actorTrait,transformableTrait.rename({initialize:"transformableInitialize"}),interactorTrait.rename({initialize:"interactorInitialize",onActive:"interactorOnActive",onDeactive:"interactorOnDeactive"})]);var NtreeNodeTrait=Trait.extend({initialize:function(param){this.execProto("initialize",param);this.slot("_parent",undefined);var children=[];this.slot("_children",children);if(param.children)param.children.forEach(function(c){children.push(c)});this.slot("_actor",param.actor)},onActive:function(scene,level){this.exec("forEachActor",function(c){c.exec("onActive",scene,level)})},onDeactive:function(scene,level){this.exec("forEachActor",function(c){c.exec("onDeactive",scene,level)})},onEntered:function(scene){this.exec("forEachActor",function(c){c.exec("onEntered",scene)})},onExit:function(scene){this.exec("forEachActor",function(c){c.exec("onExit",scene)})},parent:function(){return this.slot("_parent")},actor:function(){return this.slot("_actor")},children:function(){return this.slot("_children")},appendChild:function(child){debug.assert(NTreeNode.isPrototypeOf(child),"parameter error");debug.assert(child.slot("_parent")==undefined,"parameter error");this.slot("_children").push(child);child.slot("_parent",this);if(!child.slot("_actor")){return}var getDepActor=function(node){if(!node)return;var actor=node.slot("_actor");if(actor)return actor;return getDepActor(node.slot("_parent"))};var depActor=getDepActor(this);if(depActor)child.slot("_actor").exec("setDepTransformable",depActor)},removeChild:function(child){debug.assert(NTreeNode.isPrototypeOf(child),"parameter error");var idx=this.slot("_children").indexOf(child);debug.assert(idx!=-1,"logical error, You remove an unexist child");var childActor=child.slot("_actor");if(childActor){childActor.exec("setDepTransformable",null)}child.slot("_parent",null);this.slot("_children").splice(idx,1)},some:function(f){var children=this.exec("children");if(true==f(this))return true;return children.some(function(child){return child.exec("some",f)})},someActor:function(f){var newf=function(n){var a=n.exec("actor");if(a)return f(a);return false};return this.exec("some",newf)},reduce:function(f,initialize){var bInitializeSupplied=arguments.length==2;var ret;if(false==bInitializeSupplied){ret=this}else{ret=f(initialize,this)}var children=this.slot("_children");ret=children.reduce(function(prev,cur){return cur.exec("reduce",f,prev)},ret);return ret},reduceActor:function(f,initialize){var newf=function(prev,curn){var actor=curn.exec("actor");if(actor)return f(prev,actor);return prev};if(arguments.length==2)return this.exec("reduce",newf,initialize);else return this.exec("reduce",newf)},forEach:function(f){var newf=function(prev,cur){f(cur)};return this.exec("reduce",newf,undefined)},forEachActor:function(f){var newf=function(prev,cur){f(cur)};return this.exec("reduceActor",newf,undefined)},serializeChildren:function(arr,filter){return this.exec("reduce",function(prev,n){if(filter==undefined||filter(n))prev.push(n);return prev},arr)},serializeChildrenActors:function(arr,filter){return this.exec("reduce",function(prev,n){var actor=n.exec("actor");if(actor!=undefined&&(filter==undefined||filter(actor)))prev.push(actor);return prev},arr)}});var NTreeNode=Klass.extend([NtreeNodeTrait]);exports.Actor=Actor;exports.NTreeNode=NTreeNode}};__resources__["/__builtin__/scene.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var debug=require("debug"),NTreeNode=require("node").NTreeNode,TimeStamper=require("director").TimeStamper,geo=require("geometry"),Klass=require("base").Klass,Trait=require("oo").Trait;var sceneTrait=Trait.extend({initialize:function(param){this.execProto("initialize")},addNode:function(){debug.error("cannot be here")},onActive:function(level){debug.error("cannot be here")},onDeactive:function(){debug.error("cannot be here")},update:function(t){this.exec("doUpdate",t)},filt:function(filter){debug.error("cannot be here")}});var Scene=Klass.extend([sceneTrait]);var treeSceneTrait=Trait.extend({initialize:function(param){this.execProto("initialize");this.slot("_root",NTreeNode.create({scene:this}));this.slot("_root").exec("onEntered")},doUpdate:function(t){this.slot("_root").exec("forEachActor",function(a){a.tryExec("update",t)})},onActive:function(level){this.slot("_ownerLevel",level);var root=this.slot("_root");if(root)root.exec("onActive",this,level)},onDeactive:function(level){this.slot("_ownerLevel",undefined);var root=this.slot("_root");if(root)root.exec("onDeactive",this,level)},addNode:function(node,path){if(path===undefined)path=this.slot("_root");debug.assert(this.exec("isNodeInScene",path)==true,"path is not in this scene");if(node.exec("parent")!=undefined)this.exec("removeNode",node);path.exec("appendChild",node);var runningLevel=this.slot("_ownerLevel").exec("getDirector").exec("getLevel");var bRunningScene=runningLevel&&this==runningLevel.exec("scene");if(bRunningScene){node.exec("onActive",this,runningLevel)}node.exec("onEntered",this)},isNodeInScene:function(n){var root=this.slot("_root");var bIn=false;if(!root)return false;return root.exec("some",function(n1){return n1==n})},getNodeByActor:function(a){var retNode;var root=this.slot("_root");if(!root)return undefined;root.exec("some",function(n){if(a==n.exec("actor")){retNode=n;return true}return false});return retNode},addActor:function(a,pa){var path;if(pa==undefined){path=this.slot("_root")}else path=this.exec("getNodeByActor",pa);debug.assert(path,"parameter error in addActor");var node=this.exec("createNode",{actor:a});return this.exec("addNode",node,path)},createNode:function(param){return NTreeNode.create(param)},removeNode:function(node){debug.assert(this.exec("isNodeInScene",node)==true,"remove nonexist node");var runningLevel=this.slot("_ownerLevel").exec("getDirector").exec("getLevel");var bRunningScene=runningLevel&&runningLevel.exec("scene")==this;if(node.exec("parent")){if(bRunningScene)node.exec("onDeactive",this,runningLevel);node.exec("onExit",this);return node.exec("parent").exec("removeChild",node)}else if(node&&node==this.slot("_root")){var oldOne=this.slot("_root");if(bRunningScene)oldOne.exec("onDeactive",this,runningLevel);oldOne.exec("onExit",this);var root=NTreeNode.create({scene:this});this.slot("_root",root);return oldOne}},removeActor:function(actor){var node=this.exec("getNodeByActor",actor);debug.assert(node!=undefined,"remove unexist actor");return this.exec("removeNode",node)},filt:function(container,filter){return this.slot("_root").exec("serializeChildrenActors",container,filter)}});var TreeScene=Scene.extend([treeSceneTrait]);exports.TreeScene=TreeScene}};__resources__["/__builtin__/view/index.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){exports.TopView=require("./topview").TopView}};__resources__["/__builtin__/view/topview.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var debug=require("debug");var util=require("util");var geo=require("geometry");var Klass=require("base").Klass;var transformableTrait=require("transformable").transformableTrait;var displaylist=[];var actorlist=[];var view=function(painter,scene){displaylist.length=0;actorlist.length=0;scene.exec("filt",actorlist,function(a){return a!=undefined});actorlist.forEach(function(a){return a.exec("emmitModels",displaylist)});displaylist.sort(function(i1,i2){return i1.effect.matrix.tz-i2.effect.matrix.tz});painter.exec("drawModels",displaylist)};var cmpZ=function(n1,n2,painter){var m1=n1.exec("matrix");var m2=n2.exec("matrix");var ret=m1.tz-m2.tz;return ret};var View=Klass.extend([transformableTrait.rename({initialize:"transformableTraitInitialize"})],{initialize:function(param){this.execProto("initialize",param);this.exec("transformableTraitInitialize",require("director").timeStamp);this.slot("comparator",cmpZ)},getPstnRelativeToModel:function(viewPstn,model,effect){var mat=geo.matrixInvert(geo.matrixMult(this.exec("getGameToViewMatrix"),effect.matrix));return geo.pointApplyMatrix(viewPstn,mat)},compareModel:function(painter,model1,matrix1,model2,matrix2){if(matrix1.tz==undefined||matrix2.tz==undefined)return 0;return matrix2.tz-matrix1.tz},view:function(painter,scene){var ctx=painter.exec("getContext","2d");ctx.save();var mat=this.exec("matrix");ctx.setTransform(mat.a,mat.b,mat.c,mat.d,mat.tx,mat.ty);view(painter,scene);ctx.restore()},getGameToViewMatrix:function(){return this.exec("matrix")}});exports.TopView=View}};__resources__["/main.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){function main(){window.Nev={addEventListener:function(node,type,listener){if(!node||!type||!listener){return}if(node.addEventListener){node.addEventListener(type,listener,false)}else if(node.attachEvent){node.attachEvent("on"+type,listener)}},removeEventListener:function(node,type,listener){if(!node||!type||!listener){return}if(node.removeEventListener){node.removeEventListener(type,listener,false)}else if(node.detachEvent){node.detachEvent("on"+type,listener)}}};Date.prototype.formatter=function(fmt){var o={"M+":this.getMonth()+1,"D+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};var week={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};if(/(Y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}if(/(E+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+week[this.getDay()+""])}for(var k in o){if((new RegExp("("+k+")")).test(fmt)){fmt=fmt.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return fmt};Nev.Cloud=require("nev.cloud").Cloud;Nev.LineChart=require("nev.line").Line;Nev.AreaChart=require("nev.area").Area;Nev.BarChart=require("nev.bar").Bar;Nev.ColumnChart=require("nev.column").Column;Nev.PieChart=require("nev.pie").Pie;Nev.PlotChart=require("nev.plot").Plot;Nev.RadiateSpreadChart=require("radiatespreadchart").RadiateSpreadChart}exports.main=main}};__resources__["/nev.area.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Chart=require("nev.lineBaseChart").LineBaseChart;Nev.Area=function(param){var defaults={listener:function(x,y,color,name){if(x==null&&y==null){return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+name+"</div>"}else if(name==null){return"<div style=border-style:solid;border-color:"+color+";background:"+color+";border-width:2px;border-radius:6px;>"+"date："+x+"<br/>"+"value："+y+"</div>"}else{return"<div style=border-style:solid;border-color:"+color+";background:"+color+";border-width:2px;border-radius:6px;>"+"date："+x+"<br/>"+"value："+y+"</br>"+"数据名称："+name+"</div>"}},style:{titleFontSize:30,titleFontColor:"#FF0000",titleBg:"",titleAlign:"center",seriesLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],seriesLineAlpha:[.2,.2,.2,.2,.2],seriesLineWidth:[1,1,1,1,1],seriesBallRadius:5,seriesBallColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],axisFontSize:14,axisFontColor:"#000000",axisFontBg:"#0000FF",axisOffsetX:10,axisOffsetY:5,axisFormat:"",axisAutoFormat:true,borderLineColor:"#000000",borderLineAlpha:1,borderLineWidth:1,borderPadding:[50,50,50,50],gridborder:true,gridcolumn:"auto",gridrow:"auto",gridLineColor:"#000000",gridLineAlpha:.3,gridLineWidth:1,gridDirection:"both",warningLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],warningLineAlpha:[1,1,1,1,1],warningLineWidth:[2,2,2,2,2],legend:true,legendOffset:10}};var merge=function(defaults,userDefined){var obj={};for(var key in defaults){obj[key]=defaults[key]}for(var key in userDefined){if(key==="listener")obj[key]=userDefined[key];if(obj[key]){if(obj[key]){for(var tmp in userDefined[key]){obj[key][tmp]=userDefined[key][tmp]}}else{obj[key]=userDefined[key]}}else{obj[key]=userDefined[key]}}return obj};param=merge(defaults,param);param.area=true;var chart=Chart.create(param);return{updata:function(param){chart.exec("updata",param)}}};exports.Area=Nev.Area}};__resources__["/nev.areaModel.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model"),geo=require("geometry"),AreaModel=m.LineModel.extend(undefined,{initialize:function(param){this.execProto("initialize",param);this.slot("type","area")}}),setLineStyle=function(ctx,m){if(m.slot("lineWidth")!=undefined)ctx.lineWidth=m.slot("lineWidth");if(m.slot("lineCap")!=undefined)ctx.lineCap=m.slot("lineCap");if(m.slot("lineJoin")!=undefined)ctx.lineJoin=m.slot("lineJoin");if(m.slot("miterLimit")!=undefined)ctx.miterLimit=m.slot("miterLimit");if(m.slot("lineDash")!=undefined)ctx.setLineDash(m.slot("lineDash"));if(m.slot("lineDashOffset")!=undefined)ctx.lineDashOffset=m.slot("lineDashOffset");if(m.slot("strokeStyle")!=undefined)ctx.strokeStyle=m.slot("strokeStyle")},drawAreaModel=function(model,painter){var ctx=painter.exec("getContext","2d");ctx.save();setLineStyle(ctx,model);var ls=model.slot("l");if(ls==null||ls.length<1)return;ctx.beginPath();ctx.moveTo(ls[0].x,ls[0].y);for(var i=1;i<ls.length;i++){ctx.lineTo(ls[i].x,ls[i].y)}ctx.globalAlpha=model.slot("strokeAlpha");ctx.stroke();ctx.lineTo(ls[ls.length-1].x,model.slot("endY"));ctx.lineTo(model.slot("startX"),model.slot("endY"));ctx.globalAlpha=model.slot("fillAlpha");ctx.fillStyle=model.slot("fillStyle");ctx.fill();ctx.restore()},areaHittest=function(m,x,y,painter){var isPointInLine=function(p1,p2,x,y,lineWidth){var matrix=geo.identityMatrix();var angle=geo.getVectorAngle({x:1,y:0},geo.ccpSub(p1,p2));matrix=geo.matrixRotateBy(matrix,-angle);matrix=geo.matrixTranslateBy(matrix,-p2.x,-p2.y);var localPstn=geo.pointApplyMatrix({x:x,y:y},matrix);var newp1=geo.pointApplyMatrix(p1,matrix);return geo.rectContainsPoint(new geo.Rect(0,-lineWidth/2,newp1.x,lineWidth),localPstn)};var lineWidth=m.slot("lineWidth");if(undefined==lineWidth)lineWidth=painter.exec("getContext","2d").lineWidth;var pstns=m.slot("l");return pstns.some(function(p,i){if(i==0)return false;return isPointInLine(pstns[i-1],pstns[i],x,y,lineWidth)})};require("painter").HonestPainter.register("area",{draw:drawAreaModel,inside:areaHittest});exports.AreaModel=AreaModel}};__resources__["/nev.areaSeries.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var AreaModel=require("nev.areaModel").AreaModel;var Actor=require("node").Actor;Nev.AreaSeries=Actor.extend([],{initialize:function(param){var t=this;t.execProto("initialize",param);t.style=param.style;t.index=param.index;t.startX=param.startX;t.endY=param.endY;t.path=[]},setPath:function(xpos,ypos){this.path.push({x:xpos,y:ypos})},render:function(){var t=this;t.exec("setModel",AreaModel.create({l:t.path,fillAlpha:t.style.seriesLineAlpha[t.index],startX:t.startX,endY:t.endY,lineWidth:t.style.seriesLineWidth[t.index],fillStyle:t.style.seriesLineColor[t.index],strokeStyle:t.style.seriesLineColor[t.index]}))}});exports.AreaSeries=Nev.AreaSeries}};__resources__["/nev.bar.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Chart=require("nev.barBaseChart").BarBaseChart;Nev.Bar=function(param){var defaults={listener:function(x,y,color,name){if(x==null&&y==null){return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+name+"</div>"}else{return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+x+"<br/>"+y+"</br>"+name+"</div>"}},style:{titleFontSize:30,titleFontColor:"#FF0000",titleBg:"",titleAlign:"center",seriesLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],seriesLineAlpha:[1,1,1,1,1],seriesLineWidth:[2,2,2,2,2],seriesBallRadius:5,seriesBallColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],axisFontSize:12,axisFontColor:"#000000",axisFontBg:"#0000FF",axisOffsetX:5,axisOffsetY:5,axisFormat:"",Offset:10,axisAutoFormat:true,borderLineColor:"#000000",borderLineAlpha:1,borderLineWidth:1,borderPadding:[50,50,50,50],gridborder:true,gridcolumn:"auto",gridrow:"auto",gridLineColor:"#000000",gridLineAlpha:.3,gridLineWidth:1,gridDirection:"vertical",warningLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],warningLineAlpha:[1,1,1,1,1],warningLineWidth:[2,2,2,2,2],legend:true,legendOffset:10}};var merge=function(defaults,userDefined){var obj={};for(var key in defaults){obj[key]=defaults[key]}for(var key in userDefined){if(key==="listener")obj[key]=userDefined[key];if(obj[key]){if(obj[key]){for(var tmp in userDefined[key]){obj[key][tmp]=userDefined[key][tmp]}}else{obj[key]=userDefined[key]}}else{obj[key]=userDefined[key]}}return obj};param=merge(defaults,param);var chart=Chart.create(param);return{updata:function(param){chart.exec("updata",param)}}};exports.Bar=Nev.Bar}};__resources__["/nev.barBaseChart.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;var ChartBase=require("nev.chartBase").ChartBase;var LinearAxis=require("nev.linearAxis").LinearAxis;var CategoryAxis=require("nev.categoryAxis").CategoryAxis;var interactor=require("interactor");var Grid=require("nev.grid").Grid;var Label=require("nev.label").Label;var Level=require("level").Level;var BarSeries=require("nev.barSeries").BarSeries;Nev.BarBaseChart=ChartBase.extend([],{initialize:function(param){var t=this;t.gRender=t.execProto("initialize",param.render);t.param=param;t.exec("doConfig")},updata:function(param){var t=this;if(t.exec("isArray",param)){var node=t.gRender.childNodes;var length=node.length-1;while(length>0){if(node[length].nodeType===1){if(node[length].nodeName!="CANVAS"){t.gRender.removeChild(node[length]);length=node.length-1}}}t.gLevel=Level.create();t.gScene=t.gLevel.exec("scene");t.gDirector.exec("setLevel",t.gLevel);t.param.data=param;t.exec("doConfig")}},doConfig:function(){var i,temp,key,dataV=[],dataH=[],t=this;for(i=0;i<t.param.data.length;i++){temp=t.param.data[i];for(key in temp){if(t.exec("isNumber",temp[key])){dataH.push(temp[key])}else{dataV.push(temp[key])}}}var contentW=t.width-(t.param.style.borderPadding[0]+t.param.style.borderPadding[2]);var contentH=t.height-(t.param.style.borderPadding[1]+t.param.style.borderPadding[3]);var verticalAxis=CategoryAxis.create({data:dataV,style:t.param.style,direction:"vertical"});var vLabel=verticalAxis.exec("setRectangle");t.gRender.appendChild(vLabel);var horizontalAxis=LinearAxis.create({data:dataH,style:t.param.style,direction:"horizontal"});var hLabel=horizontalAxis.exec("setRectangle");t.gRender.appendChild(hLabel);var th=(contentH-(t.param.data.length+1)*t.param.style.Offset)/t.param.data.length;var tw=hLabel.offsetWidth>=vLabel.offsetWidth?hLabel.offsetWidth*2:vLabel.offsetWidth*2;t.gRender.removeChild(hLabel);t.gRender.removeChild(vLabel);var backgroundElement=Grid.create({tw:tw,th:th,width:contentW,height:contentH,style:t.param.style,director:t.gDirector});backgroundElement.exec("translate",t.param.style.borderPadding[0],t.param.style.borderPadding[1],-200);t.gScene.exec("addActor",backgroundElement);verticalAxis.exec("position",t.gRender,backgroundElement);horizontalAxis.exec("position",t.gRender,backgroundElement);if(t.param.title){var title=new Label({text:t.param.title});title.style.color=t.param.style.titleFontColor;title.style.fontSize=t.param.style.titleFontSize+"px";if(t.param.style.titleBg)title.style.backgroundColor=t.param.style.titleBg;title.style.width=backgroundElement.width+"px";title.style.textAlign=t.param.style.titleAlign;t.gRender.appendChild(title);title.style.left=t.param.style.borderPadding[0]+"px";title.style.top=t.param.style.borderPadding[1]-title.offsetHeight+"px"}if(t.param.style.legend){var legendView=document.createElement("div");legendView.style.position="absolute";legendView.style.cursor="default";legendView.style.left=backgroundElement.style.borderPadding[0]+"px";legendView.style.top=t.height-10+"px";t.gRender.appendChild(legendView)}var onMouseOver=function(evt){evt.actor.slot("_alpha",.8);t.exec("draw")};var onMouseOut=function(evt){evt.actor.slot("_alpha",t.param.style.seriesLineAlpha[evt.actor.index]);t.exec("draw")};for(var j=0;j<dataV.length;j++){var ypos=verticalAxis.exec("point",j);var xpos=horizontalAxis.exec("point",dataH[j]);var actor=BarSeries.create({style:t.param.style,w:xpos,h:th,director:t.gDirector,index:j});actor.exec("addInteractor",interactor.MouseOverInteractor,onMouseOver);actor.exec("addInteractor",interactor.MouseOutInteractor,onMouseOut);actor.exec("translate",t.param.style.borderPadding[0],ypos);t.gScene.exec("addActor",actor);if(t.param.style.legend){var il=document.createElement("div");var el=document.createElement("div");var tl=document.createElement("div");il.appendChild(el);il.appendChild(tl);legendView.appendChild(il);il.style.display=el.style.display=tl.style.display="inline-block";el.style.width="10px";el.style.height="10px";el.style.background=actor.color;tl.innerHTML=dataV[j];tl.style.fontWeight="bold";tl.style.fontSize="12px";tl.style.marginLeft="2px";tl.title=dataV[j];if(j!=0){il.style.marginLeft=t.param.style.legendOffset+"px"}}}t.exec("draw")}});exports.BarBaseChart=Nev.BarBaseChart}};__resources__["/nev.barSeries.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;Nev.BarSeries=Actor.extend([],{initialize:function(param){var t=this;t.execProto("initialize",param);t.style=param.style;t.index=param.index;var p=[{x:0,y:0},{x:0,y:param.h},{x:param.w,y:param.h},{x:param.w,y:0},{x:0,y:0}];t.slot("_alpha",t.style.seriesLineAlpha[t.index]);if(t.style.seriesLineColor[t.index]){t.color=t.style.seriesLineColor[t.index]}else{t.color="#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6)}t.exec("setModel",m.ConvexModel.create({vertexes:p,fillStyle:t.color}))}});exports.BarSeries=Nev.BarSeries}};__resources__["/nev.categoryAxis.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Klass=require("base").Klass;var Label=require("nev.label").Label;Nev.CategoryAxis=Klass.extend([],{initialize:function(param){this.data=param.data;this.style=param.style;this.direction=param.direction},setRectangle:function(){var data=this.data,total=data.length,str;var max=0;for(var i=0;i<data.length;i++){if(data[i].length>max){max=data[i].length;str=data[i]}}var options={text:str,fontSize:this.style.axisFontSize};return new Label(options)},position:function(render,bg){var left=this.style.borderPadding[0],top=this.style.borderPadding[1],bottom=bg.height;if(this.direction=="horizontal"){this.tw=bg.tw;for(var i=0;i<this.data.length;i++){var options={text:this.data[i],fontSize:this.style.axisFontSize,color:this.style.axisFontColor};var label=new Label(options);render.appendChild(label);if(this.style.Offset){label.style.left=i*this.tw+left+this.tw*.5-label.offsetWidth*.5+(i+1)*this.style.Offset+"px"}else{label.style.left=i*this.tw+left-label.offsetWidth*.5+"px"}label.style.top=top+bottom+label.offsetHeight+this.style.axisOffsetY+"px"}}else{this.th=bg.th;for(var i=0;i<this.data.length;i++){var options={text:this.data[i],fontSize:this.style.axisFontSize,color:this.style.axisFontColor};var label=new Label(options);render.appendChild(label);label.style.left=left-label.offsetWidth-this.style.axisOffsetX+"px";label.style.top=i*this.th+top+this.th*.5-label.offsetHeight*.5+(i+1)*this.style.Offset+"px"}}},point:function(param){if(this.direction=="horizontal"){var left=this.style.borderPadding[0],pos=0;if(this.style.Offset){pos=param*this.tw+left+(param+1)*this.style.Offset}else{pos=param*this.tw+left}}else{var top=this.style.borderPadding[1],pos=param*this.th+top+(param+1)*this.style.Offset}return pos}});exports.CategoryAxis=Nev.CategoryAxis}};__resources__["/nev.chartBase.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var h=require("helper");var d=require("director");var v=require("view");var Level=require("level").Level;var painter=require("painter");var Klass=require("base").Klass;Nev.ChartBase=Klass.extend([],{initialize:function(param){var gContainer=typeof param==="string"?document.getElementById(param):param,gRender=document.createElement("div");gContainer.appendChild(gRender);gRender.name=param;gRender.style.position="relative";gRender.style.width=gRender.style.height="100%";gRender.style.top=gRender.style.left=0;var gCanvas=h.createSketchpad(gRender.clientWidth,gRender.clientHeight,gRender);var gPainter=painter.HonestPainter.create(gCanvas);var gView=v.TopView.create();this.gLevel=Level.create();this.gScene=this.gLevel.exec("scene");this.gDirector=d.Director.create({painter:gPainter,view:gView});this.gDirector.exec("setLevel",this.gLevel);this.width=gRender.clientWidth;this.height=gRender.clientHeight;return gRender},isString:function(param){return typeof param==="string"},isObject:function(param){return typeof param==="object"},isNumber:function(param){return typeof param==="number"},isArray:function(param){return Object.prototype.toString.call(param)==="[object Array]"},draw:function(){this.gDirector.exec("invalidate")}});exports.ChartBase=Nev.ChartBase}};__resources__["/nev.cloud.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){Nev.Cloud=function(param){var gContainer=typeof param.render==="string"?document.getElementById(param.render):param.render,gRender=document.createElement("div"),sizeValue=param.values,radian=Math.PI/180,tagArr,active,speed,interval,lasta,lastb,mouseX,mouseY;function initialize(){tagArr=[],active=false,speed=1,lasta=1,lastb=1,mouseX=1,mouseY=1;gRender.style.position="relative";gRender.style.width=gRender.style.height="100%";gRender.style.top=gRender.style.left=0;if(!gRender.parent)gContainer.appendChild(gRender);for(var i=0;i<param.data.length;i++){var label=new Label;gRender.appendChild(label);var temp=param.data[i];if(temp.url){label.innerHTML="<a href="+temp.url+' style="color:'+label.style.color+';text-decoration:none;" target=_blank>'+temp.name+"</a>";Nev.addEventListener(label,"mouseover",function(e){label.active=true});Nev.addEventListener(label,"mouseout",function(e){label.active=false})}else{label.innerHTML=temp.name}var length;if(temp.value.toString().indexOf(".")!=-1){var last=temp.value.toString().indexOf(".");length=temp.value.toString().slice(0,last).length}else{length=temp.value.toString().length}for(var j=0,vMax=1;j<length;j++){vMax=vMax+"0"}temp.value=temp.value/vMax;label.currentValue=temp.value;label.style.fontSize=label.currentValue+"px";label.style.left=(gRender.clientWidth-label.clientWidth)*.5+"px";label.style.top=(gRender.clientHeight-label.clientHeight)*.5+"px";tagArr.push(label)}position()}function position(){var a,b,z1,z2,r=150;tagArr.sort(function(){return Math.random()<.5?1:-1});z1=19800/(Math.exp(.5)*(1-1/Math.E))+2e4-19800/(1-1/Math.E);z2=z1;r=(gRender.offsetHeight>gRender.offsetWidth?gRender.offsetWidth:gRender.offsetHeight)*.2*(z2+z1)/z1;for(var i=1;i<tagArr.length+1;i++){a=Math.acos(-1+(2*i-1)/tagArr.length);b=Math.sqrt(tagArr.length*Math.PI)*a;tagArr[i-1].cx=r*Math.cos(b)*Math.sin(a);tagArr[i-1].cy=r*Math.sin(b)*Math.sin(a);tagArr[i-1].cz=r*Math.cos(a)}interval=setInterval(function(){enterFrame()},50)}function enterFrame(){var a,b,sa,ca,sb,cb,d=300,h=1,size=250,x1,x2,y1,y2,z1,z2,pe,fs;if(active){a=-Math.min(Math.max(mouseX,-size),size)/size*speed;b=Math.min(Math.max(mouseY,-size),size)/size*speed}else{a=lasta*.98;b=lastb*.98}lasta=a;lastb=b;if(Math.abs(a)>.01||Math.abs(b)>.01){sa=Math.sin(a*radian);ca=Math.cos(a*radian);sb=Math.sin(b*radian);cb=Math.cos(b*radian);for(var i=0;i<tagArr.length;i++){x1=tagArr[i].cx;y1=tagArr[i].cy*ca+tagArr[i].cz*-sa;z1=tagArr[i].cy*sa+tagArr[i].cz*ca;x2=x1*cb+z1*sb;y2=y1;z2=x1*-sb+z1*cb;tagArr[i].cx=x2;tagArr[i].cy=y2;tagArr[i].cz=z2;pe=d/(d+z2);tagArr[i].style.zIndex=tagArr[i].active?tagArr.length-1:i;tagArr[i].style.left=(gRender.clientWidth-tagArr[i].clientWidth)*.5+h*x2*pe-h*2+"px";tagArr[i].style.top=(gRender.clientHeight-tagArr[i].clientHeight)*.5+y2*pe+"px";fs=pe*tagArr[i].currentValue*(sizeValue[1]-sizeValue[0])+sizeValue[0];tagArr[i].style.fontSize=fs+"px"}}}function Label(){var temp=document.createElement("div");temp.style.cursor="default";temp.style.textAlign="center";temp.style.position="absolute";temp.active=false;temp.style.color="#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6);return temp}initialize();Nev.addEventListener(gRender,"mousemove",function(e){active=true;mouseX=e.clientX-(gRender.offsetLeft+gRender.offsetWidth*.5);mouseY=e.clientY-(gRender.offsetTop+gRender.offsetHeight*.5)});Nev.addEventListener(gRender,"rollout",function(e){active=false});this.addTags=function(obj){clearInterval(interval);param.data.push(obj);var length=gRender.childNodes.length-1;while(length>=0){if(gRender.childNodes[length].nodeType===1){gRender.removeChild(gRender.childNodes[length]);length=gRender.childNodes.length-1}}initialize()}};exports.Cloud=Nev.Cloud}};__resources__["/nev.column.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Chart=require("nev.columnBaseChart").ColumnBaseChart;Nev.Column=function(param){var defaults={listener:function(x,y,color,name){if(x==null&&y==null){return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+name+"</div>"}else{return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+x+"<br/>"+y+"</br>"+name+"</div>"}},style:{titleFontSize:30,titleFontColor:"#FF0000",titleBg:"",titleAlign:"center",seriesLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],seriesLineAlpha:[1,1,1,1,1],seriesLineWidth:[2,2,2,2,2],seriesBallRadius:5,seriesBallColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],axisFontSize:12,axisFontColor:"#000000",axisFontBg:"#0000FF",axisOffsetX:5,axisOffsetY:5,axisFormat:"",Offset:40,axisAutoFormat:true,borderLineColor:"#000000",borderLineAlpha:1,borderLineWidth:1,borderPadding:[50,50,50,50],gridborder:true,gridcolumn:"auto",gridrow:"auto",gridLineColor:"#000000",gridLineAlpha:.3,gridLineWidth:1,gridDirection:"horizontal",warningLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],warningLineAlpha:[1,1,1,1,1],warningLineWidth:[2,2,2,2,2],legend:true,legendOffset:10}};var merge=function(defaults,userDefined){var obj={};for(var key in defaults){obj[key]=defaults[key]}for(var key in userDefined){if(key==="listener")obj[key]=userDefined[key];if(obj[key]){if(obj[key]){for(var tmp in userDefined[key]){obj[key][tmp]=userDefined[key][tmp]}}else{obj[key]=userDefined[key]}}else{obj[key]=userDefined[key]}}return obj};param=merge(defaults,param);var chart=Chart.create(param);return{updata:function(param){chart.exec("updata",param)}}};exports.Column=Nev.Column}};__resources__["/nev.columnBaseChart.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;var ChartBase=require("nev.chartBase").ChartBase;var LinearAxis=require("nev.linearAxis").LinearAxis;var CategoryAxis=require("nev.categoryAxis").CategoryAxis;var interactor=require("interactor");var Grid=require("nev.grid").Grid;var Label=require("nev.label").Label;var Level=require("level").Level;var ColumnSeries=require("nev.columnSeries").ColumnSeries;Nev.ColumnBaseChart=ChartBase.extend([],{initialize:function(param){var t=this;t.gRender=t.execProto("initialize",param.render);t.param=param;t.exec("doConfig")},updata:function(param){var t=this;if(t.exec("isArray",param)){var node=t.gRender.childNodes;var length=node.length-1;while(length>0){if(node[length].nodeType===1){if(node[length].nodeName!="CANVAS"){t.gRender.removeChild(node[length]);length=node.length-1}}}t.gLevel=Level.create();t.gScene=t.gLevel.exec("scene");t.gDirector.exec("setLevel",t.gLevel);t.param.data=param;t.exec("doConfig")}},doConfig:function(){var i,temp,key,dataV=[],dataH=[],t=this;for(i=0;i<t.param.data.length;i++){temp=t.param.data[i];for(key in temp){if(t.exec("isNumber",temp[key])){dataV.push(temp[key])}else{dataH.push(temp[key])}}}var contentW=t.width-(t.param.style.borderPadding[0]+t.param.style.borderPadding[2]);var contentH=t.height-(t.param.style.borderPadding[1]+t.param.style.borderPadding[3]);var verticalAxis=LinearAxis.create({data:dataV,style:t.param.style,direction:"vertical"});var vLabel=verticalAxis.exec("setRectangle");t.gRender.appendChild(vLabel);var horizontalAxis=CategoryAxis.create({data:dataH,style:t.param.style,direction:"horizontal"});var hLabel=horizontalAxis.exec("setRectangle");t.gRender.appendChild(hLabel);var th=hLabel.offsetHeight>=vLabel.offsetHeight?hLabel.offsetHeight*2:vLabel.offsetHeight*2;var tw=(contentW-(t.param.data.length+1)*t.param.style.Offset)/t.param.data.length;t.gRender.removeChild(vLabel);t.gRender.removeChild(hLabel);var backgroundElement=Grid.create({tw:tw,th:th,width:contentW,height:contentH,style:t.param.style,director:t.gDirector});backgroundElement.exec("translate",t.param.style.borderPadding[0],t.param.style.borderPadding[1],-200);t.gScene.exec("addActor",backgroundElement);verticalAxis.exec("position",t.gRender,backgroundElement);horizontalAxis.exec("position",t.gRender,backgroundElement);if(t.param.title){var title=new Label({text:t.param.title});title.style.color=t.param.style.titleFontColor;title.style.fontSize=t.param.style.titleFontSize+"px";if(t.param.style.titleBg)title.style.backgroundColor=t.param.style.titleBg;title.style.width=backgroundElement.width+"px";title.style.textAlign=t.param.style.titleAlign;t.gRender.appendChild(title);title.style.left=t.param.style.borderPadding[0]+"px";title.style.top=t.param.style.borderPadding[1]-title.offsetHeight+"px"}if(t.param.style.legend){var legendView=document.createElement("div");legendView.style.position="absolute";legendView.style.cursor="default";legendView.style.left=backgroundElement.style.borderPadding[0]+"px";legendView.style.top=t.height-10+"px";t.gRender.appendChild(legendView)}var onMouseOver=function(evt){evt.actor.slot("_alpha",.8);t.exec("draw")};var onMouseOut=function(evt){evt.actor.slot("_alpha",t.param.style.seriesLineAlpha[evt.actor.index]);t.exec("draw")};for(var j=0;j<dataV.length;j++){var ypos=verticalAxis.exec("point",dataV[j]);var xpos=horizontalAxis.exec("point",j);var h1=backgroundElement.height+t.param.style.borderPadding[1];var h2=h1-ypos==0?1:h1-ypos;var actor=ColumnSeries.create({style:t.param.style,w:tw,h:h2,director:t.gDirector,index:j});actor.exec("addInteractor",interactor.MouseOverInteractor,onMouseOver);actor.exec("addInteractor",interactor.MouseOutInteractor,onMouseOut);actor.exec("translate",xpos,h1-h2-backgroundElement.style.gridLineWidth);t.gScene.exec("addActor",actor);if(t.param.style.legend){var il=document.createElement("div");var el=document.createElement("div");var tl=document.createElement("div");il.appendChild(el);il.appendChild(tl);legendView.appendChild(il);il.style.display=el.style.display=tl.style.display="inline-block";el.style.width="10px";el.style.height="10px";el.style.background=actor.color;tl.innerHTML=dataH[j];tl.style.fontWeight="bold";tl.style.fontSize="12px";tl.style.marginLeft="2px";tl.title=dataH[j];if(j!=0){il.style.marginLeft=t.param.style.legendOffset+"px"}}}t.exec("draw")}});exports.ColumnBaseChart=Nev.ColumnBaseChart}};__resources__["/nev.columnSeries.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;Nev.ColumnSeries=Actor.extend([],{initialize:function(param){var t=this;t.execProto("initialize",param);t.style=param.style;t.index=param.index;var p=[{x:0,y:0},{x:0,y:param.h},{x:param.w,y:param.h},{x:param.w,y:0},{x:0,y:0}];t.slot("_alpha",t.style.seriesLineAlpha[t.index]);if(t.style.seriesLineColor[t.index]){t.color=t.style.seriesLineColor[t.index]}else{t.color="#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6)}t.exec("setModel",m.ConvexModel.create({vertexes:p,fillStyle:t.color}))}});exports.ColumnSeries=Nev.ColumnSeries}};__resources__["/nev.dateTimeAxis.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var NumericAxis=require("nev.numericAxis").NumericAxis;var Label=require("nev.label").Label;Nev.DateTimeAxis=NumericAxis.extend([],{initialize:function(param){this.execProto("initialize",param);this.style=param.style;if(this.style.axisAutoFormat&&this.style.axisFormat===""){this.exec("dateFormatter")}},parseDate:function(value,format){var date=new Date(value);if(format){return date.formatter(this.style.axisFormat)}else{return date.formatter("YYYY/MM/DD HH:mm")}},dateFormatter:function(){var max=this.exec("parseDate",this.bounds[0],false).split("/");var min=this.exec("parseDate",this.bounds[1],false).split("/");if(max[0]===min[0]){if(max[1]===min[1]){if(max[2].slice(0,2)===min[2].slice(0,2)){this.style.axisFormat="HH:mm"}else{this.style.axisFormat="DD HH:mm"}}else{this.style.axisFormat="MM/DD"}}else{this.style.axisFormat="YYYY/MM"}},setRectangle:function(){var options={text:this.exec("parseDate",this.bounds[0],this.style.axisAutoFormat),fontSize:this.style.axisFontSize};return new Label(options)},position:function(render,bg){var max=this.bounds[0];this.min=this.bounds[1];var interval=Math.ceil((max-this.min==0?6e6:max-this.min)/bg.column);this.left=this.style.borderPadding[0];this.top=this.style.borderPadding[1];this.bottom=bg.height;this.steps=bg.tw/(interval=interval==0?1:interval);for(var i=0;i<bg.column+1;i++){var options={text:this.exec("parseDate",i*interval+this.min,this.style.axisAutoFormat),fontSize:this.style.axisFontSize,color:this.style.axisFontColor};var label=new Label(options);render.appendChild(label);label.style.left=i*bg.tw+this.left-label.offsetWidth*.5+"px";label.style.top=this.top+this.bottom+label.offsetHeight+this.style.axisOffsetY+"px"}},point:function(value){return Math.ceil((value-this.min)*this.steps+this.left)}});exports.DateTimeAxis=Nev.DateTimeAxis}};__resources__["/nev.grid.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;Nev.Grid=Actor.extend([],{initialize:function(param){this.execProto("initialize",param);this.tw=param.tw;this.th=param.th;this.style=param.style;this.width=param.width;this.height=param.height;var value=parseInt(this.height/this.th);this.th+=this.height/value-this.th;if(typeof this.style.gridcolumn==="string"){this.column=Math.floor(this.width/this.tw)}else if(typeof this.style.gridcolumn==="number"){this.column=this.style.gridcolumn;if(this.width/this.column>this.tw){this.tw+=this.width/this.column-this.tw}}if(typeof this.style.gridrow==="string"){this.row=Math.floor(this.height/this.th)}else if(typeof this.style.gridrow==="number"){this.row=this.style.gridrow;if(this.height/this.row>this.th){this.th+=this.height/this.row-this.th}}this.slot("type","Grid");if(this.style.gridborder){this.exec("setModel",m.LineModel.create({l:[{x:0,y:0},{x:0,y:this.height},{x:this.width,y:this.height},{x:this.width,y:0},{x:0,y:0}],lineWidth:this.style.borderLineWidth,strokeStyle:this.style.borderLineColor,strokeAlpha:this.style.borderLineAlpha}))}else{this.exec("setModel",m.LineModel.create({l:[{x:0,y:0},{x:this.width,y:0}],lineWidth:this.style.gridLineWidth,strokeStyle:this.style.gridLineColor,strokeAlpha:this.style.gridLineAlpha}))}},emmitModels:function(v){var matrix=this.exec("matrix");v.push({model:this.exec("model"),effect:{matrix:matrix,alpha:this.style.borderLineAlpha}});if(this.style.gridDirection===""){return}if(this.style.gridDirection==="horizontal"||this.style.gridDirection==="both"){for(var j=this.row;j>0;j--){var path=[{x:0,y:j*this.th},{x:this.width,y:j*this.th}];var model=m.LineModel.create({l:path,lineWidth:this.style.gridLineWidth,strokeStyle:this.style.gridLineColor,strokeAlpha:this.style.gridLineAlpha});v.push({model:model,effect:{matrix:matrix,alpha:this.style.gridLineAlpha}})}}if(this.style.gridDirection==="vertical"||this.style.gridDirection==="both"){for(var i=0;i<this.column;i++){var path=[{x:i*this.tw,y:0},{x:i*this.tw,y:this.height}];var model=m.LineModel.create({l:path,lineWidth:this.style.gridLineWidth,strokeStyle:this.style.gridLineColor,strokeAlpha:this.style.gridLineAlpha});v.push({model:model,effect:{matrix:matrix,alpha:this.style.gridLineAlpha}})}}return v}});exports.Grid=Nev.Grid}};__resources__["/nev.itemRender.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var h=require("helper");var d=require("director");var v=require("view");var m=require("model");var Level=require("level").Level;var painter=require("painter");var Actor=require("node").Actor;var interactor=require("interactor");Nev.ItemRender=Actor.extend([],{initialize:function(param){this.execProto("initialize",param);this.style=param.style;this.index=param.index;this.data=param.data;this.x=param.x;this.y=param.y;if(this.index<this.style.seriesBallColor.length){this.color=this.style.seriesBallColor[this.index]}else{this.color="#000000"}this.parent=param.render;this.name=param.name;this.c1m=m.CircleModel.create({radius:this.style.seriesBallRadius,fillStyle:this.color,strokeStyle:"#FFFFFF"});this.slot("type","Circle");this.exec("setModel",m.moveRelative(-.5,-.5,this.c1m))}});exports.ItemRender=Nev.ItemRender}};__resources__["/nev.label.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){Nev.Label=function(param){var label=document.createElement("div");label.innerHTML=param.text;if(param.color)label.style.color=param.color;if(param.fontSize)label.style.fontSize=param.fontSize+"px";label.style.textAlign="center";label.style.position="absolute";label.style.cursor="default";if(param.bg)label.style.backgroundColor=param.bg;return label};exports.Label=Nev.Label}};__resources__["/nev.line.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Chart=require("nev.lineBaseChart").LineBaseChart;Nev.Line=function(param){var defaults={listener:function(x,y,color,name){if(x==null&&y==null){return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+name+"</div>"}else if(name==null){return"<div style=border-style:solid;border-color:"+color+";background:"+color+";border-width:2px;border-radius:6px;>"+"date："+x+"<br/>"+"value："+y+"</div>"}else{return"<div style=border-style:solid;border-color:"+color+";background:"+color+";border-width:2px;border-radius:6px;>"+"date："+x+"<br/>"+"value："+y+"</br>"+"数据名称："+name+"</div>"}},style:{titleFontSize:30,titleFontColor:"#FF0000",titleBg:"",titleAlign:"center",seriesLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],seriesLineAlpha:[1,1,1,1,1],seriesLineWidth:[2,2,2,2,2],seriesBallRadius:5,seriesBallColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],axisFontSize:14,axisFontColor:"#000000",axisFontBg:"#0000FF",axisOffsetX:10,axisOffsetY:5,axisFormat:"",axisAutoFormat:true,borderLineColor:"#000000",borderLineAlpha:1,borderLineWidth:1,borderPadding:[50,50,50,50],gridborder:true,gridcolumn:"auto",gridrow:"auto",gridLineColor:"#000000",gridLineAlpha:.3,gridLineWidth:1,gridDirection:"both",warningLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],warningLineAlpha:[1,1,1,1,1],warningLineWidth:[2,2,2,2,2],legend:true,legendOffset:10}};var merge=function(defaults,userDefined){var obj={};for(var key in defaults){obj[key]=defaults[key]}for(var key in userDefined){if(key==="listener")obj[key]=userDefined[key];if(obj[key]){if(obj[key]){for(var tmp in userDefined[key]){obj[key][tmp]=userDefined[key][tmp]}}else{obj[key]=userDefined[key]}}else{obj[key]=userDefined[key]}}return obj};param=merge(defaults,param);param.area=false;var chart=Chart.create(param);return{updata:function(param){chart.exec("updata",param)}}};exports.Line=Nev.Line}};__resources__["/nev.linearAxis.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var NumericAxis=require("nev.numericAxis").NumericAxis;var Label=require("nev.label").Label;Nev.LinearAxis=NumericAxis.extend([],{initialize:function(param){this.execProto("initialize",param);this.style=param.style;this.direction=param.direction;this.plot=param.plot},setRectangle:function(){var options={text:this.bounds[0],fontSize:this.style.axisFontSize};return new Label(options)},position:function(render,bg){var row=bg.row,column=bg.column,left=this.style.borderPadding[0],top=this.style.borderPadding[1],bottom=bg.height,th=bg.th,tw=bg.tw,max=this.bounds[0],min=this.bounds[1],msn=max-min;if(this.direction=="vertical"){if(parseInt(max)!=max||parseInt(min)!=min){var interval=msn/row===Infinity?1:msn/row}else{var interval=Math.ceil(msn/row===Infinity?1:msn/row)}this.steps=th/interval}else{if(parseInt(max)!=max||parseInt(min)!=min){var interval=msn/column===Infinity?1:msn/column}else{var interval=Math.ceil(msn/column===Infinity?1:msn/column)}this.steps=tw/interval}this.gap=top+bottom;this.bgWidth=bg.width;if(this.direction=="vertical"){for(var i=0;i<row+1;i++){var num=i*interval+min;if(parseInt(num)!=num){num=Number(num.toFixed(3))}var options={text:num,fontSize:this.style.axisFontSize,color:this.style.axisFontColor};var label=new Label(options);render.appendChild(label);label.style.left=left-label.offsetWidth-this.style.axisOffsetX+"px";label.style.top=top+bottom-i*th-label.offsetHeight*.5+"px"}this.left=left-label.offsetWidth-this.style.axisOffsetX;this.offsetWidth=label.offsetWidth}else{for(var i=0;i<column+1;i++){var num=i*interval+min;if(parseInt(num)!=num){num=Number(num.toFixed(3))}var options={text:num,fontSize:this.style.axisFontSize,color:this.style.axisFontColor};var label=new Label(options);render.appendChild(label);label.style.left=i*tw+left-label.offsetWidth*.5+"px";label.style.top=this.gap+label.offsetHeight+this.style.axisOffsetY+"px"}}},point:function(value){var min=this.bounds[1];if(this.direction=="vertical"){value=this.gap-(value-min)*this.steps;if(parseInt(value)!=value)value=Number(value.toFixed(3))}else{if(this.plot){value=(value-min)*this.steps+this.style.borderPadding[0]}else{value=(value-min)*this.steps;if(value==0)value=2}}return value}});exports.LinearAxis=Nev.LinearAxis}};__resources__["/nev.lineBaseChart.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;var ChartBase=require("nev.chartBase").ChartBase;var LinearAxis=require("nev.linearAxis").LinearAxis;var DateTimeAxis=require("nev.dateTimeAxis").DateTimeAxis;var CategoryAxis=require("nev.categoryAxis").CategoryAxis;var interactor=require("interactor");var Grid=require("nev.grid").Grid;var Label=require("nev.label").Label;var Level=require("level").Level;var LineSeries=require("nev.lineSeries").LineSeries;var AreaSeries=require("nev.areaSeries").AreaSeries;var ItemRender=require("nev.itemRender").ItemRender;Nev.LineBaseChart=ChartBase.extend([],{initialize:function(param){var t=this;t.gRender=t.execProto("initialize",param.render);t.param=param;t.exec("doConfig")},updata:function(param){var t=this;if(t.exec("isArray",param)){var node=t.gRender.childNodes;var length=node.length-1;while(length>0){if(node[length].nodeType===1){if(node[length].nodeName!="CANVAS"){t.gRender.removeChild(node[length]);length=node.length-1}}}t.gLevel=Level.create();t.gScene=t.gLevel.exec("scene");t.gDirector.exec("setLevel",t.gLevel);t.param.data=param;t.exec("doConfig")}},doConfig:function(){var i,j,key,temp,arr=[],dataV=[],dataH=[],t=this;for(i=0;i<t.param.data.length;i++){temp=t.param.data[i];for(key in temp){if(t.exec("isArray",temp[key])){arr=temp[key];for(j=0;j<arr.length;j++){dataH.push(arr[j][0]);dataV.push(arr[j][1])}}}}var contentW=parseInt(t.width-(t.param.style.borderPadding[0]+t.param.style.borderPadding[2]));var contentH=parseInt(t.height-(t.param.style.borderPadding[1]+t.param.style.borderPadding[3]));var verticalAxis=LinearAxis.create({data:dataV,style:t.param.style,direction:"vertical"});var vLabel=verticalAxis.exec("setRectangle");t.gRender.appendChild(vLabel);if(t.exec("isNumber",dataH[0])){var horizontalAxis=DateTimeAxis.create({data:dataH,style:t.param.style,direction:"horizontal"})}else{if(dataH[dataH.length*.5]==dataH[0]){dataH=dataH.slice(dataH.length*.5,dataH.length)}var horizontalAxis=CategoryAxis.create({data:dataH,style:t.param.style,direction:"horizontal"})}var hLabel=horizontalAxis.exec("setRectangle");t.gRender.appendChild(hLabel);var th=hLabel.offsetHeight>=vLabel.offsetHeight?hLabel.offsetHeight*2:vLabel.offsetHeight*2;var tw=hLabel.offsetWidth>=vLabel.offsetWidth?hLabel.offsetWidth*2:vLabel.offsetWidth*2;t.gRender.removeChild(hLabel);t.gRender.removeChild(vLabel);if(contentW/tw>dataH.length){tw+=contentW/(dataH.length-1)-tw}else{tw=tw*.5;if(contentW/tw>dataH.length){tw+=contentW/(dataH.length-1)-tw}}var backgroundElement=Grid.create({tw:tw,th:th,width:contentW,height:contentH,style:t.param.style,director:t.gDirector});backgroundElement.exec("translate",t.param.style.borderPadding[0],t.param.style.borderPadding[1],-200);t.gScene.exec("addActor",backgroundElement);verticalAxis.exec("position",t.gRender,backgroundElement);horizontalAxis.exec("position",t.gRender,backgroundElement);if(t.param.title){var title=new Label({text:t.param.title});title.style.color=t.param.style.titleFontColor;title.style.fontSize=t.param.style.titleFontSize+"px";if(t.param.style.titleBg)title.style.backgroundColor=t.param.style.titleBg;title.style.width=backgroundElement.width+"px";title.style.textAlign=t.param.style.titleAlign;t.gRender.appendChild(title);title.style.left=t.param.style.borderPadding[0]+"px";title.style.top=t.param.style.borderPadding[1]-title.offsetHeight+"px"}var tips;onMouseOver=function(evt){tips=new Label({});evt.actor.parent.appendChild(tips);var oldRadius=evt.actor.c1m.slot("radius");evt.actor.c1m.slot("radius",oldRadius+2);tips.style.textAlign="";tips.innerHTML=t.param.listener(evt.actor.data[0],evt.actor.data[1],evt.actor.color,evt.actor.name);if(evt.actor.x+tips.clientWidth>backgroundElement.width+backgroundElement.style.borderPadding[0]){tips.style.left=evt.actor.x-tips.clientWidth+"px"}else{tips.style.left=evt.actor.x+"px"}if(evt.actor.y-tips.clientHeight<backgroundElement.style.borderPadding[1]){tips.style.top=evt.actor.y+"px"}else{tips.style.top=evt.actor.y-tips.clientHeight+"px"}t.exec("draw")};onMouseOut=function(evt){evt.actor.c1m.slot("radius",evt.actor.style.seriesBallRadius);evt.actor.parent.removeChild(tips);t.exec("draw")};if(t.param.style.legend){var legendView=document.createElement("div");legendView.style.position="absolute";legendView.style.cursor="default";legendView.style.left=backgroundElement.style.borderPadding[0]+"px";legendView.style.top=t.height-10+"px";t.gRender.appendChild(legendView)}for(var k=0;k<t.param.data.length;k++){var p=t.param.data[k];var tArr=[];if(t.param.style.legend){var il=document.createElement("div");var el=document.createElement("div");var tl=document.createElement("div");il.appendChild(el);il.appendChild(tl);legendView.appendChild(il);il.style.display=el.style.display=tl.style.display="inline-block";el.style.verticalAlign="middle";el.style.width="14px";el.style.height=(t.param.style.seriesLineWidth[k]==undefined?t.param.style.seriesLineWidth[0]:t.param.style.seriesLineWidth[k])+"px";el.style.background=t.param.style.seriesLineColor[k]==undefined?"#000000":t.param.style.seriesLineColor[k];tl.innerHTML=p.name;tl.style.fontWeight="bold";tl.style.fontSize="14px";tl.style.marginLeft="2px";tl.title=p.name;if(k!=0){il.style.marginLeft=t.param.style.legendOffset+"px"}}for(var n in p){var shapeActor;if(t.exec("isArray",p[n])){tArr=p[n];if(tArr.length>0){if(t.param.area){shapeActor=AreaSeries.create({style:t.param.style,startX:t.param.style.borderPadding[0],endY:t.param.style.borderPadding[1]+backgroundElement.height,director:t.gDirector,index:k})}else{shapeActor=LineSeries.create({style:t.param.style,director:t.gDirector,index:k})}shapeActor.exec("applyTranslate",0,0,-100);t.gScene.exec("addActor",shapeActor);for(var g=0;g<tArr.length;g++){if(t.exec("isNumber",tArr[g][0])&&t.exec("isNumber",tArr[g][1])){var xpos=horizontalAxis.exec("point",tArr[g][0]);var ypos=verticalAxis.exec("point",tArr[g][1]);ticks(xpos,ypos);var circle=ItemRender.create({style:t.param.style,director:t.gDirector,index:k,render:t.gRender,name:p.name,data:[horizontalAxis.exec("parseDate",tArr[g][0],false),tArr[g][1]],x:xpos,y:ypos});circle.exec("translate",xpos,ypos);circle.exec("addInteractor",interactor.MouseOverInteractor,onMouseOver);circle.exec("addInteractor",interactor.MouseOutInteractor,onMouseOut);t.gScene.exec("addActor",circle);shapeActor.exec("setPath",xpos,ypos)}else{var xpos=horizontalAxis.exec("point",g);var ypos=verticalAxis.exec("point",tArr[g][1]);ticks(xpos,ypos);var circle=ItemRender.create({style:t.param.style,director:t.gDirector,index:k,render:t.gRender,name:p.name,data:[tArr[g][0],tArr[g][1]],x:xpos,y:ypos});circle.exec("translate",xpos,ypos);circle.exec("addInteractor",interactor.MouseOverInteractor,onMouseOver);circle.exec("addInteractor",interactor.MouseOutInteractor,onMouseOut);t.gScene.exec("addActor",circle);shapeActor.exec("setPath",xpos,ypos)}}shapeActor.exec("render")}}}}function ticks(x,y){var model=m.LineModel.create({l:[{x:x,y:backgroundElement.height+t.param.style.borderPadding[1]},{x:x,y:backgroundElement.height+5+t.param.style.borderPadding[1]}],lineWidth:t.param.style.gridLineWidth,strokeStyle:t.param.style.gridLineColor,strokeAlpha:t.param.style.gridLineAlpha});var actor=Actor.create({model:model,director:t.gDirector});actor.exec("applyTranslate",0,0,-20);t.gScene.exec("addActor",actor)}if(t.param.warning&&t.exec("isArray",t.param.warning)){for(var e=0;e<t.param.warning.length;e++){if(t.param.warning[e]<verticalAxis.bounds[1]&&t.param.warning[e]>verticalAxis.bounds[0]){return}var ypos=verticalAxis.exec("point",t.param.warning[e]);if(ypos<backgroundElement.style.borderPadding[1]+backgroundElement.height&&ypos>backgroundElement.style.borderPadding[1]){var path=[{x:backgroundElement.style.borderPadding[0],y:ypos},{x:backgroundElement.width+backgroundElement.style.borderPadding[2],y:ypos}];var model=m.LineModel.create({l:path,lineWidth:t.param.style.warningLineWidth[e],strokeStyle:t.param.style.warningLineColor[e]});var actor=Actor.create({model:model,director:t.gDirector,alpha:t.param.style.warningLineAlpha[e]});t.gScene.exec("addActor",actor)}}}this.exec("draw")}});exports.LineBaseChart=Nev.LineBaseChart}};__resources__["/nev.lineSeries.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;Nev.LineSeries=Actor.extend([],{initialize:function(param){var t=this;t.execProto("initialize",param);t.style=param.style;t.index=param.index;t.slot("_alpha",t.style.seriesLineAlpha[t.index]);t.path=[]},setPath:function(xpos,ypos){this.path.push({x:xpos,y:ypos})},render:function(){var t=this;t.exec("setModel",m.LineModel.create({l:t.path,lineWidth:t.style.seriesLineWidth[t.index],strokeStyle:t.style.seriesLineColor[t.index]}))}});exports.LineSeries=Nev.LineSeries}};__resources__["/nev.numericAxis.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Klass=require("base").Klass;Nev.NumericAxis=Klass.extend([],{initialize:function(param){this.data=param.data;this.bounds=this.exec("getValueBounds")},getValueBounds:function(){var maxValue=Number.MIN_VALUE;var minValue=Number.MAX_VALUE;for(var i=0;i<this.data.length;i++){if(this.data[i]>maxValue){maxValue=this.data[i]}if(this.data[i]<minValue){minValue=this.data[i]}}if(parseInt(maxValue)!=maxValue)maxValue=Number(maxValue.toFixed(3));if(parseInt(minValue)!=minValue)minValue=Number(minValue.toFixed(3));if(maxValue==0&&maxValue==minValue){maxValue=10;minValue=0}return[maxValue,minValue]}});exports.NumericAxis=Nev.NumericAxis}};__resources__["/nev.pie.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Chart=require("nev.pieBaseChart").PieBaseChart;Nev.Pie=function(param){var defaults={listener:function(x,y,color,name){if(x==null&&y==null){return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+name+"</div>"}else{return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+x+"<br/>"+y+"</br>"+name+"</div>"}},style:{titleFontSize:30,titleFontColor:"#FF0000",titleBg:"",titleAlign:"center",seriesLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],seriesLineAlpha:[1,1,1,1,1],seriesLineWidth:[2,2,2,2,2],seriesBallRadius:5,seriesBallColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],axisFontSize:12,axisFontColor:"#000000",axisFontBg:"#0000FF",axisOffsetX:5,axisOffsetY:5,axisFormat:"",radius:140,Offset:20,axisAutoFormat:true,borderLineColor:"#000000",borderLineAlpha:1,borderLineWidth:1,borderPadding:[50,50,50,50],gridborder:true,gridcolumn:"auto",gridrow:"auto",gridLineColor:"#000000",gridLineAlpha:.3,gridLineWidth:1,gridDirection:"vertical",warningLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],warningLineAlpha:[1,1,1,1,1],warningLineWidth:[2,2,2,2,2],legend:true,legendOffset:10}};var merge=function(defaults,userDefined){var obj={};for(var key in defaults){obj[key]=defaults[key]}for(var key in userDefined){if(key==="listener")obj[key]=userDefined[key];if(obj[key]){if(obj[key]){for(var tmp in userDefined[key]){obj[key][tmp]=userDefined[key][tmp]}}else{obj[key]=userDefined[key]}}else{obj[key]=userDefined[key]}}return obj};param=merge(defaults,param);var chart=Chart.create(param);return{updata:function(param){chart.exec("updata",param)}}};exports.Pie=Nev.Pie}};__resources__["/nev.pieBaseChart.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;var ChartBase=require("nev.chartBase").ChartBase;var interactor=require("interactor");var Label=require("nev.label").Label;var Level=require("level").Level;var PieSeries=require("nev.pieSeries").PieSeries;Nev.PieBaseChart=ChartBase.extend([],{initialize:function(param){var t=this;t.gRender=t.execProto("initialize",param.render);t.param=param;t.exec("doConfig")},updata:function(param){var t=this;if(t.exec("isArray",param)){var node=t.gRender.childNodes;var length=node.length-1;while(length>0){if(node[length].nodeType===1){if(node[length].nodeName!="CANVAS"){t.gRender.removeChild(node[length]);length=node.length-1}}}t.gLevel=Level.create();t.gScene=t.gLevel.exec("scene");t.gDirector.exec("setLevel",t.gLevel);t.param.data=param;t.exec("doConfig")}},doConfig:function(){var i,j,key,temp,start=0,t=this,total=0,contentW=t.width-t.param.style.borderPadding[0];contentH=t.height-t.param.style.borderPadding[1];for(i=0;i<t.param.data.length;i++){temp=t.param.data[i];for(key in temp){if(t.exec("isNumber",temp[key])){total+=temp[key]}}}var onMouseOver=function(evt){console.log(evt.actor)};var onMouseOut=function(evt){console.log(evt.actor)};if(t.param.title){var title=new Label({text:t.param.title});title.style.color=t.param.style.titleFontColor;title.style.fontSize=t.param.style.titleFontSize+"px";if(t.param.style.titleBg)title.style.backgroundColor=t.param.style.titleBg;title.style.width=t.width+"px";title.style.textAlign=t.param.style.titleAlign;t.gRender.appendChild(title);title.style.top=t.param.style.borderPadding[1]-title.offsetHeight+"px"}for(j=0;j<t.param.data.length;j++){temp=t.param.data[j];for(key in temp){if(t.exec("isNumber",temp[key])){var end=start+Math.PI*2*(temp[key]/total);var actor=PieSeries.create({style:t.param.style,startAngle:start,endAngle:end,director:t.gDirector,index:j});actor.exec("translate",t.width*.5,t.param.style.borderPadding[1]+t.param.style.radius);t.gScene.exec("addActor",actor);console.log(start);console.log(end);start+=Math.PI*2*(temp[key]/total);actor.exec("addInteractor",interactor.MouseOverInteractor,onMouseOver);actor.exec("addInteractor",interactor.MouseOutInteractor,onMouseOut)}}}t.exec("draw")}});exports.PieBaseChart=Nev.PieBaseChart}};__resources__["/nev.pieModel.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model"),PieModel=m.ArcModel.extend(undefined,{initialize:function(param){this.execProto("initialize",param);this.slot("type","pie")}}),setLineStyle=function(ctx,m){if(m.slot("lineWidth")!=undefined)ctx.lineWidth=m.slot("lineWidth");if(m.slot("lineCap")!=undefined)ctx.lineCap=m.slot("lineCap");if(m.slot("lineJoin")!=undefined)ctx.lineJoin=m.slot("lineJoin");if(m.slot("miterLimit")!=undefined)ctx.miterLimit=m.slot("miterLimit");if(m.slot("lineDash")!=undefined)ctx.setLineDash(m.slot("lineDash"));if(m.slot("lineDashOffset")!=undefined)ctx.lineDashOffset=m.slot("lineDashOffset");if(m.slot("strokeStyle")!=undefined)ctx.strokeStyle=m.slot("strokeStyle")},drawPieModel=function(m,painter){var ctx=painter.exec("getContext","2d");ctx.save();setLineStyle(ctx,m);ctx.beginPath();ctx.fillStyle=m.slot("fill");ctx.strokeStyle=m.slot("fill");ctx.moveTo(0,0);ctx.arc(0,0,m.slot("radius"),m.slot("startAngle"),m.slot("endAngle"),m.slot("anticlockwise"));ctx.stroke();ctx.fill();ctx.restore()},pieHittest=function(m,x,y,painter){var startAngle=m.slot("startAngle");var endAngle=m.slot("endAngle");var radius=m.slot("radius");var lineWidth=m.slot("lineWidth");if(undefined==lineWidth)lineWidth=painter.exec("getContext","2d").lineWidth;var r=Math.sqrt(x*x,y*y);var isInTorus=radius-lineWidth/2<=r&&r<=radius+lineWidth/2;if(!isInTorus)return false;if(2*Math.PI<=endAngle-startAngle||endAngle-startAngle<=-2*Math.PI){return true}var startX=radius*Math.cos(startAngle);var startY=radius*Math.sin(startAngle);var angle=geo.getVectorAngle({x:startX,y:startY},{x:x,y:y})+startAngle;if(endAngle<startAngle)endAngle+=Math.PI*2;return angle>=startAngle&&angle<=endAngle};require("painter").HonestPainter.register("pie",{draw:drawPieModel,inside:pieHittest});exports.PieModel=PieModel}};__resources__["/nev.pieSeries.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var PieModel=require("nev.pieModel").PieModel;var Actor=require("node").Actor;Nev.PieSeries=Actor.extend([],{initialize:function(param){var t=this;t.execProto("initialize",param);t.style=param.style;t.index=param.index;t.slot("_alpha",t.style.seriesLineAlpha[t.index]);t.exec("setModel",PieModel.create({radius:t.style.radius,startAngle:param.startAngle,endAngle:param.endAngle,fill:t.style.seriesLineColor[t.index]}))}});exports.PieSeries=Nev.PieSeries}};__resources__["/nev.plot.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Chart=require("nev.plotBaseChart").PlotBaseChart;Nev.Plot=function(param){var defaults={listener:function(x,y,color,name){if(x==null&&y==null){return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+name+"</div>"}else{return"<div style=border-style:solid;border-color:"+color+";border-width:2px;border-radius:6px;>"+x+"<br/>"+y+"</br>"+name+"</div>"}},style:{radius:5,titleFontSize:30,titleFontColor:"#FF0000",titleBg:"",titleAlign:"center",seriesLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],seriesLineAlpha:[.4,.4,.4,.4,.4],seriesLineWidth:[2,2,2,2,2],seriesBallRadius:5,seriesBallColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],axisFontSize:12,axisFontColor:"#000000",axisFontBg:"#0000FF",axisOffsetX:5,axisOffsetY:5,axisFormat:"",axisAutoFormat:true,borderLineColor:"#000000",borderLineAlpha:1,borderLineWidth:1,borderPadding:[50,50,50,50],gridborder:true,gridcolumn:"auto",gridrow:"auto",gridLineColor:"#000000",gridLineAlpha:.3,gridLineWidth:1,gridDirection:"both",warningLineColor:["#2b59c3","#d6300f","#ff8b00","#0d8814","#8b008b"],warningLineAlpha:[1,1,1,1,1],warningLineWidth:[2,2,2,2,2],legend:true,legendOffset:10}};var merge=function(defaults,userDefined){var obj={};for(var key in defaults){obj[key]=defaults[key]}for(var key in userDefined){if(key==="listener")obj[key]=userDefined[key];if(obj[key]){if(obj[key]){for(var tmp in userDefined[key]){obj[key][tmp]=userDefined[key][tmp]}}else{obj[key]=userDefined[key]}}else{obj[key]=userDefined[key]}}return obj};param=merge(defaults,param);param.area=true;var chart=Chart.create(param);return{updata:function(param){chart.exec("updata",param)}}};exports.Plot=Nev.Plot}};__resources__["/nev.plotBaseChart.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;var ChartBase=require("nev.chartBase").ChartBase;var LinearAxis=require("nev.linearAxis").LinearAxis;var DateTimeAxis=require("nev.dateTimeAxis").DateTimeAxis;var interactor=require("interactor");var Grid=require("nev.grid").Grid;var Label=require("nev.label").Label;var Level=require("level").Level;var PlotSeries=require("nev.plotSeries").PlotSeries;var ItemRender=require("nev.itemRender").ItemRender;Nev.PlotBaseChart=ChartBase.extend([],{initialize:function(param){var t=this;t.gRender=t.execProto("initialize",param.render);t.param=param;t.exec("doConfig")},updata:function(param){var t=this;if(t.exec("isArray",param)){var node=t.gRender.childNodes;var length=node.length-1;while(length>0){if(node[length].nodeType===1){if(node[length].nodeName!="CANVAS"){t.gRender.removeChild(node[length]);length=node.length-1}}}t.gLevel=Level.create();t.gScene=t.gLevel.exec("scene");t.gDirector.exec("setLevel",t.gLevel);t.param.data=param;t.exec("doConfig")}},doConfig:function(){var i,j,key,temp,arr=[],dataV=[],dataH=[],t=this;for(i=0;i<t.param.data.length;i++){temp=t.param.data[i];for(key in temp){if(t.exec("isArray",temp[key])){arr=temp[key];for(j=0;j<arr.length;j++){if(t.exec("isNumber",arr[j][0])){dataH.push(arr[j][0])}if(t.exec("isNumber",arr[j][1])){dataV.push(arr[j][1])}}}}}var contentW=t.width-(t.param.style.borderPadding[0]+t.param.style.borderPadding[2]);var contentH=t.height-(t.param.style.borderPadding[1]+t.param.style.borderPadding[3]);var verticalAxis=LinearAxis.create({data:dataV,style:t.param.style,direction:"vertical"});var vLabel=verticalAxis.exec("setRectangle");t.gRender.appendChild(vLabel);var horizontalAxis=LinearAxis.create({data:dataH,style:t.param.style,direction:"horizontal",plot:true});var hLabel=horizontalAxis.exec("setRectangle");t.gRender.appendChild(hLabel);var th=hLabel.offsetHeight>=vLabel.offsetHeight?hLabel.offsetHeight*2:vLabel.offsetHeight*2;var tw=hLabel.offsetWidth>=vLabel.offsetWidth?hLabel.offsetWidth*2:vLabel.offsetWidth*2;t.gRender.removeChild(hLabel);t.gRender.removeChild(vLabel);var backgroundElement=Grid.create({tw:tw,th:th,width:contentW,height:contentH,style:t.param.style,director:t.gDirector});backgroundElement.exec("translate",t.param.style.borderPadding[0],t.param.style.borderPadding[1],-200);t.gScene.exec("addActor",backgroundElement);verticalAxis.exec("position",t.gRender,backgroundElement);horizontalAxis.exec("position",t.gRender,backgroundElement);if(t.param.title){var title=new Label({text:t.param.title});title.style.color=t.param.style.titleFontColor;title.style.fontSize=t.param.style.titleFontSize+"px";if(t.param.style.titleBg)title.style.backgroundColor=t.param.style.titleBg;title.style.width=backgroundElement.width+"px";title.style.textAlign=t.param.style.titleAlign;t.gRender.appendChild(title);title.style.left=t.param.style.borderPadding[0]+"px";title.style.top=t.param.style.borderPadding[1]-title.offsetHeight+"px"}var tips;onMouseOver=function(evt){tips=new Label({});evt.actor.parent.appendChild(tips);tips.style.textAlign="";tips.innerHTML=t.param.listener(evt.actor.data[0],evt.actor.data[1],evt.actor.color,evt.actor.name);if(evt.actor.x+tips.clientWidth>backgroundElement.width+backgroundElement.style.borderPadding[0]){tips.style.left=evt.actor.x-tips.clientWidth+"px"}else{tips.style.left=evt.actor.x+"px"}if(evt.actor.y-tips.clientHeight<backgroundElement.style.borderPadding[1]){tips.style.top=evt.actor.y+"px"}else{tips.style.top=evt.actor.y-tips.clientHeight+"px"}};onMouseOut=function(evt){evt.actor.parent.removeChild(tips)};if(t.param.style.legend){var legendView=document.createElement("div");legendView.style.position="absolute";legendView.style.cursor="default";legendView.style.left=backgroundElement.style.borderPadding[0]+"px";legendView.style.top=t.height-10+"px";t.gRender.appendChild(legendView)}for(var k=0;k<t.param.data.length;k++){var p=t.param.data[k];var tArr=[];if(t.param.style.legend){var il=document.createElement("div");var el=document.createElement("div");var tl=document.createElement("div");il.appendChild(el);il.appendChild(tl);legendView.appendChild(il);il.style.display=el.style.display=tl.style.display="inline-block";el.style.verticalAlign="middle";el.style.width="10px";el.style.height=(t.param.style.seriesLineWidth[k]==undefined?t.param.style.seriesLineWidth[0]:t.param.style.seriesLineWidth[k])+"px";el.style.background=t.param.style.seriesLineColor[k]==undefined?"#000000":t.param.style.seriesLineColor[k];tl.innerHTML=p.name;tl.style.fontWeight="bold";tl.style.fontSize="12px";tl.style.marginLeft="2px";tl.title=p.name;if(k!=0){il.style.marginLeft=t.param.style.legendOffset+"px"}}for(var n in p){if(t.exec("isArray",p[n])){tArr=p[n];if(tArr.length>0){for(var g=0;g<tArr.length;g++){var shapeActor=PlotSeries.create({parent:t.gRender,style:t.param.style,director:t.gDirector,index:k,name:p.name});t.gScene.exec("addActor",shapeActor);if(t.exec("isNumber",tArr[g][0])&&t.exec("isNumber",tArr[g][1])){var xpos=horizontalAxis.exec("point",tArr[g][0]);var ypos=verticalAxis.exec("point",tArr[g][1]);var position={x:xpos-t.param.style.radius,y:ypos-t.param.style.radius};shapeActor.exec("set",position,[tArr[g][0],tArr[g][1]]);shapeActor.exec("applyTranslate",xpos-t.param.style.radius,ypos-t.param.style.radius);shapeActor.exec("addInteractor",interactor.MouseOverInteractor,onMouseOver);shapeActor.exec("addInteractor",interactor.MouseOutInteractor,onMouseOut)}}}}}}t.exec("draw")}});exports.PlotBaseChart=Nev.PlotBaseChart}};__resources__["/nev.plotSeries.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var m=require("model");var Actor=require("node").Actor;Nev.PlotSeries=Actor.extend([],{initialize:function(param){var t=this;t.execProto("initialize",param);t.style=param.style;t.index=param.index;t.parent=param.parent;t.name=param.name;t.color=t.style.seriesLineColor[t.index];t.slot("_alpha",t.style.seriesLineAlpha[t.index]);t.exec("setModel",m.CircleModel.create({radius:t.style.radius,fillStyle:t.style.seriesLineColor[t.index]}))},set:function(position,value){var t=this;t.x=position.x;t.y=position.y;t.data=value}});exports.PlotSeries=Nev.PlotSeries}};__resources__["/radiatespreadchart.js"]={meta:{mimetype:"application/javascript"},data:function(exports,require,module,__filename,__dirname){var Klass=require("base").Klass,Trait=require("oo").Trait,Actor=require("node").Actor,model=require("model"),director=require("director"),view=require("view"),painter=require("painter"),Level=require("level").Level,debug=require("debug"),interactor=require("interactor"),geometry=require("geometry"),util=require("util"),helper=require("helper");var SubContainer=function(param){var subContainer=document.createElement("div");subContainer.innerHTML=param.text;if(param.color)subContainer.style.color=param.color;if(param.fontSize)subContainer.style.fontSize=param.fontSize+"px";if(param.fontFamily)subContainer.style.fontFamily=param.fontFamily;subContainer.style.textAlign="left";subContainer.style.position="absolute";subContainer.style.cursor="default";if(param.bg)subContainer.style.backgroundColor=param.bg;return subContainer};function RGB2HSI(rgb){var r=rgb.r;var g=rgb.g;var b=rgb.b;var sum=r+g+b;if(sum===0)return{h:0,s:0,i:0};var hsi={};var fr=r/sum;var fg=g/sum;var fb=b/sum;var mole=.5*(fr-fg+(fr-fb));var deno=Math.sqrt((fr-fg)*(fr-fg)+(fr-fb)*(fg-fb));if(fb<=fg)hsi.H=Math.acos(mole/deno);else{var d=Math.acos(1);d=Math.acos(mole/deno);hsi.H=2*Math.PI-d}hsi.S=1-3*Math.min(Math.min(fr,fg),fb);hsi.I=sum/(3*255);return hsi}function HSI2RGB(hsi){var x=hsi.I*(1-hsi.S);var y,z,fr,fg,fb;var rgb={};if(hsi.H<2/3*Math.PI){var h=hsi.H;y=hsi.I*(1+hsi.S*Math.cos(h)/Math.cos(Math.PI/3-h));z=3*hsi.I-(x+y);fb=x;fr=y;fg=z}else if(hsi.H>=2/3*Math.PI&&hsi.H<4/3*Math.PI){var h=hsi.H-2/3*Math.PI;y=hsi.I*(1+hsi.S*Math.cos(h)/Math.cos(Math.PI/3-h));z=3*hsi.I-(x+y);fr=x;fg=y;fb=z}else if(hsi.H>=4/3*Math.PI&&hsi.H<2*Math.PI){var h=hsi.H-4/3*Math.PI;y=hsi.I*(1+hsi.S*Math.cos(h)/Math.cos(Math.PI/3-h));z=3*hsi.I-(x+y);fg=x;fb=y;fr=z}rgb.r=Math.floor(fr*255+.5);rgb.g=Math.floor(fg*255+.5);rgb.b=Math.floor(fb*255+.5);return rgb}var SpreadActor=Actor.extend([],{initialize:function(param){this.execProto("initialize",param);var data=param.data;this.slot("director",param.director);this.slot("lineStrokeStyle",param.lineStrokeStyle);this.slot("lineWidth",param.lineWidth);var relModel;if(data.isKey){var self=this;var img=helper.loadImage(data.avatarLink,null,function(){self.slot("director").exec("invalidate")});relModel=model.ImageModel.create({image:img,width:param.R*param.keyImageSize,height:param.R*param.keyImageSize})}else{relModel=model.CircleModel.create({radius:param.R,fillStyle:param.fillColor})}this.slot("fill",param.fillColor);this.slot("relModel",relModel);this.slot("spreadModel",model.moveRelative(-.5,-.5,relModel));this.slot("layerIndex",param.layerIndex);this.slot("index",param.index);this.slot("areaRadian",param.areaRadian);this.slot("startRadian",param.startRadian);this.slot("userName",data.username?data.username:" ");this.slot("beForwarded",data.beForwarded?data.beForwarded:" ");this.slot("fans",data.fans?data.fans:" ");this.slot("data",data.data?data.data:" ");this.slot("href",data.href?data.href:" ")},setOwnerNode:function(node){this.slot("ownerNode",node)},emmitModels:function(v){debug.assert(this.slot("ownerNode"),"bad SpreadActor ownernode");var matrix=this.exec("matrix");v.push({model:this.slot("spreadModel"),effect:{matrix:matrix,alpha:this.slot("_alpha")}});var ownerNode=this.slot("ownerNode");var children=ownerNode.exec("children");if(children==null)return v;var self=this;children.forEach(function(child){var childPos=child.exec("actor").exec("getTransformSteps")[0];var lineM=model.LineModel.create({l:[{x:0,y:0},{x:childPos[1],y:childPos[2]}],strokeStyle:self.slot("lineStrokeStyle"),lineWidth:self.slot("lineWidth")});var lineMat=util.copy(matrix);var lineMat=geometry.matrixTranslateBy(lineMat,0,0,-.1);v.push({model:lineM,effect:{matrix:lineMat}})});return v},emmitControlModels:function(v){v.push({model:this.slot("spreadModel"),effect:{matrix:this.exec("matrix")}});return v},getActorViewPos:function(){var spreadchart=this.slot("radiateSpreadChart");var director=spreadchart.exec("getDirector");var mat=this.exec("matrix");var view=director.exec("defaultView");var viewMat=view.exec("matrix");var localToViewMat=geometry.matrixMultBy(geometry.matrixInvert(viewMat),mat);return viewPos=geometry.pointApplyMatrix({x:0,y:0},localToViewMat)},moveTipWithActor:function(){var mouseOverTip=this.slot("mouseOverTip");var mouseClickedTip=this.slot("mouseClickedTip");var spreadchart=this.slot("radiateSpreadChart");var viewActorPos=this.exec("getActorViewPos");var hide=false;if(viewActorPos.x<0||viewActorPos.x>spreadchart.slot("canvasW")||viewActorPos.y<0||viewActorPos.y>spreadchart.slot("canvasH")){hide=true}if(mouseOverTip){mouseOverTip.style.left=viewActorPos.x+"px";mouseOverTip.style.top=viewActorPos.y-mouseOverTip.offsetHeight-5+"px";if(hide)mouseOverTip.style.visibility="hidden";else mouseOverTip.style.visibility="visible"}if(mouseClickedTip){mouseClickedTip.style.left=viewActorPos.x+"px";mouseClickedTip.style.top=viewActorPos.y-mouseClickedTip.offsetHeight-5+"px";if(hide)mouseClickedTip.style.visibility="hidden";else mouseClickedTip.style.visibility="visible"}},onMouseOver:function(){if(this.slot("mouseOverTip"))return;var spreadChart=this.slot("radiateSpreadChart");var chartContainer=spreadChart.slot("chartContainer");var tip=new SubContainer({});chartContainer.appendChild(tip);tip.style.textAlign="left";tip.innerHTML='<text style="font-family:&quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Verdana, Arial, Helvetica, sans-serif;font-size:12px;color:#333333;fill:#333333;" zIndex="1"> <tspan>用户名</tspan>  <tspan>: </tspan><tspan style="font-weight:bold">'+this.slot("userName")+'</tspan><br/><tspan>被转发次数</tspan><tspan>: </tspan><tspan style="font-weight:bold">'+this.slot("beForwarded")+"</tspan></text>";tip.style.borderStyle="solid";tip.style.borderColor=spreadChart.slot("mouseOverTipBorderColor");tip.style.borderWidth="2px";tip.style.borderRadius="4px";tip.style.backgroundColor=spreadChart.slot("mouseOverTipBackgroundColor");tip.style.opacity=.85;var viewActorPos=this.exec("getActorViewPos");tip.style.left=viewActorPos.x+"px";tip.style.top=viewActorPos.y-tip.offsetHeight-5+"px";this.slot("mouseOverTip",tip);spreadChart.exec("addMouseOverTipActor",this);var relModel=this.slot("relModel");or=spreadChart.slot("circleR");if(relModel.slot("type")==="circle"){relModel.exec("set","radius",or+2)}else{var ow=relModel.slot("width");var oh=relModel.slot("width");relModel.slot("width",ow+or);relModel.slot("height",oh+or)}var self=this;setTimeout(function(){self.slot("mouseOverTip",undefined);tip.parentNode.removeChild(tip);spreadChart.exec("removeMouseOverTipActor",self);if(relModel.slot("type")==="circle")relModel.exec("set","radius",or);else{relModel.slot("width",ow);relModel.slot("height",oh)}spreadChart.exec("getDirector").exec("invalidate")},1500);spreadChart.exec("getDirector").exec("invalidate")},onMouseClicked:function(){if(this.slot("mouseClickedTip"))return;var spreadChart=this.slot("radiateSpreadChart");var chartContainer=spreadChart.slot("chartContainer");var tip=new SubContainer({});chartContainer.appendChild(tip);tip.style.textAlign="left";tip.innerHTML='<div style="font-family:&quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Verdana, Arial, Helvetica, sans-serif;font-size:12px;color:#333333;fill:#333333; " ><div><tspan style="font-weight:bold">用户名</tspan><tspan>: </tspan><tspan>'+this.slot("userName")+'</tspan><a href="'+this.slot("href")+'" target="_blank" style="margin-left:5px">进入微博账户</a>'+'<img style="font-size:10px; position:absolute; top:0;right:0" src="./images/x.png"/></div><div><tspan style="font-weight:bold">粉丝数</tspan><tspan>: </tspan><tspan>'+this.slot("fans")+'</tspan><tspan style="margin-left:5px">被转发次数</tspan><tspan>: </tspan><tspan>'+this.slot("beForwarded")+'</tspan><tspan style="margin-left:5px; font-weight:bold">所在转发层级</tspan><tspan>: </tspan><tspan>'+this.slot("layerIndex")+'</tspan></div><div style=""><tspan style="font-weight:bold">转发内容</tspan><tspan>: </tspan><tspan>'+this.slot("data")+"</div></div>";tip.style.borderStyle="solid";tip.style.borderColor=spreadChart.slot("mouseClickedTipBorderColor");tip.style.borderWidth="2px";tip.style.borderRadius="4px";tip.style.backgroundColor=spreadChart.slot("mouseClickedTipBackgroundColor");tip.style.opacity=.85;var viewActorPos=this.exec("getActorViewPos");tip.style.left=viewActorPos.x+"px";tip.style.top=viewActorPos.y-tip.offsetHeight-5+"px";this.slot("mouseClickedTip",tip);var self=this;var closeImg=tip.getElementsByTagName("img")[0];closeImg.onclick=function(){self.slot("mouseClickedTip",undefined);tip.parentNode.removeChild(tip);spreadChart.exec("removeMouseClickedTipActor",self)};spreadChart.exec("addMouseClickedTipActor",this)},onMouseDrag:function(evt){var parentNode=this.slot("ownerNode").exec("parent");var parentMatrix=parentNode.exec("actor").exec("matrix");var parentWorldToLocalMatrix=geometry.matrixInvert(parentMatrix);var eLocal=geometry.pointApplyMatrix({x:evt.gameX,y:evt.gameY},parentWorldToLocalMatrix);if(evt.dragStart){this.exec("applyTranslate",0,0,3);var actorMat=this.exec("matrix");var actorLocalPos=geometry.pointApplyMatrix({x:actorMat.tx,y:actorMat.ty},parentWorldToLocalMatrix);this.slot("lastPos",{x:actorLocalPos.x,y:actorLocalPos.y})}this.exec("applyTranslate",eLocal.x-this.slot("lastPos").x,eLocal.y-this.slot("lastPos").y);var newangle=Math.atan2(eLocal.y,eLocal.x);var organgle=Math.atan2(this.slot("lastPos").y,this.slot("lastPos").x);this.exec("applyRotate",newangle-organgle);this.slot("lastPos",{x:eLocal.x,y:eLocal.y})}});function addBackgroundNode(rsLevel){var bgModel=model.ConvexModel.create({vertexes:[{x:0,y:0},{x:rsLevel.slot("canvasW"),y:0},{x:rsLevel.slot("canvasW"),y:rsLevel.slot("canvasH")},{x:0,y:rsLevel.slot("canvasH")}]});var actor=Actor.create({model:bgModel,director:rsLevel.exec("getDirector")});actor.exec("translate",0,0,-1e3);actor.slot("radiateSpreadChart",rsLevel);actor.exec("addInteractor",interactor.MouseDraggedInteractor,{onNext:function(evt){rsLevel.exec("backgroundNodeBeDragged",evt)}});var node=rsLevel.slot("_scene").exec("createNode",{actor:actor});rsLevel.slot("_scene").exec("addNode",node);return node}function addInteractorCapureNode(rsLevel){var captureModel=model.ConvexModel.create({vertexes:[{x:0,y:0},{x:rsLevel.slot("canvasW"),y:0},{x:rsLevel.slot("canvasW"),y:rsLevel.slot("canvasH")},{x:0,y:rsLevel.slot("canvasH")}],fillStyle:"rgba(10, 10, 10, 0.7)"});var captureActor=Actor.create({model:captureModel,director:rsLevel.exec("getDirector")});captureActor.exec("applyTranslate",0,0,2);captureActor.slot("radiateSpreadChart",rsLevel);captureActor.exec("addInteractor",interactor.MouseDraggedInteractor,{onNext:function(evt){rsLevel.exec("backgroundNodeBeDragged",evt)}});captureActor.exec("addInteractor",interactor.MouseOverInteractor,{onNext:function(){}});captureActor.exec("addInteractor",interactor.MouseClickedInteractor,{onNext:function(){}});var captureNode=rsLevel.slot("_scene").exec("createNode",{actor:captureActor});rsLevel.slot("_scene").exec("addNode",captureNode);return captureNode}function addResumeButton(spreadChart,resumeNode){var buttonContainer=spreadChart.slot("buttonContainer");var resumeBtn=document.createElement("button");resumeBtn.style.fontSize="16px";resumeBtn.innerText="恢复布局";buttonContainer.appendChild(resumeBtn);resumeBtn.onclick=function(){spreadChart.exec("undoSpreadActorDrag",resumeNode)};return resumeBtn}function addZoonButton(spreadChart,resumeNode){var tip=new SubContainer({});var chartContainer=spreadChart.slot("chartContainer");chartContainer.appendChild(tip);tip.style.textAlign="";tip.style.left="30px";tip.style.top="50px";tip.innerHTML='<button style="font-size:16px">放大+</button><button style="font-size:16px">缩小-</button>';var zoonInBtn=tip.getElementsByTagName("button")[0];function zoon(deltaScale){var spreadRootActor=spreadChart.slot("spreadRootNode").exec("actor");var lastScale=spreadRootActor.slot("scale");desScale=lastScale+deltaScale;if(desScale<.2||desScale>2.8)return;spreadRootActor.exec("scale",desScale,desScale);spreadRootActor.slot("scale",desScale);spreadChart.exec("moveTipsWithActor");spreadChart.exec("getDirector").exec("invalidate")}zoonInBtn.onclick=function(deltaScale){zoon(.2)};var zoonOutBtn=tip.getElementsByTagName("button")[1];zoonOutBtn.onclick=function(){zoon(-.2)};return tip}var RadiateSpreadChartLevel=Level.extend([],{initialize:function(param){this.execProto("initialize",param);this.exec("initGlobalParam",param)},initGlobalParam:function(param){this.slot("baseR",param.baseR?param.baseR:80);this.slot("circleR",param.circleR?param.circleR:4);this.slot("keyImageSize",param.keyImageSize?param.keyImageSize:6);this.slot("circleFillLightColor",param.circleFillLightColor?param.circleFillLightColor:{r:155,g:255,b:182});this.slot("circleFillLightHSI",RGB2HSI(this.slot("circleFillLightColor")));this.slot("thresholdI",.4);this.slot("lineStrokeStyle",param.lineStrokeStyle?param.lineStrokeStyle:"rgb(158, 158, 158)");this.slot("lineWidth",param.lineWidth?param.lineWidth:1);this.slot("mouseOverTipBackgroundColor",param.mouseOverTipBackgroundColor?param.mouseOverTipBackgroundColor:"rgba(255, 255, 185, 1)");this.slot("mouseOverTipBorderColor",param.mouseOverTipBorderColor?param.mouseOverTipBorderColor:"rgb(255, 219, 111)");this.slot("mouseClickedTipBackgroundColor",param.mouseClickedTipBackgroundColor?param.mouseClickedTipBackgroundColor:"rgba(255, 255, 185, 1)");this.slot("mouseClickedTipBorderColor",param.mouseClickedTipBorderColor?param.mouseClickedTipBorderColor:"rgb(255, 219, 111)");this.slot("minBeforwarded",0);this.slot("thresholdBeforwarded",100);this.slot("canvasW",param.canvasW?param.canvasW:800);this.slot("canvasH",param.canvasH?param.canvasH:600);this.slot("canvasCentreX",this.slot("canvasW")/2);this.slot("canvasCentreY",this.slot("canvasH")/2);this.slot("rootContainer",param.container?param.container:document.body);var chartContainer=document.createElement("div");chartContainer.style.position="relative";chartContainer.style.width=chartContainer.style.height="100%";chartContainer.style.top=chartContainer.style.left=0;this.slot("chartContainer",chartContainer);this.slot("rootContainer").appendChild(chartContainer)},circleCentrePos:function(){if(this.slot("spreadRootNode")==null)return{x:this.slot("canvasCentreX"),y:this.slot("canvasCentreY")};var rootNodeMatrix=this.slot("spreadRootNode").exec("actor").exec("matrix");return{x:rootNodeMatrix.tx,y:rootNodeMatrix.ty}},addSpreadNode:function(parent,absX,absY,actorParam){var actor=SpreadActor.create(actorParam);actor.slot("radiateSpreadChart",this);var node=this.slot("_scene").exec("createNode",{actor:actor});actor.exec("setOwnerNode",node);this.slot("_scene").exec("addNode",node,parent);var self=this;actor.exec("addInteractor",interactor.MouseOverInteractor,{onNext:function(evt){evt.actor.exec("onMouseOver")}});actor.exec("addInteractor",interactor.MouseClickedInteractor,{onNext:function(evt){evt.actor.exec("onMouseClicked")}});actor.exec("addInteractor",interactor.MouseDraggedInteractor,{onNext:function(evt){self.exec("spreadActorBeDragged",evt)}});if(parent==null)actor.exec("translate",absX,absY);else{var matrix=parent.exec("actor").exec("matrix");actor.exec("translate",absX-matrix.tx,absY-matrix.ty)}return node},addTestCircle:function(layerIndex,layerR){if(this.layerCircles==null)this.layerCircles={};if(this.layerCircles[layerIndex]!=null)return;var circleM=model.CircleModel.create({radius:layerR,strokeStyle:"rgb(255, 0, 0)"});var circleM=model.moveRelative(-.5,-.5,circleM);var cActor=Actor.create({model:circleM,director:this.exec("getDirector")});var circleCentre=this.exec("circleCentrePos");cActor.exec("translate",circleCentre.x,circleCentre.y,-layerIndex);var node=this.slot("_scene").exec("createNode",{actor:cActor});this.slot("_scene").exec("addNode",node);this.layerCircles[layerIndex]=node},layoutSpreadNode:function(data,index,parent){var layerR=data.layerIndex*this.slot("baseR");var nodeAreaRadian,startRadian,parentNode;if(parent==null||parent.isBackgroundNode){startRadian=0;nodeAreaRadian=2*Math.PI;parentNode=parent}else{if(index===0)startRadian=parent.startRadian;else{var preData=parent.children[index-1];startRadian=preData.startRadian+preData.areaRadian}nodeAreaRadian=data.sumLeafs/parent.sumLeafs*parent.areaRadian;parentNode=parent.node}var nodeRadian=startRadian+nodeAreaRadian/2;var circleCentre=this.exec("circleCentrePos");var x=circleCentre.x+layerR*Math.cos(nodeRadian);var y=circleCentre.y+layerR*Math.sin(nodeRadian);data.node=this.exec("addSpreadNode",parentNode,x,y,{R:this.slot("circleR"),keyImageSize:this.slot("keyImageSize"),fillColor:this.exec("getSpreadDataColor",data),director:this.exec("getDirector"),lineStrokeStyle:this.slot("lineStrokeStyle"),lineWidth:this.slot("lineWidth"),layerIndex:data.layerIndex,index:index,areaRadian:nodeAreaRadian,startRadian:startRadian,data:data});data.areaRadian=nodeAreaRadian;data.startRadian=startRadian;return data.node},layoutSpreadTree:function(root,index,parent,fun){var children=root.children;var spreadRootNode=fun(root,index,parent);if(children==null)return;var childIndex=0;var self=this;children.forEach(function(data){self.exec("layoutSpreadTree",data,childIndex++,root,fun)});return spreadRootNode},layout:function(spreadTreeData){this.slot("backgroundNode",addBackgroundNode(this));this.slot("buttonContainer",addZoonButton(this));var self=this;var spreadRootNode=this.exec("layoutSpreadTree",spreadTreeData,0,undefined,function(data,index,parent){return self.exec("layoutSpreadNode",data,index,parent)});this.slot("spreadRootNode",spreadRootNode);this.slot("spreadRootNode").exec("actor").slot("scale",1);this.exec("getDirector").exec("invalidate")},relayoutSpreadNodeTree:function(nodeTree){var self=this;var scale=this.slot("spreadRootNode").exec("actor").slot("scale");nodeTree.exec("forEach",function(node){var actor=node.exec("actor");var layerR=actor.slot("layerIndex")*self.slot("baseR")*scale;var nodeRadian=actor.slot("startRadian")+actor.slot("areaRadian")/2;var circleCentre=self.exec("circleCentrePos");var x=circleCentre.x+layerR*Math.cos(nodeRadian);var y=circleCentre.y+layerR*Math.sin(nodeRadian);var parentNode=node.exec("parent");if(parentNode.exec("actor")==null){var parentMatrix=geometry.identityMatrix()}else{var parentMatrix=parentNode.exec("actor").exec("matrix")}var parentWorldToLocalMatrix=geometry.matrixInvert(parentMatrix);var pos=geometry.pointApplyMatrix({x:x,y:y},parentWorldToLocalMatrix);actor.exec("translate",pos.x,pos.y,0)})},getSpreadDataColor:function(data){var fBeforwarded=(data.beForwarded-this.slot("minBeforwarded"))/this.slot("thresholdBeforwarded");if(fBeforwarded>1)fBeforwarded=1;if(fBeforwarded<0)fBeforwarded=0;var circleFillLightHSI=this.slot("circleFillLightHSI");var I=circleFillLightHSI.I-fBeforwarded*this.slot("thresholdI");var rgb=HSI2RGB({H:circleFillLightHSI.H,S:circleFillLightHSI.S,I:I});return"rgb("+rgb.r+","+rgb.g+","+rgb.b+")"},moveTipsWithActor:function(){for(var identifier in this.slot("mouseOverTipActors"))this.slot("mouseOverTipActors")[identifier].exec("moveTipWithActor");for(var identifier in this.slot("mouseClickedTipActors"))this.slot("mouseClickedTipActors")[identifier].exec("moveTipWithActor")},addMouseOverTipActor:function(actor){if(this.slot("mouseOverTipActors")==null)this.slot("mouseOverTipActors",{});this.slot("mouseOverTipActors")[Object.getIdentifier(actor)]=actor},removeMouseOverTipActor:function(actor){delete this.slot("mouseOverTipActors")[Object.getIdentifier(actor)]},addMouseClickedTipActor:function(actor){if(this.slot("mouseClickedTipActors")==null)this.slot("mouseClickedTipActors",{});this.slot("mouseClickedTipActors")[Object.getIdentifier(actor)]=actor},removeMouseClickedTipActor:function(actor){delete this.slot("mouseClickedTipActors")[Object.getIdentifier(actor)]},spreadActorBeDragged:function(evt){this.exec("getDirector").exec("invalidate");var actor=evt.actor;if(actor.slot("ownerNode").exec("parent").exec("actor")!=null)actor.exec("onMouseDrag",evt);else{this.exec("backgroundNodeBeDragged",evt);return}this.exec("moveTipsWithActor");if(this.slot("isCapture"))return;this.slot("resumeButtonNode",addResumeButton(this,evt.actor.slot("ownerNode")));this.slot("captureNode",addInteractorCapureNode(this));this.slot("isCapture",true)},backgroundNodeBeDragged:function(evt){var actor=evt.actor;if(evt.dragStart){actor.slot("lastPos",{x:evt.gameX,y:evt.gameY});return}var lastPos=actor.slot("lastPos");this.slot("spreadRootNode").exec("actor").exec("applyTranslate",evt.gameX-lastPos.x,evt.gameY-lastPos.y);actor.slot("lastPos",{x:evt.gameX,y:evt.gameY});this.exec("moveTipsWithActor");this.exec("getDirector").exec("invalidate")},backgroundNodeBeMousewheel:function(evt){var deltaScale=evt.wheelDelta/120*.2;var spreadRootActor=this.slot("spreadRootNode").exec("actor");var lastScale=spreadRootActor.slot("scale");var localMat=geometry.matrixInvert(spreadRootActor.exec("matrix"));desScale=lastScale+deltaScale;if(desScale<.2||desScale>2.8)return;var localPos=geometry.pointApplyMatrix({x:evt.gameX,y:evt.gameY},localMat);spreadRootActor.exec("pushTransform","translate",localPos.x,localPos.y);spreadRootActor.exec("pushTransform","scale",desScale/lastScale);spreadRootActor.exec("pushTransform","translate",-localPos.x,-localPos.y);spreadRootActor.slot("scale",desScale);this.exec("moveTipsWithActor");this.exec("getDirector").exec("invalidate")},undoSpreadActorDrag:function(undoNode){var director=this.exec("getDirector");var scene=this.slot("_scene");scene.exec("removeNode",this.slot("captureNode"));this.slot("isCapture",false);this.exec("relayoutSpreadNodeTree",undoNode);this.exec("moveTipsWithActor");var resumeButtonNode=this.slot("resumeButtonNode");resumeButtonNode.parentNode.removeChild(resumeButtonNode);director.exec("invalidate")}});RadiateSpreadChart=function(param){var gLevel=RadiateSpreadChartLevel.create(param);var skch=helper.createSketchpad(gLevel.slot("canvasW"),gLevel.slot("canvasH"),gLevel.slot("chartContainer"));var gPainter=painter.HonestPainter.create(skch);var gdirector=director.Director.create({painter:gPainter,view:view.TopView.create()});gdirector.exec("setLevel",gLevel);gLevel.exec("layout",param.spreadTreeData);return gdirector};exports.RadiateSpreadChartLevel=RadiateSpreadChartLevel;exports.RadiateSpreadChart=RadiateSpreadChart}};"use strict";function resource(path){return __resources__[path].data}(function(){var process={};var modulePaths=["/__builtin__","/__builtin__/libs","/libs","/"];var path;function resolveModulePath(request,parent){var start=request.substring(0,2);if(start!=="./"&&start!==".."){return modulePaths}var parentIsIndex=path.basename(parent.filename).match(/^index\.js$/),parentPath=parentIsIndex?parent.id:path.dirname(parent.id);return[path.dirname(parent.filename)]}function findModulePath(id,dirs){if(id.charAt(0)==="/"){dirs=[""]}for(var i=0;i<dirs.length;i++){var dir=dirs[i];var p=path.join(dir,id);if(path.exists(path.join(p,"index.js"))){return path.join(p,"index.js")}else if(path.exists(p+".js")){return p+".js"}}return false}function loadModule(request,parent){parent=parent||process.mainModule;var paths=resolveModulePath(request,parent),filename=findModulePath(request,paths);if(filename===false){throw"Unable to find module: "+request}if(parent){var cachedModule=parent.moduleCache[filename];if(cachedModule){return cachedModule}}var module=new Module(filename,parent);if(request==__main_module_name__&&!process.mainModule){process.mainModule=module}module._initialize(filename);return module}function Module(id,parent){this.id=id;this.parent=parent;this.children=[];this.exports={};if(parent){this.moduleCache=parent.moduleCache;parent.children.push(this)}else{this.moduleCache={}}this.moduleCache[this.id]=this;this.filename=null;this.dirname=null}Module.prototype._initialize=function(filename){var module=this;function require(request){return loadModule(request,module).exports}this.filename=filename;if(path){this.dirname=path.dirname(filename)}else{this.dirname=""}require.paths=modulePaths;require.main=process.mainModule;__resources__[this.filename].data.apply(this.exports,[this.exports,require,this,this.filename,this.dirname]);return this};path=(new Module("path"))._initialize("/__builtin__/path.js").exports;process.mainModule=loadModule(__main_module_name__);if(process.mainModule.exports.main){process.mainModule.exports.main()}})()};
(function(){var using=NEJ.P;var o=NEJ.O;var e=using("nej.e");var t=using("nej.ut");var u=using("nej.u");var v=using("nej.v");var j=using("nej.j");var dd=using("dd.data");var m=using("dd.module");var di=using("dd.ui");var du=using("dd.util");var dm=using("dd.message");var dc=using("dd.chat");var dw=using("dd.widget");var messageCache=dd._$$MessageCache._$allocate();var contactCache=dd._$$ContactCache._$allocate();var dataViewer={init:function(){this.accoutCache=dd._$$AccountCache._$allocate();this.initNode();this.initEvent();this.initData();this.initHdmsg2();this.initReport();this.initLotterymsg();this.initReplyalarm()},initNode:function(){this.contact=e._$get("contact-statistic");this.message=e._$get("message-statistic")},initData:function(){messageCache._$getStatistic();contactCache._$getStatistic()},initEvent:function(){messageCache._$addEvent("getstatistic",this.cbMessage._$bind(this));contactCache._$addEvent("getstatistic",this.cbContact._$bind(this));this.showLoading(this.contact);this.showLoading(this.message);if(e._$get("j-knowbtn")){v._$addEvent(e._$get("j-knowbtn"),"click",this.onClickKnow._$bind(this))}if(e._$get("j-tipclose")){v._$addEvent(e._$get("j-tipclose"),"click",this.onClickTipClose._$bind(this))}},initLotterymsg:function(){du.toggleByCookie({node:"hdmsg-lottery",cookie:{name:"msgLotteryClose"},closer:du.get("close","hdmsg-lottery")})},initReplyalarm:function(){du.toggleByCookie({node:"j-replyalarm",cookie:{name:"replyalarmClose",expires:1},closer:du.get("close","j-replyalarm")})},initHdmsg2:function(){du.toggleByCookie({node:"hdmsg2",cookie:{name:"hdmsg2Close"},closer:du.get("close","hdmsg2")})},initReport:function(){du.toggleByCookie({node:"hdmsg-report",cookie:{name:"isReported"},closer:du.get("close","hdmsg-report")})},onClickKnow:function(){this.accoutCache._$addEvent("onNoteLoad",this.onNoteLoad._$bind(this));this.accoutCache._$setNote()},onNoteLoad:function(data){if(data.code==200){e._$remove(e._$get("j-notebox"))}},onClickTipClose:function(){this.accoutCache._$addEvent("onNoticedLoad",this.onNoticedLoad._$bind(this));this.accoutCache._$authenNoticed()},onNoticedLoad:function(data){if(data.code==200){e._$remove(e._$get("j-authenTip"))}},cbContact:function(json){var parent=this.contact;if(json&&json.code==200){var result=json&&json.result;var ys=result&&(result.list||result.countList);ys=ys.reverse();if(result.lastCacheTime){var time=(result.lastCacheTime+1)*1e3}var xs=this.getDays(7,time);var data=this.dataFormat(xs,ys);this.clear(parent);initNev();Nev.LineChart({render:parent,data:data,style:{legend:false,gridborder:false,gridDirection:"horizontal",gridrow:4,seriesLineColor:["#0b62a4"],seriesLineWidth:[3,3],seriesBallRadius:4,seriesBallColor:["#0b62a4"],axisFontSize:12},listener:function(xValue,yValue,color,name){return'<div style="padding:5px 15px;border:2px solid #ebebeb;background:#fff;background:rgba(255,255,255,0.9);border-radius:10px;font:12px/24px arial;">日期：'+xValue+"<br/>人数："+yValue+"</div>"}})}else{this.showMessage(parent)}},cbMessage:function(json){var parent=this.message;if(json&&json.code==200){var result=json&&json.result;var ys=result&&result.countList;if(result.lastCacheTime){var time=(result.lastCacheTime+1)*1e3}var xs=this.getDays(7,time);ys=ys.reverse();var data=this.dataFormat(xs,ys);this.clear(parent);initNev();Nev.AreaChart({render:parent,data:data,style:{legend:false,gridborder:false,gridrow:4,gridDirection:"horizontal",seriesLineColor:["#67bdf8"],seriesLineWidth:[3,3],seriesBallRadius:4,seriesBallColor:["#67bdf8"],axisFontSize:12},listener:function(xValue,yValue,color,name){return'<div style="padding:5px 15px;border:2px solid #ebebeb;background:#fff;background:rgba(255,255,255,0.9);border-radius:10px;font:12px/24px arial;">日期：'+xValue+"<br/>消息数："+yValue+"</div>"}})}else{this.showMessage(parent)}},getDays:function(total,timestamp){var total=-total||-7;var days=[];for(var i=total;i<=-1;i++){days.push(this.getDay(i,timestamp))}return days},getDay:function(offset,timestamp){var t=timestamp?new Date(timestamp):new Date;t.setDate(t.getDate()+offset);var y=t.getFullYear();var m=t.getMonth()+1;var d=t.getDate();return m+"-"+d},dataFormat:function(xs,ys){var xy=[];u._$forEach(xs,function(x,index,that){xy.push([x,ys[index]])});return[{data:xy}]},showLoading:function(parent){var evt={};du.showListLoading(evt);parent.innerHTML=evt.value},showMessage:function(parent){var evt={};du.showListMessage("数据加载失败！",evt);parent.innerHTML=evt.value},clear:function(parent){parent.innerHTML=""}};var reRegister={init:function(){this.initNode();this.initEvent()},initNode:function(){this.reg=e._$get("reRegister")},initEvent:function(){v._$addEvent(this.reg,"click",this.onClickReg._$bind(this))},onClickReg:function(){if(e._$hasClassName(this.reg,"z-dis")){return}e._$addClassName(this.reg,"z-dis");du.showHint({message:"正在转向注册页面...",autoDisappear:false});j._$requestByREST("/rest/account/reRegister/"+PID,{method:"DELETE",onload:this.cbReg._$bind(this),onerror:this.cbReg._$bind(this)})},cbReg:function(json){if(json&&json.code==200&&json.result){location.href="/register"}else{du.showError(json&&json.message||"跳转到注册页面失败，请稍后刷新重试！");e._$delClassName(this.reg,"z-dis")}}};if(e._$get("contact-statistic")){dataViewer.init()}if(e._$get("reRegister")){reRegister.init()}})()